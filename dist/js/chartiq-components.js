(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{25:function(t,e,i){"use strict";var n=i(0),s=[];$.fn.extend({stxtap:function(t,e){return this.each((function(){n.c.installTapEvent(this),"string"==typeof t?$(this).on("stxtap",t,(function(t){e.call(this,t)})):$(this).on("stxtap",(function(e){t.call(this,e)}))}))}}),$.fn.extend($.expr[":"],{trulyvisible:function(t,e,i){var n=$(t).parents();n=n.add(t);for(var s=0;s<n.length;s++){var a=$(n[s]);if("0"===a.css("opacity"))return!1;if("hidden"===a.css("visibility"))return!1;if("0px"===a.css("height")&&"hidden"==a.css("overflow-y"))return!1;if(!a.is(":visible"))return!1}return!0}}),$.fn.extend({parentsAndMe:function(t){var e=$(this).parents();return e=e.add($(this))},cqvirtual:function(t){var e=this.clone(!0);return e.empty(),e.original=this,e},cqrender:function(t){if(this[0].innerHTML==this.original[0].innerHTML)return this.original;this.original.emptyExceptTemplate();var e=this.children();if(e.length){var i=e.detach();this.original.append(i)}return this.original},guaranteedWidth:function(){for(var t=this,e=t.width();!e;){if("BODY"===(t=t.parent())[0].tagName||t[0]===window)return window.innerWidth;e=t.width()}return e},guaranteedHeight:function(){for(var t=this,e=t.height();!e;){if("BODY"===(t=t.parent())[0].tagName||t[0]===window)return window.innerHeight;e=t.height()}return e},emptyExceptTemplate:function(){return this.children().not("template").remove(),this},truthyAttr:function(t){var e=this.attr(t);return void 0!==e&&("false"!=e.toLowerCase()&&"0"!=e)},attrBetter:function(t,e){return void 0===e&&(e="true"),this.attr(t)!==e&&(this.attr(t,e),!0)},removeAttrBetter:function(t){var e=this.attr(t);return!(!e&&""!==e)&&(this.removeAttr(t),!0)},textBetter:function(t){return this.text()!==t&&(this.text(t),!0)}}),$.queryString=function(t){for(var e=window.location.search.substring(1).split("&"),i=0;i<e.length;i++){var n=e[i].split("=");if(n[0]==t)return n[1]}return null},n.c.UI||(n.c.UI={}),n.c.UI.addResizeListener=function(t,e){n.c.UI.getUIManager().registerForResize(t),t.resizeHandle=n.c.resizeObserver(t,e,null,250)},n.c.UI.removeResizeListener=function(t){n.c.UI.getUIManager().unregisterForResize(t),n.c.resizeObserver(t,null,t.resizeHandle)},n.c.UI.containerExecute=function(t,e,i){var n=i;i&&n.constructor!==Array&&(n=Array.prototype.slice.call(arguments,2));for(var s=t.node.parents(),a=0;a<s.length;a++){var o=s[a];if(o[e]&&o[e].constructor==Function)return o[e].apply(o,n)}return null},n.c.UI.animatePrice=function(t,e,i,n){t.timeoutHandle&&(clearTimeout(t.timeoutHandle),t.timeoutHandle=null),t.removeClass("cq-stable cq-up cq-down"),e>i?t.addClass("cq-up"):e<i&&t.addClass("cq-down"),n&&(t.timeoutHandle=setTimeout((function(){t.addClass("cq-stable").removeClass("cq-up cq-down")}),0))},n.c.UI.makeFromTemplate=function(t,e){var i,n=$(t),s=n[0].content;s&&s.childNodes.length?i=document.importNode(s,!0):(s=document.createElement("DIV"),n.children().each(function(t){return function(){t.appendChild(this.cloneNode(!0))}}(s)),i=s.cloneNode(!0));var a=$(i).children();return e&&a.each(function(t){return function(){!0===t?n.parent().append(this):$(t).append(this)}}(e)),a},n.c.UI.splitMethod=function(t){if(!t)return null;var e=t.indexOf("("),i=t.lastIndexOf(")");if(-1==e||-1==i)return console.log("malformed stxtap attribute: "+t),null;var n,s=null,a=t.substring(0,e),o=a.indexOf(".");-1==o?n=a:(s=a.substring(0,o),n=t.substring(o+1,e));var r=t.substring(e+1,i).match(/('[^']+'|[^,]+)/g),c=new RegExp("^[0-9]+([,.][0-9]+)?$","g"),l=new RegExp("^\\d+$"),d=[];if(r)for(var h=0;h<r.length;h++){for(var p=r[h];" "==p.charAt(0);)p=p.substring(1);if(-1!=p.indexOf('"')||-1!=p.indexOf("'"))d.push(p.substring(1,p.length-1));else if("true"==p)d.push(!0);else if("false"==p)d.push(!1);else if("null"==p)d.push(null);else if(l.test(p))d.push(parseInt(p,10));else if(c.test(p))d.push(parseFloat(p));else{for(var u=p.split("."),m=window,g=0;g<u.length;g++)m=m[u[g]];d.push(m)}}return{helperName:s,functionName:n,args:d}},n.c.UI.observeProperty=function(t,e,i){if(e&&t&&i){t in e||(e[t]=void 0),n.c.UI.observables||(n.c.UI.observables={});var s,a=n.c.UI.observables;a[t]||(a[t]=[]);for(var o=0;o<a[t].length;o++){var r=a[t][o];r.obj==e&&(s=r)}s||(s={obj:e,value:e[t],listeners:[]},a[t].push(s)),s.listeners.push(i),i({obj:e,property:t,value:s.value}),Object.defineProperty(e,t,{enumerable:!0,get:function(){return s.value},set:function(i){if(s.value!==i){s.value=i;for(var n={obj:e,property:t,value:i},a=0;a<s.listeners.length;a++)s.listeners[a](n)}}})}},n.c.UI.unobserveProperty=function(t,e,i){if(t&&e&&n.c.UI.observables){var s=n.c.UI.observables[t];if(s){for(var a=s.length-1;a>=0;a--){var o=s[a];if(o.obj==e){if(i)for(var r=o.listeners,c=r.length;c>=0;c--)r[c]===i&&r.splice(c,1);i&&o.listeners.length||(Object.defineProperty(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o.value}),s.splice(a,1))}}s.length||delete n.c.UI.observables[t]}}},n.c.UI.allContexts=function(){return $("cq-context,*[cq-context]")},n.c.UI.getMyContext=function(t){for(var e=$(t).parentsAndMe(),i=0;i<e.length;i++){var n=e[i];if(n.context)return n.context;if(n.CIQ&&n.CIQ.UI)return n.CIQ.UI.context}return null},n.c.UI.contextsForEach=function(t){n.c.UI.allContexts().each((function(){t.apply(this.CIQ.UI.context)}))},n.c.UI.release=!1,n.c.UI.bypassBindings=!1,n.c.UI.begin=function(t){n.c.UI.release=!0,setTimeout((function(){r.nextTick(),t&&t()}),0)},n.c.UI.addComponentDefinition=function(t,e){const i=!!n.c.UI.registerComponentsImmediately;n.c.UI._webcomponents||(n.c.UI._webcomponents={list:{},registered:i}),n.c.UI._webcomponents.list[t]={tag:t,classDefinition:e,registered:i},i&&customElements.define(t,e)},n.c.UI.registerComponents=function({except:t=[]}={}){if(!n.c.UI._webcomponents)return;const{list:e}=n.c.UI._webcomponents;Object.keys(e).filter(e=>!t.includes[e]).forEach(t=>{const i=e[t];i&&!i.registered&&(customElements.define(t,i.classDefinition),i.registered=!0)}),n.c.UI._webcomponents.registered=!0},n.c.UI.ensureComponentsRegistered=function(){n.c.UI._webcomponents&&!n.c.UI._webcomponents.registered&&n.c.UI.registerComponents()},n.c.UI.components=function(t){return Object.values(n.c.UI._webcomponents.list).filter(({tag:e,classDefinition:i})=>!t||t===e||t===i.name||t===i)},n.c.UI.componentMarkup=function(t,e){const i=this.components(t);if(void 0===e){if(!i.length)return;const e=i.map(s);return t?e[0]:e}const[n]=i;if(n&&n.classDefinition.markup)return n.classDefinition.markup=e,s(n);function s(t){const{tag:e,registered:i,classDefinition:{markup:n,name:s}}=t;return{tag:e,name:s,registered:i,markup:n}}},n.c.UI.markupDependencies=function(){const t=n.c.UI.componentMarkup(),e={};t.forEach(t=>{if(t.markup)for(let i in n.c.UI._webcomponents.list){const s=n.c.UI._webcomponents.list[i];t.markup.indexOf("</"+s.tag+">")>-1&&(e[t.tag]||(e[t.tag]=[]),e[t.tag].push(s.tag))}});const i={};for(let t in e)e[t].forEach(t=>{i[t]=(i[t]||0)+1});return{dependencies:e,timesNeeded:i}},n.c.UI.addInheritance=function(t,e){for(var i in e.prototype)try{t.prototype[i]=e.prototype[i]}catch(t){}};var a={};n.c.UI.supportedInputType=function(t){if(!a[t]){var e=document.createElement("input");e.setAttribute("type",t),a[t]=e.type}return a[t]};var o=n.c.UI.Context=function(t,e,i){this.params=i||{},this.stx=t,t&&(t.uiContext=this),e=this.topNode=$(e)[0],this.node=$(this.topNode),n.c.isMobile&&e.setAttribute("ciq-mobile","");var s=n.c.UI.Context.assembleContext(e);this.advertised={};for(var a=e.CIQ.UI.context=this,o=[],r=0;r<s.Components.length;r++)o.push(s.Components[r].tagName.toLowerCase());o.length&&this.topNode.querySelectorAll(o.join(",")).forEach((function(t){t.setContextPrivate(a)}))};o.assembleContext=function(t){return t.CIQ||(t.CIQ={}),t.CIQ.UI||(t.CIQ.UI={}),t.CIQ.UI.Components||(t.CIQ.UI.Components=[]),t.CIQ.UI},o.prototype.changeSymbol=function(t){console.log("Please implement CIQ.UI.Context.prototype.changeSymbol")},o.prototype.setLookupDriver=function(t){this.lookupDriver=t,t.deprecated&&console.warn("Using deprecated Lookup Driver, please see documentation: CIQ.ChartEngine.Driver.Lookup")},o.prototype.advertiseAs=function(t,e){this.advertised[e]=t},o.prototype.getAdvertised=function(t){return this.advertised[t]},o.prototype.setLoader=function(t){this.loader=t},o.prototype.isModal=function(){return""!==this.stx.openDialog};class r extends HTMLElement{constructor(){super(),this.node=$(this),this.eventListeners=[]}connectedCallback(){this.attached||(r.buildReverseBindings(this),this.attached=!0)}disconnectedCallback(){if(this.attached=!1,this.context)for(var t=0;t<this.eventListeners.length;t++)this.context.stx.removeEventListener(this.eventListeners[t])}addDefaultMarkup(t,e){const i=t||this;if((t=>0===t.children.length)(i)&&(i.constructor.markup||e)){const t=+new Date;if(i.innerHTML=e||i.constructor.markup,r.buildReverseBindings(i),n.c.debug){const e=+new Date-t;r.createMarkupTime=e+(r.createMarkupTime||0),console.log("Building markup "+this.constructor.name+" "+(this.getAttribute("cq-name")||"")+" built in="+e,"total="+r.createMarkupTime)}}}channelWrite(t,e,i){const{obj:s,prop:a}=n.c.UI.BaseComponent.getChannel(t,i,this);s&&(s[a]=e)}channelMergeObject(t,e,i){const{obj:s,prop:a}=n.c.UI.BaseComponent.getChannel(t,i,this);s&&(s[a]=Object.assign({},s[a],e))}channelRead(t,e){const{obj:i,prop:s}=n.c.UI.BaseComponent.getChannel(t,e,this);if(i)return i&&i[s]}channelSubscribe(t,e,i){const{obj:s,prop:a}=n.c.UI.BaseComponent.getChannel(t,i,this);if(s)return n.c.UI.observeProperty(a,s,o),()=>{n.c.UI.unobserveProperty(a,s,o)};function o({value:t}){e(t)}}qs(t,e){return"thisChart"===e&&(e=this.getContextContainer()),(e||document).querySelector(t)}qsa(t,e){return"thisChart"===e&&(e=this.getContextContainer()),Array.prototype.slice.call((e||document).querySelectorAll(t)||[])}getContextContainer(t){return t?r.selfOrParentElement(t,"cq-context"):(this.contextContainer||(this.contextContainer=r.selfOrParentElement(this,"cq-context")),this.contextContainer)}getChartContainer(t){return r.selfOrParentElement(t||this,"ciq-chart")}static getHelper(t,e,i){if(t){if(t=$(t)[0],!e&&!(e=t.getAttribute(i)))return null;var s,a=e.indexOf("("),o=e.substring(0,a),r=e.indexOf(".");if(-1==a||-1!=o.indexOf(".")){var c=-1===r?e:e.substring(0,r),l=t.context;if(l||(t.context||(t.context=n.c.UI.getMyContext(t)),l=t.context),!l)return console.log("No context attached to "+t.tagName+". A context is required when binding to a helper."),null;s=l.getAdvertised(c)}else for(var d=e.substring(0,a),h=$(t).parents(),p=0;p<h.length;p++){var u=h[p];if("function"==typeof u[d])return u}return s}}static activate(t,e,i,s){var a=s?"stxsetget":"stxtap",o=n.c.UI.splitMethod(t.getAttribute(a));if(o){var c=o.helperName,l=o.functionName;s&&(l="set"+l);var d=[{node:t,e:e,params:i}].concat(o.args);if(c){var h=r.getHelper(t,null,a);if(!h[l])return void console.log("Method '"+l+"' not found in helper",h);h[l].apply(h,d)}else for(var p=$(t).parents(),u=0;u<p.length;u++){var m=p[u];"function"==typeof m[l]&&m[l].apply(m,d)}}}makeTap(t,e){r.makeTap(t,e)}static makeTap(t,e){t.selectFC=e,$(t).stxtap(e)}static bind(t,e){console.warn("CIQ.UI.BaseComponent#bind will be deprecated in a future release.\n If you want to bind anything use CIQ.UI.BaseComponent.bindNode() instead"),this.bindNode(t,e)}static bindNode(t,e){var i=(t=$(t)[0]).getAttribute("stxbind"),s=t.getAttribute("stxtap"),a=t.getAttribute("stxsetget");function o(t){return function(i){r.activate(t,i,e,!1)}}i&&""!==i&&function(e){var n,s=i.indexOf("(");n=i.substring(i.indexOf(".")+1),-1!==s&&(n=i.substring(0,s)),e&&e[n](t)}(r.getHelper(t,i,"stxbind")),s&&""!==s&&("INPUT"!=t.tagName||"text"!==t.type&&"number"!==t.type?r.makeTap(t,o(t)):r.inputEntry(t,o(t))),a&&function(i){function s(){return function(i){r.activate(t,i,e,!0)}}var o=n.c.UI.splitMethod(a);if(o){var c=[t].concat(o.args).concat(e),l="get"+o.functionName;i&&i[l]&&i[l].apply(i,c),"text"===t.type||"number"===t.type?r.inputEntry(t,s()):r.makeTap(t,s())}else console.log("Syntax error "+a)}(r.getHelper(t,a,"stxsetget"))}static scheduleForBinding(t,e){r.scheduledBindings.push({node:t,parentTag:e}),r.timeout&&clearTimeout(r.timeout),r.timeout=setTimeout(r.nextTick,0)}inputEntry(t,e){r.inputEntry(t,e)}static inputEntry(t,e){$(t).on("keypress",(function(t){switch(t.which){case 13:case 9:e()}}))}addClaim(t){s.push({helper:t})}removeClaim(t){for(var e=0;e<s.length;e++)if(s[e].helper===t)return void s.splice(e,1)}static buildReverseBindings(t){if(!n.c.UI.bypassBindings){var e,i=function(t){if(t.hasAttribute("stxbind")||t.hasAttribute("stxtap")||t.hasAttribute("stxsetget"))return NodeFilter.FILTER_ACCEPT},s=document.createNodeIterator(t,NodeFilter.SHOW_ELEMENT,n.c.isIE?i:{acceptNode:i},!1);for(e=s.nextNode();e;)r.scheduleForBinding(e,t),e=s.nextNode()}}static nextTick(){if(n.c.UI.release){clearTimeout(r.timeout);for(var t=r.scheduledBindings,e=t.length-1;e>=0;e--){var i=t[e];i.node.ciqAlreadyBound||(r.bindNode(i.node,{parent:i.parentTag}),i.node.ciqAlreadyBound=!0)}}}static selfOrParentElement(t,e){let i=t;for(;i;){if(i.classList.contains(e)||null!==i.getAttribute(e)||i.nodeName.toLowerCase()===e)return i;i=i.parentElement}}static toPropAndObject(t,e){const i=t.split(".");return{prop:i.pop(),obj:i.reduce((t,e)=>void 0!==t[e]?t[e]:t[e]={},e)}}static getChannel(t,e,i){if(!t)return console.warn("Missing channel path"),{};if(!e&&!i)return console.warn("Chart engine not provided while retrieving ",t),{};e||i.stx||(i.container||(i.container=n.c.UI.getMyContext(i)),i.stx=i.container.stx);const{obj:s,prop:a}=r.toPropAndObject(t,e||i.stx);return{obj:s,prop:a}}}r.scheduledBindings=[],n.c.UI.BaseComponent=r;class c extends r{constructor(){super(),this.injections=[]}connectedCallback(){this.attached||(this.setContextHolder(),super.connectedCallback())}disconnectedCallback(){if(this.context){var t;for(t=0;t<this.injections.length;t++)this.context.stx.removeInjection(this.injections[t]);for(this.injections=[],t=0;t<this.eventListeners.length;t++)this.context.stx.removeEventListener(this.eventListeners[t]);this.eventListeners=[]}}setContextHolder(){var t=this.node.parents("cq-context,*[cq-context]");if(t.length){var e=t[0],i=o.assembleContext(e);i.Components.push(this),i.context&&this.setContextPrivate(i.context)}else console.log("No cq-context found for "+this.tagName)}setContext(t){}setContextPrivate(t){var e,i;this.context=t,this.uiManager=n.c.UI.getUIManager(),this.hasAttribute("cq-marker")&&!this.convertedToMarker&&(this.convertedToMarker=!0,this.marker=new n.c.Marker({stx:t.stx,node:this,xPositioner:"none",yPositioner:"none",label:"component",permanent:!0})),setTimeout((e=this,i=t,function(){e.setContext(i)}))}addInjection(t,e,i){this.injections.push(this.context.stx[t](e,i))}}n.c.UI.ContextTag=c;n.c.UI.ModalTag=class extends c{constructor(){super()}connectedCallback(){if(!this.attached){$(this);this.onpointerover=function(){this.modalBegin()},this.onpointerout=function(){this.modalEnd()},super.connectedCallback()}}modalBegin(){this.context&&this.context.stx.modalBegin()}modalEnd(){this.context&&(this.uiManager.activeMenuStack.length||this.context.stx.modalEnd())}};function l(t,e){var i,n=e.stx,s=$(t||e.topNode);this.node=s[0],this.context=e,this.editing=null,this.drawingContext=$("cq-drawing-context"),this.cvpController=s.find("cq-cvp-controller"),this.toolbar=s.find("cq-toolbar"),this.toolbar.length||(this.toolbar=s.find("cq-drawing-settings")),this.toolbar.on("change",function(t,e){return function(){e.editing&&(e.editing.name===t.currentVectorParameters.vectorType?(e.editing.copyConfig(),t.draw(),t.changeOccurred("vector")):e.endEdit(null,"tool"))}}(n,this)),this.count=n.drawingObjects.length,e.advertiseAs(this,"DrawingEdit"),n.addEventListener("drawing",(i=this,function(t){var e=t.drawings.length;i.count!==e&&(i.endEdit(null,"count"),i.count=e)})),n.addEventListener("drawingEdit",function(t){return function(e){!0===e.forceEdit?(t.endEdit(null,"edit"),t.showToolbar(e.drawing),t.beginEdit(e.drawing)):t.showContext(e)}}(this)),s.find("cq-toolbar .ciq-drawing-edit-only:has(.ciq-btn)").hover(function(t,e){return function(i){var n="mouseenter"===i.type;e.editing&&e.editing.highlighted!==n&&(e.editing.highlighted=n,t.draw())}}(n,this))}n.c.UI.DialogContentTag=class extends r{constructor(){super()}close(){this.node.parents("cq-dialog")[0].close(),this.node.find("cq-swatch").each((function(){this.colorPicker&&this.colorPicker.close()}))}open(t){t&&t.context&&this.setContext(t.context);var e=this.tagName.toLowerCase();this.node.closest("cq-dialog,cq-menu").each((function(){this.addActiveAttribute(e),this.open(t)}))}setContext(t){this.node.find("[stxtap],[stxbind],[stxsetget]").each((function(){this.context=t})),this.context=t}},n.c.UI.Helper=function(t,e){this.node=t,this.context=e,this.injections=[]},n.c.UI.Helper.prototype.addInjection=function(t,e,i){this.injections.push(this.context.stx[t](e,i))},n.c.UI.Helper.prototype.destroy=function(){for(var t=0;t<this.injections.length;t++)this.context.stx.removeInjection(this.injections[t]);this.injections=[]},n.c.UI.HeadsUp=function(t,e,i){this.params=i||{},void 0===this.params.autoStart&&(this.params.autoStart=!0),this.node=$(t),this.node.detach(),this.context=e,this.injections=[],this.maxVolume={lastCheckDate:null,value:0},this.params.autoStart&&this.begin()},n.c.inheritsFrom(n.c.UI.HeadsUp,n.c.UI.Helper),n.c.UI.HeadsUp.prototype.begin=function(){var t,e;this.injections.length||n.c.Marker&&(n.c.Marker.HeadsUp||(n.c.Marker.HeadsUp=function(t,e){this.className||(this.className="CIQ.Marker.HeadsUp"),n.c.Marker.call(this,t),this.prevTick=null,this.showClass=e},n.c.inheritsFrom(n.c.Marker.HeadsUp,n.c.Marker,!1),n.c.Marker.HeadsUp.placementFunction=function(t){function e(t,e,i,n){return Math.round(i-t.pixelFromPrice(n,e))}var i=t.panel,n=i.chart,s=t.stx,a=s.chart.highLowBars;t.showClass||(t.showClass="stx-show");for(var o=0;o<t.arr.length;++o){var r=t.arr[o],c=$(r.node);if(i.hidden||!s.insideChart)return void c.removeClass(t.showClass);if(r.params.x<0||r.params.x>=n.dataSet.length)return void c.removeClass(t.showClass);if(s.layout.crosshair||s.currentVectorParameters.vectorType)return void c.removeClass(t.showClass);var l,d=n.dataSet[r.params.x],h=s.pixelFromTick(r.params.x);if(!d||h<n.left||h>n.right)return void c.removeClass(t.showClass);if(!d[s.chart.defaultPlotField]&&0!==d[s.chart.defaultPlotField])return void c.removeClass(t.showClass);c.addClass(t.showClass),r.clientWidth||(r.clientWidth=c.width()),r.clientHeight||(r.clientHeight=c.height()),r.clientWidth>h?(c.removeClass("stx-left"),c.addClass("stx-right"),c.css({left:h+"px",right:"auto"})):(c.addClass("stx-left"),c.removeClass("stx-right"),c.css({right:s.chart.canvasWidth-h+"px",left:"auto"}));var p=r.params.chartContainer?s.chart.canvasHeight:i.bottom;p-(l=e(s,i,p,a?s.getBarBounds(d)[i.yAxis.flipped?"low":"high"]:d[s.chart.defaultPlotField]))-r.clientHeight+s.top<0?(c.addClass("stx-below"),l=(a?e(s,i,p,s.getBarBounds(d).low):l)-r.clientHeight):c.removeClass("stx-below");var u=l+"px";r.node.style.bottom!=u&&(r.node.style.bottom=u)}}),this.params.followMouse?(this.node.css({top:"auto"}),t={stx:this.context.stx,label:"headsup",xPositioner:"bar",chartContainer:!0,x:0,node:this.node[0]},this.marker=new n.c.Marker.HeadsUp(t,this.params.showClass),this.addInjection("append","handleMouseOut",(e=this,function(){e.followMouse(-1)}))):this.params.staticNode||(this.node.css({top:"",left:""}),t={stx:this.context.stx,label:"headsup",xPositioner:"none",chartContainer:!1,node:this.node[0]},$.extend(t,this.params),this.marker=new n.c.Marker(t)),n.c.isMobile&&(this.context.stx.layout.crosshair=!0),this.calculateMaxVolume(),this.addInjection("prepend","headsUpHR",function(t){return function(){t.position()}}(this)),this.addInjection("append","createXAxis",function(t){return function(){t.position()}}(this)),this.addInjection("append","createDataSet",function(t){return function(e,i,n){t.calculateMaxVolume(n.appending)}}(this)))},n.c.UI.HeadsUp.prototype.end=function(){n.c.isMobile&&(this.context.stx.layout.crosshair=!1),this.marker&&this.marker.remove(),this.destroy(),this.marker=null},n.c.UI.HeadsUp.prototype.calculateMaxVolume=function(t){t||(this.maxVolume={lastCheckDate:null,value:0});var e=this.context.stx.chart.dataSet;if(e&&e.length){for(var i=e.length-1;i>=0;i--){var n=e[i];if(n.DT<this.maxVolume.lastCheckDate)break;n.Volume>this.maxVolume.value&&(this.maxVolume.value=n.Volume)}this.maxVolume.lastCheckDate=e[e.length-1].DT}},n.c.UI.HeadsUp.prototype.position=function(){var t=this.context.stx,e=t.barFromPixel(t.cx);this.tick=t.tickFromPixel(t.cx);var i=t.chart.xaxis[e],s=t.chart.defaultPlotField,a=t.chart.highLowBars;s&&!a||(s="Close");var o=this.node,r=this;function c(e){var i=t.layout.chartScale,n=t.chart.panel,s=t.chart.yAxis;return(s.originalPriceFormatter&&s.originalPriceFormatter.func?s.originalPriceFormatter.func(t,n,e):s.priceFormatter&&"percent"!=i&&"relative"!=i?s.priceFormatter(t,n,e):t.formatYAxisPrice(e,n)).replace(/(\.[0-9]*[1-9])0+$|\.0*$/,"$1")}if(this.tick!=this.prevTick||i&&+i.DT==+t.chart.endPoints.end){this.timeout&&clearTimeout(this.timeout);var l=(this.params.followMouse,0);this.timeout=setTimeout((function(){function e(t){return n.c.isValidNumber(parseFloat(t))?t:"N/A"}if(r.timeout=null,o.find("cq-hu-price").text("N/A"),o.find("cq-hu-open").text("N/A"),o.find("cq-hu-close").text("N/A"),o.find("cq-hu-high").text("N/A"),o.find("cq-hu-low").text("N/A"),o.find("cq-hu-date").text("N/A"),o.find("cq-hu-volume").text("N/A"),o.find("cq-volume-rollup").text(""),i&&i.data){var a=n.c.clone(i.data);void 0===a.Open&&(a.Open=a.Close),void 0===a.High&&(a.High=Math.max(a.Open,a.Close)),void 0===a.Low&&(a.Low=Math.min(a.Open,a.Close)),o.find("cq-hu-open").text(e(c(a.Open))),o.find("cq-hu-price").text(e(c(a[s]))),o.find("cq-hu-close").text(e(c(a.Close))),o.find("cq-hu-high").text(e(c(a.High))),o.find("cq-hu-low").text(e(c(a.Low)));var l=n.c.condenseInt(a.Volume),d=l.charAt(l.length-1);d>"9"&&(l=l.substring(0,l.length-1),o.find("cq-volume-rollup").text(d.toUpperCase())),o.find("cq-hu-volume").text(l);var h=a.displayDate;h||(h=a.DT),t.internationalizer?n.c.ChartEngine.isDailyInterval(t.layout.interval)?o.find("cq-hu-date").text(t.internationalizer.yearMonthDay.format(h)):o.find("cq-hu-date").text(t.internationalizer.yearMonthDay.format(h)+" "+t.internationalizer.hourMinute.format(h)):n.c.ChartEngine.isDailyInterval(t.layout.interval)?o.find("cq-hu-date").text(n.c.mmddyyyy(n.c.yyyymmddhhmm(h))):o.find("cq-hu-date").text(n.c.mmddhhmm(n.c.yyyymmddhhmmssmmm(h)));var p=o.find("cq-volume-visual");if(p.length){var u=r.maxVolume.value?a.Volume/r.maxVolume.value:0;p.css({width:Math.round(100*u)+"%"})}}}),l)}this.prevTick=this.tick,this.params.followMouse&&(t.openDialog&&(this.tick=-1),this.followMouse(this.tick))},n.c.UI.HeadsUp.prototype.followMouse=function(t){this.marker.params.x=t;this.marker.render()},n.c.UI.DrawingEdit=l,n.c.inheritsFrom(l,n.c.UI.Helper),l.prototype.showContext=function(t){t.context=this.context,t.x=n.c.ChartEngine.crosshairX,t.y=n.c.ChartEngine.crosshairY,this.count=this.context.stx.drawingObjects.length,this.drawingContext.each((function(){this.open&&this.open(t)}))},l.prototype.getToolActivator=function(t){var e=this.toolbar.find('cq-item[cq-tool="'+t+'"]');return e.length||(e=this.toolbar.find("cq-item[stxtap=\"tool('"+t+"')\"]")),{node:e[0]}},l.prototype.showToolbar=function(t){var e=this,i=e.getToolActivator(t.name);e.node;this.toolbar.each((function(){var s=t.lineWidth,a=t.pattern,o=t.parameters&&t instanceof n.c.Drawing.fibonacci;o&&(s=t.parameters.fibs[0].parameters.lineWidth,a=t.parameters.fibs[0].parameters.pattern),this.tool(i,t.name),this.sync({lineWidth:s,pattern:a,annotation:{font:t.font?n.c.clone(t.font):{}},fillColor:t.fillColor,currentColor:t.color,axisLabel:t.axisLabel}),e.cvpController.each((function(){this.sync(t)})),o&&(this.context.stx.currentVectorParameters.fibonacci=n.c.clone(t.parameters))}))},l.prototype.beginEdit=function(t){this.editing=t,this.beforeEdit=t.serialize(),this.toolbar.attr("cq-drawing-edit",t.name);var e=new CustomEvent("drawing-edit-begin",{bubbles:!0,cancelable:!0,detail:{drawing:t,tool:t.name}});this.node.dispatchEvent(e)},l.prototype.endEdit=function(t,e){var i=this.context.stx,n=null,s=null;if(this.editing){s=this.editing.name,n=new CustomEvent("drawing-edit-end",{bubbles:!0,cancelable:!0,detail:{action:e,drawing:this.editing,tool:s}});var a=i.drawingObjects.indexOf(this.editing),o=i.exportDrawings();a>-1&&this.beforeEdit&&(o[a]=this.beforeEdit,i.undoStamp(o,i.exportDrawings())),"close"===e&&this.editing.highlighted&&(this.editing.highlighted=!1,i.draw())}this.editing=null,this.beforeEdit=null,this.toolbar.attr("cq-drawing-edit","none"),s&&"close"===e&&(t=this.getToolActivator(s),this.toolbar.each((function(){this.tool(t,s)}))),n&&this.node.dispatchEvent(n)},l.prototype.edit=function(){var t=this;this.drawingContext.each((function(){var e=n.c.UI.getMyContext(this.drawing.stx.container).topNode,i=document.querySelector("cq-drawing-context").parentNode,s=e.querySelector("cq-drawing-settings"),a={left:i.offsetLeft,top:i.offsetTop};this.close(),t.endEdit(null,"edit"),t.showToolbar(this.drawing,a),t.beginEdit(this.drawing),s&&s.detach(a.left,a.top)}))},l.prototype.text=function(){var t=this;this.drawingContext.each((function(){this.close(),t.endEdit(null,"text"),this.drawing.edit&&this.drawing.edit(null,!0)}))},l.prototype.clone=function(){var t=this,e=this.context.stx;this.endEdit(null,"clone"),this.drawingContext.each((function(){this.close();var i=new n.c.Drawing[this.drawing.name],s=this.drawing.serialize();i.reconstruct(e,s),i.repositioner=this.drawing.repositioner,i.highlighted=!0,this.drawing.highlighted=!1,t.count+=1,e.addDrawing(i),e.activateRepositioning(i)}))},l.prototype.reorderLayer=function(t,e){var i=this.context.stx;this.endEdit(null,"reorderLayer"),this.drawingContext.each((function(){this.close();var t=i.drawingObjects.length-1,n=i.drawingObjects.indexOf(this.drawing),s=NaN;if(-1!==n){switch(e){case"up":n<t&&(s=n+1);break;case"down":n>0&&(s=n-1);break;case"top":n<t&&(s=t);break;case"bottom":n>0&&(s=0)}if(s==s){var a=i.exportDrawings();i.drawingObjects.splice(n,1),i.drawingObjects.splice(s,0,this.drawing),i.undoStamp(a,i.exportDrawings()),i.draw(),i.changeOccurred("vector")}}}))},l.prototype.remove=function(){var t=this,e=this.context.stx;this.endEdit(null,"remove"),this.drawingContext.each((function(){if(!this.drawing.permanent){var i=e.exportDrawings();t.count-=1,e.removeDrawing(this.drawing),e.undoStamp(i,e.exportDrawings()),this.close()}}))},n.c.UI.StudyEdit=function(t,e){this.context=e,this.node=t||e.topNode,this.contextDialog=[];for(var i=document.querySelectorAll("cq-study-context"),n=0;n<i.length;n++)this.contextDialog.push(i[n]);e.advertiseAs(this,"StudyEdit"),this.initialize()},n.c.inheritsFrom(n.c.UI.StudyEdit,n.c.UI.Helper),n.c.UI.StudyEdit.prototype.remove=function(){n.c.Studies.removeStudy(this.params.stx,this.params.sd),this.contextDialog.forEach((function(t){t.close&&t.close()}))},n.c.UI.StudyEdit.prototype.edit=function(){this.contextDialog.forEach((function(t){t.close&&t.close()})),this.editPanel(this.params)},n.c.UI.StudyEdit.prototype.editPanel=function(t){t.context=this.context,t.x=null,t.y=null;const{channelWrite:e}=n.c.UI.BaseComponent.prototype;this.context.config?e(this.context.config.channels.dialog,{type:"study",params:t},this.context.stx):document.querySelector("cq-study-dialog").open(t)},n.c.UI.StudyEdit.prototype.editOverlay=function(t){this.params=t,t.context=this.context,t.forceEdit?this.editPanel(t):this.contextDialog.forEach((function(e){t.x=n.c.ChartEngine.crosshairX,t.y=n.c.ChartEngine.crosshairY,e.open&&e.open(t)}))},n.c.UI.StudyEdit.prototype.initialize=function(){var t=this.context.stx,e=this;function i(t){return function(){t.apply(e,arguments)}}t.addEventListener("studyOverlayEdit",i(e.editOverlay)),t.addEventListener("studyPanelEdit",i(e.editPanel))},n.c.UI.Layout=function(t,e){this.params=e||{},this.params.activeClassName||(this.params.activeClassName="ciq-active"),this.context=t,t.advertiseAs(this,"Layout")},n.c.inheritsFrom(n.c.UI.Layout,n.c.UI.Helper),n.c.UI.Layout.prototype.getChartType=function(t,e){var i=this.context.stx,s=this.params.activeClassName,a=function(i){var n=i.obj;n.aggregationType&&"ohlc"!=n.aggregationType?e!==n.aggregationType?t.classList.remove(s):t.classList.add(s):e!==n.chartType?t.classList.remove(s):t.classList.add(s)};n.c.UI.observeProperty("chartType",i.layout,a),n.c.UI.observeProperty("aggregationType",i.layout,a)},n.c.UI.Layout.prototype.setChartType=function(t,e){!{heikinashi:!0,kagi:!0,linebreak:!0,pandf:!0,rangebars:!0,renko:!0}[e]?this.context.stx.setChartType(e):this.context.stx.setAggregationType(e)},n.c.UI.Layout.prototype.getChartScale=function(t,e){var i=this.context.stx,s=this.params.activeClassName;n.c.UI.observeProperty("chartScale",i.layout,(function(i){i.value==e?t.classList.add(s):t.classList.remove(s)}))},n.c.UI.Layout.prototype.setChartScale=function(t,e){var i=this.context.stx,n=i.layout.chartScale;n==e?i.setChartScale(null):n&&"linear"!=n||i.setChartScale(e)},n.c.UI.Layout.prototype.getFlippedChart=function(t){var e=this.context.stx,i=this.params.activeClassName;n.c.UI.observeProperty("flipped",e.layout,(function(e){e.value?t.classList.add(i):t.classList.remove(i)}))},n.c.UI.Layout.prototype.setFlippedChart=function(t){var e=this.context.stx;e.flipChart(!e.layout.flipped)},n.c.UI.Layout.prototype.getExtendedHours=function(t){var e=this.context.stx,i=this.params.activeClassName;n.c.UI.observeProperty("extended",e.layout,(function(e){e.value?t.classList.add(i):t.classList.remove(i)}))},n.c.UI.Layout.prototype.setExtendedHours=function(t){var e=this.context.stx;if(e.layout.extended=!e.layout.extended,e.changeOccurred("layout"),!e.layout.extended||e.chart.market.market_def&&e.chart.market.sessions.length||n.c.alert("There are no Extended Hours for this instrument."),e.extendedHours){var i=this.context.loader;i&&i.show(),e.extendedHours.set(e.layout.extended,null,(function(){i&&i.hide()}))}},n.c.UI.Layout.prototype.getRangeSlider=function(t){var e=this.context.stx,i=this.params.activeClassName;n.c.UI.observeProperty("rangeSlider",e.layout,(function(e){e.value?t.classList.add(i):t.classList.remove(i)}))},n.c.UI.Layout.prototype.setRangeSlider=function(t){var e=this.context.stx;e.layout.rangeSlider=!e.layout.rangeSlider,e.slider&&e.slider.display(e.layout.rangeSlider),e.changeOccurred("layout")},n.c.UI.Layout.prototype.getOutliers=function(t){var e=this.context.stx,i=this.params.activeClassName;n.c.UI.observeProperty("outliers",e.layout,(function(e){e.value?t.classList.add(i):t.classList.remove(i)}))},n.c.UI.Layout.prototype.setOutliers=function(t){var e=this.context.stx;e.layout.outliers=!e.layout.outliers,e.draw(),e.changeOccurred("layout")},n.c.UI.Layout.prototype.getAggregationType=function(t,e){var i=this.context.stx,s=this.params.activeClassName;n.c.UI.observeProperty("aggregationType",i.layout,(function(i){i.value==e?t.classList.add(s):t.classList.remove(s)}))},n.c.UI.Layout.prototype.setAggregationType=function(t,e){this.context.stx.layout.aggregationType==e?this.context.stx.setAggregationType(null):this.context.stx.setAggregationType(e)},n.c.UI.Layout.prototype.getAggregationEdit=function(t,e){var i=this.context.stx,s=n.c.deriveFromObjectChain(i.layout,e);n.c.UI.observeProperty(s.member,s.obj,(function(e){var n=e.value;!n&&i.chart.defaultChartStyleConfig[t.name]?t.value=i.chart.defaultChartStyleConfig[t.name]:t.value=n}))},n.c.UI.Layout.prototype.setAggregationEdit=function(t,e){var i=this.context.stx;function s(){i.changeOccurred("layout"),i.createDataSet(),i.draw()}if("auto"===e){"kagi"===i.layout.aggregationType?i.layout.kagi=null:"renko"===i.layout.aggregationType?i.layout.renko=null:"linebreak"===i.layout.aggregationType?i.layout.priceLines=null:"rangebars"===i.layout.aggregationType?i.layout.rangebars=null:"pandf"===i.layout.aggregationType&&(i.layout.pandf||(i.layout.pandf={box:null,reversal:null}),i.layout.pandf.box=null,i.layout.pandf.reversal=null),s();var a=$(t).offsetParent();$(a).find(".ciq"+i.layout.aggregationType+" input").each((function(){var t=this.name;"box"!=t&&"reversal"!=t||(t="pandf."+t);var e=n.c.deriveFromObjectChain(i.layout,t);e&&!e.obj[e.member]&&i.chart.defaultChartStyleConfig[this.name]&&$(this).val(i.chart.defaultChartStyleConfig[this.name])}))}else{var o=n.c.deriveFromObjectChain(i.layout,e);o.obj[o.member]=$(t.node).val(),s()}},n.c.UI.Layout.prototype.showAggregationEdit=function(t,e){const{context:i}=this;if(i.config){const{channelWrite:t}=n.c.UI.BaseComponent.prototype;t(i.config.channels.dialog,{type:"aggregation",params:{context:i,aggregationType:e}},i.stx)}else{document.querySelector("cq-aggregation-dialog").open({context:this.context,aggregationType:e})}},n.c.UI.Layout.prototype.clearStudies=function(t){if(n.c.Studies){var e=this.context.stx;for(var i in e.layout.studies){var s=e.layout.studies[i];s.customLegend||s.permanent||n.c.Studies.removeStudy(e,s)}e.draw()}},n.c.UI.Layout.prototype.setPeriodicity=function(t,e,i,n){var s=this;s.context.loader&&s.context.loader.show(),s.context.stx.setPeriodicity({period:e,interval:i,timeUnit:n},(function(){s.context.loader&&s.context.loader.hide()}))},n.c.UI.Layout.prototype.showPeriodicity=function(t,e){var i="",{period:s,interval:a,timeUnit:o}=t.getPeriodicity();i=s*=a,"day"==o?i+="D":"week"==o?i+="W":"month"==o?i+="M":"second"==o?i+="s":"millisecond"==o?i+="ms":s>=60&&s%15==0?i=s/60+"H":"tick"==o?i=(s>1?s:"")+"T":i+="m",$(e.selector).empty().append(n.c.translatableTextNode(t,i))},n.c.UI.Layout.prototype.periodicity=function(t){var e=this,i=this.context.stx,s=function(n){e.showPeriodicity(i,{selector:t})};n.c.UI.observeProperty("interval",i.layout,s),n.c.UI.observeProperty("periodicity",i.layout,s),n.c.UI.observeProperty("timeUnit",i.layout,s)},n.c.UI.Layout.prototype.setLanguage=function(){const{config:t,stx:e}=this.context;if(t){const{channelWrite:i}=n.c.UI.BaseComponent.prototype;i(t.channels.dialog,{type:"language"},e)}else document.querySelector("cq-language-dialog").open()},n.c.UI.Layout.prototype.getLanguage=function(t){this.context.stx;n.c.UI.observeProperty("language",n.c.I18N,(function(e){n.c.I18N.languages||(n.c.I18N.languages={en:"English"}),$(t).find("cq-language-name").text(n.c.I18N.languages[n.c.I18N.language]),$(t).find("cq-flag").attr("cq-lang",n.c.I18N.language)}))},n.c.UI.Markers=function(t,e){this.context=t,e||(e={}),this.menuItemSelector=e.menuItemSelector,this.activeClassName=e.activeClassName||"ciq-active",this.implementation=e.implementation,t.advertiseAs(this,"Markers")},n.c.inheritsFrom(n.c.UI.Markers,n.c.UI.Helper),n.c.UI.Markers.prototype.showMarkers=function(t,e,i){var n=this.activeClassName,s=this.context.topNode,a=this.implementation;a&&(a.showMarkers(),e&&a.showMarkers(e,i),$(this.menuItemSelector,s).each((function(){var e=$(this).find(".ciq-checkbox");t.node==this?$(this).addClass(n):e.length<1&&$(this).removeClass(n)})))},n.c.UI.Keystroke=function(t){this.cb=t,this.shift=!1,this.ctrl=!1,this.cmd=!1,this.capsLock=!1,this.downValue="",this.initialize()},n.c.UI.Keystroke.noKeyCapture=!1,n.c.UI.Keystroke.prototype.androidWorkaroundKeyup=function(t){var e,i=t.target.value;i.length>this.downValue.length?(e=i.charAt(i.length-1),t.which=e.charCodeAt(0)):e="Delete",this.key=e,this.cb({key:e,e:t,keystroke:this})},n.c.UI.Keystroke.prototype.keyup=function(t){if(this.implementAndroidWorkaround)return this.androidWorkaroundKeyup(t),void(this.implementAndroidWorkaround=!1);switch(t.key){case"Shift":return this.shift=!1,void this.cb({key:t.key,e:t,keystroke:this});case"Control":case"Alt":return this.ctrl=!1,void this.cb({key:t.key,e:t,keystroke:this});case"Meta":case"Win":return this.cmd=!1,void this.cb({key:t.key,e:t,keystroke:this})}this.key&&this.cb({key:this.key,e:t,keystroke:this})},n.c.UI.Keystroke.prototype.keydown=function(t){if(!this.noKeyCapture)if(229==t.which&&n.c.isAndroid)this.implementAndroidWorkaround=!0;else switch(this.key=t.key,t.key){case"Meta":case"Win":this.cmd=!0;break;case"Shift":this.shift=!0;break;case"Control":case"Alt":this.ctrl=!0;break;case"CapsLock":this.capsLock=!this.capsLock;break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"Up":case"Down":case"Left":case"Right":this.key=null,this.cb({key:t.key,e:t,keystroke:this})}},n.c.UI.Keystroke.prototype.keypress=function(t){if(!this.noKeyCapture){var e=t.which;e<32||e>222||(this.key=t.key)}},n.c.UI.Keystroke.prototype.initialize=function(){var t=this;$(document).on("keyup",(function(e){t.keyup(e)})),$(document).on("keydown",(function(e){t.downValue=e.target.value,t.keydown(e)})),$(document).on("keypress",(function(e){t.keypress(e)})),$(window).on("blur",(function(e){t.ctrl=!1,t.cb({key:"Control",e:e,keystroke:t})}))},n.c.UI.KeystrokeHub=function(t,e,i){t=$(t||"document"),this.infocus=!1;var s=this;t[0]===document||t[0]===document.body||t[0]===window?this.infocus=!0:(t.on("mouseout",(function(){s.infocus=!1})),t.on("mouseover",(function(){s.infocus=!0}))),this.node=t,this.context=e,this.params=i||{},this.uiManager=n.c.UI.getUIManager(),this.uiManager.keystrokeHub=this,this.keystroke=new n.c.UI.Keystroke((function(){s.handler.apply(s,arguments)}))},n.c.inheritsFrom(n.c.UI.KeystrokeHub,n.c.UI.Helper),n.c.UI.KeystrokeHub.defaultHotKeys=function(t,e){var i=e.context.stx,s=1;switch(t){case"ArrowUp":case"Up":i.allowZoom&&i.zoomIn();break;case"ArrowDown":case"Down":i.allowZoom&&i.zoomOut();break;case"Home":i.home(),i.headsUpHR();break;case"End":i.chart.scroll=i.chart.dataSet.length,i.draw(),i.headsUpHR();break;case"ArrowLeft":case"Left":i.ctrl?i.allowZoom&&i.zoomOut():i.allowScroll&&(s=1,(i.shift||e.capsLock)&&(s=Math.max(5,5*(8-Math.round(i.layout.candleWidth)))),i.chart.scroll+s>=i.chart.dataSet.length&&(s=i.chart.dataSet.length-i.chart.scroll),i.chart.scroll+=s,i.draw(),i.headsUpHR());break;case"ArrowRight":case"Right":i.ctrl?i.allowZoom&&i.zoomIn():i.allowScroll&&(s=1,(i.shift||e.capsLock)&&(s=Math.max(5,5*(8-Math.round(i.layout.candleWidth)))),i.chart.scroll-=s,i.draw(),i.headsUpHR());break;case"Delete":case"Backspace":case"Del":if(n.c.ChartEngine.drawingLine)i.undo();else{if(!i.anyHighlighted)return!1;i.deleteHighlighted()}break;case"Escape":case"Esc":n.c.ChartEngine.drawingLine?i.undo():e.uiManager&&e.uiManager.closeMenu();break;default:return!1}return!0},n.c.UI.KeystrokeHub.prototype.setActiveContext=function(t){this.context=t},n.c.UI.KeystrokeHub.prototype.processKeyStrokeClaims=function(t,e,i,n){for(var a=s.length-1;a>-1;a--){var o=s[a].helper.keyStroke(t,e,i,n);if(o)return o.allowDefault||i.preventDefault(),!0}return!1},n.c.UI.KeystrokeHub.prototype.handler=function(t){var e=this.context.stx;if(!e.editingAnnotation&&this.infocus){var i=t.e,s=t.key,a=t.keystroke,o=t.e.target.tagName;switch(s){case"Shift":e.shift=a.shift;break;case"Control":case"Alt":e.ctrl=a.ctrl;break;case"Meta":case"Win":e.cmd=a.cmd;break;case"CapsLock":this.capsLock=!this.capsLock}!n.c.ChartEngine.drawingLine&&this.processKeyStrokeClaims(this,s,i,a)||"Escape"!=i.key&&"Esc"!=i.key&&this.context.isModal()||"INPUT"!=o&&"TEXTAREA"!=o&&this.params.cb&&this.params.cb(s,this)&&i.preventDefault()}};class d extends HTMLElement{constructor(){super(),this.activeMenuStack=[],this.registeredForResize=[],this.keystrokehub=null,n.c.installTapEvent($("body")[0],{preventUnderlayClick:!1});var t=this;$("body").on("stxtap",(function(){t.closeTopMenu()}))}connectedCallback(){var t=this;this.resize=function(){for(var e=t.registeredForResize,i=0;i<e.length;i++)"function"==typeof e[i].resize&&e[i].resize()},window.addEventListener("resize",this.resize),document.body.contains(this)&&(n.c.UI.registerComponentsImmediately=!0,n.c.UI.ensureComponentsRegistered())}disconnectedCallback(){window.removeEventListener("resize",this.resize)}closeMenu(t){var e=this.activeMenuStack,i=$(t).parents("cq-menu"),n=[];if(t){n.push(t);for(var s=0;s<i.length;s++){var a=i[s];a.active&&n.push(a)}}else n=e;for(var o=0;o<n.length;o++)n[o].hide();this.activeMenuStack=e.filter((function(t){return t.active})),this.ifAllClosed()}closeTopMenu(){var t=this.activeMenuStack;if(t.length){var e=t[t.length-1],i=this;e.isDialog&&!e.active||(t.pop(),e.hide(),e.onClose&&e.onClose(),setTimeout((function(){i.ifAllClosed()}),0));var n=e.getAttribute("cq-close-top");n&&$(e).parents(n).each((function(){i.closeMenu(this)}))}}findLifts(t){return $(t).find("*[cq-lift]").filter((function(){var e=$(this).closest("cq-menu,cq-dialog");return e.length&&e[0]==t}))}ifAllClosed(){this.activeMenuStack.length||$("cq-context,*[cq-context]").each((function(){this.CIQ&&this.CIQ.UI&&this.CIQ.UI.context&&this.CIQ.UI.context.stx&&this.CIQ.UI.context.stx.modalEnd()}))}lift(t){var e=$(t);if(e.length){var i=$(e)[0];i.remember={parentNode:i.parentNode,css:{position:i.style.position,display:i.style.display,left:i.style.left,top:i.style.top,height:i.style.height,width:i.style.width,opacity:i.style.opacity}};var n=i.getBoundingClientRect(),s=e.prop("scrollHeight");e.detach(),e.prop("reduceMenuHeight",5),e.css({position:"absolute",display:"block",left:n.left+"px",top:n.top+"px",height:s+"px",opacity:1}),$("body").append(e),void 0!==i.resize&&i.resize(),e.find("cq-scroll").each((function(){this.resize()}))}}openMenu(t,e){setTimeout((function(){$(t).find("input[cq-focus]:first-child").focus()}),0),this.activeMenuStack.push(t),t.show(e),$("cq-context,*[cq-context]").each((function(){this.CIQ&&this.CIQ.UI&&this.CIQ.UI.context&&this.CIQ.UI.context.stx&&this.CIQ.UI.context.stx.modalBegin()}))}registerForResize(t){this.registeredForResize.push(t)}restoreLift(t){var e=$(t);if(e.length){var i=e[0].remember;e.detach(),e.css(i.css),$(i.parentNode).append(e)}}topMenu(){var t=this.activeMenuStack;return t.length?t[t.length-1]:null}unregisterForResize(t){for(var e=this.registeredForResize,i=0;i<e.length;i++)if(e[i]===t)return void e.splice(i,1)}}n.c.UI.UIManager=d,n.c.UI.getUIManager=function(){if(n.c.UI._uiManager)return n.c.UI._uiManager;let t=document.querySelector("cq-ui-manager");return t||(t=new n.c.UI.UIManager,t.connectedCallback()),n.c.UI._uiManager=t,t},customElements.define("cq-ui-manager",d);const{qs:h,qsa:p,channelWrite:u,channelRead:m,channelSubscribe:g}=n.c.UI.BaseComponent.prototype;n.c.UI.Chart=class{createChartAndUI({container:t,config:e}){t||(t=document.body),e&&!e.chartId&&(e.chartId=t.id);const i=function(t){if(t.nodeName.match(/cq-context/i)||t.getAttribute("cq-container"))return t;return t.querySelector("cq-context, [cq-context]")}(t),s=n.c.ChartEngine.create({container:h(".chartContainer",i),config:e,deferLoad:!0});n.c.UI.scrollbarStyling=e.scrollbarStyling,n.c.UI.ensureComponentsRegistered();const a=new n.c.UI.Context(s,i);return a.config=e,t.context=a,new n.c.UI.Layout(a),new n.c.UI.StudyEdit(null,a),this.initLookup(a),this.initContainerListeners(a),this.initEventMarkers(a),this.initDrawingTools(a),this.initDrawingEditListeners(a),this.initDialogHandler(a),this.initColorPicker(),this.initExtensions({stx:s,uiContext:a,config:e,type:"plugins"}),this.loadChart(a),e.language&&n.c.I18N.setLanguage(s,e.language),n.c.UI.BaseComponent.buildReverseBindings(i),n.c.UI.begin(),a}initContainerListeners(t){const{config:{channels:{breakpoint:e,sidenavSize:i,sidepanelSize:s,drawingPalettes:a,pluginPanelHeight:o}},stx:r,topNode:c}=t;n.c.UI.addResizeListener(c,()=>this.notifySizeChanges(t)),this.notifySizeChanges(t),g(e,this.breakpointSetter(t),r),g(i,this.sidenavSizeSetter(t),r),g(s,this.sidepanelSizeSetter(t),r),g(a,this.chartPositionSetter(t),r),g(o,this.chartAreaTopSetter(t),r);const l=this.initKeystrokeHub(t),d=this.getKeystrokeHubSetter(t,l);c.addEventListener("mouseover",d)}initLookup(t){const{config:e,topNode:i}=t;this.initKeystrokeHub(t),t.changeSymbol=function(t,i){const{stx:s,loader:a}=t;a&&a.show(),i.symbol==i.symbol.toLowerCase()&&(i.symbol=i.symbol.toUpperCase());const{removeSeries:o,loadError:r}=e.onNewSymbolLoad||{};o&&Object.values(s.chart.series).filter(o).forEach(t=>s.removeSeries(t.id)),s.loadChart(i,(function(i){a&&a.hide(),i?r&&r(i,t):e.restore&&n.c.ChartEngine.restoreDrawings(s,s.chart.symbol,e.chartId)}))};const s=p(e.selector.lookupComponent,i);e.lookupDriver&&s.length&&(t.setLookupDriver(new e.lookupDriver),s.forEach(e=>e.setCallback&&e.setCallback(t.changeSymbol)),t.UISymbolLookup=s)}initKeystrokeHub(t){return document.body.keystrokeHub||(document.body.keystrokeHub=new n.c.UI.KeystrokeHub(document.body,t,{cb:n.c.UI.KeystrokeHub.defaultHotKeys})),document.body.keystrokeHub}getKeystrokeHubSetter(t,e){return function(){e.context!==t&&(e.setActiveContext(t),p("cq-lookup").forEach(t=>t.removeAttribute("cq-keystroke-default")),h("cq-menu.ciq-search cq-lookup",t.topNode).setAttribute("cq-keystroke-default",""))}}initDialogHandler(t){const{config:{channels:e,dialogs:i},stx:s}=t;g(e.dialog,(function({type:t=null,params:e={}}={}){if(!t)return;const s=i[t]||i[n.c.makeCamelCase(t)];if(!s)return;let a=h(s.tag);if(!a){const t=function(){let t=h(".cq-dialogs");return t||(t=document.createElement("div"),t.classList.add("cq-dialogs"),document.body.append(t),t)}(),e=document.createElement("cq-dialog");a=document.createElement(s.tag),Object.entries(s.attributes||{}).forEach(([t,e])=>a.setAttribute(t,e)),e.append(a),t.append(e)}a&&a.open&&a.open(e)}),s)}initDrawingTools(t){const{stx:e,config:i,topNode:n}=t;g(i.channels.drawing,(function(t){n.classList[t?"add":"remove"]("toolbar-on"),e.resizeChart()}),e)}initDrawingEditListeners(t){const{config:e,stx:i}=t,s=new n.c.UI.DrawingEdit(null,t);let a=!0;const o=e.channels.drawing;s.node.addEventListener("drawing-edit-begin",(function(t){m(o,i)||(a=!1,u(o,!0,i))}),!1),s.node.addEventListener("drawing-edit-end",(function({detail:t}){a||("edit"!==t.action&&(a=!0),"close"===t.action&&u(o,!1,i))}),!1)}initColorPicker(){document.querySelector("cq-color-picker")||document.body.append(document.createElement("cq-color-picker"))}loadChart(t){const{stx:e,topNode:i,config:s,loader:a}=t;a&&a.show(),s.restore&&(n.c.ChartEngine.restorePreferences(e,s.chartId||i.id),n.c.ChartEngine.restoreLayout(e,(function(){a&&a.hide()}),s.chartId));const{initialSymbol:o}=s;if(o&&!e.chart.symbol){const e=t.UISymbolLookup;e&&e[0]&&e[0].selectItem&&e[0].selectItem("string"==typeof o?{symbol:o}:o)}e.termStructure&&e.setChartType("termstructure")}notifySizeChanges(t){const{stx:e,topNode:{clientWidth:i,clientHeight:n},config:{channels:s}}=t,a=m(s.containerSize,e);if(a&&a.width===i&&a.height===n)return;const o=this.getBreakpoint(i);u(s.breakpoint,o,e),u(s.containerSize,{width:i,height:n},e),e.resizeChart()}getBreakpoint(t){return t>700?"break-lg":t>584?"break-md":"break-sm"}initEventMarkers(t){const e=t.config;if(n.c.UI.Markers){const i=e.eventMarkersImplementation&&new e.eventMarkersImplementation(t.stx),s=e.selector.markersMenuItem;new n.c.UI.Markers(t,{menuItemSelector:s,implementation:i})}}initExtensions({stx:t,uiContext:e,config:i,type:s}){const a=i[s];Object.entries(a).filter(([,t])=>!!t).forEach(([i,a])=>{const o=a.moduleName||n.c.capitalize(i);try{if(!n.c[o])return void(n.c.debug&&console.log(`${o} not available for ${s} with params:`,a));const i=Object.assign({stx:t,context:e},a),r=new n.c[o](i);a.postInstall&&a.postInstall({uiContext:e,extension:r})}catch(t){n.c.debug&&console.error("Error configuring "+s+" using params ",a,"error",t)}})}chartPositionSetter(t){const e=h(".chartContainer",t.topNode);return function(t){if(!t)return;const{top:i,left:n}=t;e.style.marginTop=i+"px",e.style.marginLeft=n+"px"}}sidenavSizeSetter(t){const e=h(".ciq-chart-area",t.topNode),i=t.stx;return function(t){e.style.left=t+"px",i.resizeChart()}}chartAreaTopSetter(t){const e=h(".ciq-chart-area",t.topNode);return function(i){const n=Object.values(i||{}).reduce((t,e)=>t+e,0);e.style.marginTop=n+"px",t.stx.resizeChart()}}sidepanelSizeSetter(t){const e=h(".ciq-chart-area",t.topNode),i=h("cq-tradingcentral",t.topNode),n=t.stx;return function(t){e.style.right=t+"px",i&&(i.style.marginRight=t+"px"),n.resizeChart()}}breakpointSetter(t){return function(e){t.topNode.classList.remove("break-lg","break-md","break-sm"),t.topNode.classList.add(e)}}};let f=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{connectedCallback(){this.type=this.getAttribute("cq-type")||"helicopter",this.init()}init(){if(this.attached)return;const{markups:t}=this.constructor;this.addDefaultMarkup(this,t[this.type])}}i.markups={helicopter:'\n\t\t<div class="stx-marker-templates" style="left: -1000px; visibility:hidden;">\n\t\t\t\x3c!-- Abstract Markers. You can remove this unless you actually need a helicopter. Seriously though, markers can be anything you want them to be! --\x3e\n\t\t\t<div class="abstract">\n\t\t\t\t<div class="stx-marker abstract">\n\t\t\t\t\t<div class="stx-marker-content">\n\t\t\t\t\t\t<div class="sample">\n\t\t\t\t\t\t\t<div stage>\n\t\t\t\t\t\t\t\t<div helicopter>\n\t\t\t\t\t\t\t\t\t<div propeller style="height: 160px;">\n\t\t\t\t\t\t\t\t\t\t<div spinner style="-webkit-transform-origin: 40px 0 0; transform-origin: 40px 0 0;">\n\t\t\t\t\t\t\t\t\t\t\t<div style="-webkit-transform: rotateY(0deg) translateX(40px); transform: rotateY(0deg) translateX(40px);"></div>\n\t\t\t\t\t\t\t\t\t\t\t<div style="-webkit-transform: rotateY(-90deg) translateX(40px); transform: rotateY(-90deg) translateX(40px);"></div>\n\t\t\t\t\t\t\t\t\t\t\t<div style="-webkit-transform: rotateY(-180deg) translateX(40px); transform: rotateY(-180deg) translateX(40px);"></div>\n\t\t\t\t\t\t\t\t\t\t\t<div style="-webkit-transform: rotateY(-270deg) translateX(40px); transform: rotateY(-270deg) translateX(40px);"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div heli-body></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="text">This is an example of a complex marker which can contain html, video, images, css, and animations.</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t'},e.UI.addComponentDefinition("cq-abstract-marker",i)},v=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.Marker){class t extends e.UI.ModalTag{constructor(){super(),this.nameValueStore=e.NameValueStore&&new e.NameValueStore,this.nameValueStore||(this.nameValueStore={get:function(){},set:function(){}})}close(){this.node.css({display:"none"});var t=this;this.nameValueStore.get("cq-advertisement",(function(e,i){if(!e){var n=new Date;t.sleepAmount||(t.sleepAmount={units:1,unitType:"day"});var s=t.sleepAmount.units,a=t.sleepAmount.unitType;"minute"==a?n.setMinutes(n.getMinutes()+s):"hour"==a?n.setHours(n.getHours()+s):"day"==a?n.setDate(n.getDate()+s):"week"==a?n.setDate(n.getDate()+7*s):"month"==a&&n.setMonth(n.getMonth()+s);var o=n.getTime();i&&"object"==typeof i||(i={}),i[t.selector]=o,t.nameValueStore.set("cq-advertisement",i)}}))}makeMarker(){this.markerExists||(new e.Marker({stx:this.context.stx,xPositioner:"none",label:"advertisement",permanent:!0,node:this.node[0]}),this.markerExists=!0)}setNameValueStore(t){this.nameValueStore=t}setSleepAmount(t,e){this.sleepAmount={units:t,unitType:e}}show(t,e){this.selector&&this.node.find(this.selector).removeClass("ciq-show");if(this.selector=t,!this.selector){var i=this.node.find("div:first-of-type");this.selector="."+i.attr("class")}this.ignoreSleep=e;var n=this;function s(){n.makeMarker(),n.node.css({display:"block"}),n.node.find(n.selector).addClass("ciq-show"),n.node.css({height:"0px"}),setTimeout((function(){n.node.css({height:n.node[0].scrollHeight+"px"})}),0)}e?s():this.nameValueStore.get("cq-advertisement",(function(t,e){if(!t){e&&"object"==typeof e||(e={});var i=e[n.selector];i&&i>Date.now()||s()}}))}watchForRemoteClose(t){t||(t=1e3);var e=this;setInterval((function(){"none"!=e.node.css("display")&&e.nameValueStore.get("cq-advertisement",(function(t,i){if(!t){i&&"object"==typeof i||(i={});var n=i[e.selector];n&&n>Date.now()&&e.close()}}))}),t)}}e.UI.addComponentDefinition("cq-advertisement",t)}else console.error("advertisement component requires first activating markers feature.")},q=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{open(t){this.addDefaultMarkup(),super.open(t);var i=this.context.stx,n=t.aggregationType,s={kagi:{title:"Set Reversal Percentage"},renko:{title:"Set Brick Size"},linebreak:{title:"Set Price Lines"},rangebars:{title:"Set Range"},pandf:{title:"Set Point & Figure Parameters"}};i.layout.aggregationType!=n&&i.setAggregationType(n);var a=s[n],o=this.node;for(var r in o.find(".title").text(i.translateIf(a.title)),s)o.find(".ciq"+r).css(n===r?{display:""}:{display:"none"});o.find(".ciq"+n+" input").each((function(){var t=this.name;"box"!=t&&"reversal"!=t||(t="pandf."+t);var n=e.deriveFromObjectChain(i.layout,t);n&&(n.obj[n.member]||0===n.obj[n.member])?$(this).val(n.obj[n.member]):i.chart.defaultChartStyleConfig[this.name]&&$(this).val(i.chart.defaultChartStyleConfig[this.name])}))}}i.markup='\n\t\t<h4 class="title"></h4>\n\t\t<cq-close></cq-close>\n\t\t<div style="text-align:center;margin-top:10px;">\n\t\t\t<div class="ciqkagi">\n\t\t\t\t<i>Enter value and hit "Enter"</i>\n\t\t\t\t<p>\n\t\t\t\t\t<input name="kagi" stxtap="Layout.setAggregationEdit(\'kagi\')">\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class="ciqrenko">\n\t\t\t\t<i>Enter value and hit "Enter"</i>\n\t\t\t\t<p>\n\t\t\t\t\t<input name="renko" stxtap="Layout.setAggregationEdit(\'renko\')">\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class="ciqlinebreak">\n\t\t\t\t<i>Enter value and hit "Enter"</i>\n\t\t\t\t<p>\n\t\t\t\t\t<input name="priceLines" stxtap="Layout.setAggregationEdit(\'priceLines\')">\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class="ciqrangebars">\n\t\t\t\t<i>Enter value and hit "Enter"</i>\n\t\t\t\t<p>\n\t\t\t\t\t<input name="range" stxtap="Layout.setAggregationEdit(\'rangebars\')">\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class="ciqpandf">\n\t\t\t\t<i>Enter box size and hit "Enter"</i>\n\t\t\t\t<p>\n\t\t\t\t\t<input name="box" stxtap="Layout.setAggregationEdit(\'pandf.box\')">\n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t<i>Enter reversal and hit "Enter"</i>\n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t<input name="reversal" stxtap="Layout.setAggregationEdit(\'pandf.reversal\')">\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<p>or</p>\n\t\t\t<div class="ciq-btn" stxtap="Layout.setAggregationEdit(\'auto\')">Auto Select</div>\n\t\t</div>\n\n\t',e.UI.addComponentDefinition("cq-aggregation-dialog",i)},x=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.Marker){class t extends e.UI.ModalTag{constructor(){super(),this.messages={sources:{simulator:"Simulated data.",demo:"Demo data.",xignite:'<a target="_blank" href="https://www.xignite.com">Market Data</a> by Xignite.',fis_mm:'<a target="_blank" href="https://www.fisglobal.com/">Market Data</a> by FIS MarketMap.',Twiggs:'Twiggs MF Formula courtesy <a target="_blank" href="https://www.incrediblecharts.com/indicators/twiggs_money_flow.php">IncredibleCharts</a>.'},exchanges:{RANDOM:"Data is randomized.","REAL-TIME":"Data is real-time.",DELAYED:"Data delayed 15 min.",RATES:"Yield data latest from source, bid/ask simulated.",BATS:"BATS BZX real-time.",EOD:"End of day data."}}}insert(t,i){if(e.Marker){var n=e.UI.makeFromTemplate(this.template);return n.marker=new e.Marker({stx:t,node:n[0],xPositioner:"none",yPositioner:"none",label:"component",panelName:i,permanent:!0}),n}}setContext(t){this.addDefaultMarkup(),this.template=this.node.find("template");var i=this.insert(t.stx,"chart"),n=this;this.addInjection("append","createDataSet",(function(){var t,s;for(var a in this.chart.attribution&&((t=n.messages.sources[this.chart.attribution.source])||(t=""),(s=n.messages.exchanges[this.chart.attribution.exchange])||(s=""),t+s!=i.attr("lastAttrib")&&(i.find("cq-attrib-source").html(t),i.find("cq-attrib-quote-type").html(s),e.I18N&&e.I18N.translateUI(null,i[0]),i.attr("lastAttrib",t+s))),this.layout.studies){var o=this.layout.studies[a],r=o.type;if(n.messages.sources[r]){if(o.attribution&&o.attribution.marker.params.panelName==o.panel)continue;t=n.messages.sources[r]||"",s=n.messages.exchanges[r]||"";var c=n.insert(this,o.panel);c.find("cq-attrib-source").html(t),c.find("cq-attrib-quote-type").html(s),e.I18N&&e.I18N.translateUI(null,c[0]),o.attribution=c}}}))}}t.markup="\n\t\t<template>\n\t\t\t<cq-attrib-container>\n\t\t\t\t<cq-attrib-source></cq-attrib-source>&nbsp;\n\t\t\t\t<cq-attrib-quote-type></cq-attrib-quote-type>\n\t\t\t</cq-attrib-container>\n\t\t</template>\n\t",e.UI.addComponentDefinition("cq-attribution",t)}else console.error("attribution component requires first activating markers feature.")},y=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{setContext(){this.contextSet||(this.contextSet=!0,this.addDefaultMarkup())}}i.markup='\n\t\t<cq-study-legend cq-marker-label="Plots" cq-clone-to-panels="Plots" cq-panel-only cq-marker cq-hovershow cq-content-keys="cq-label,cq-comparison-label">\n\t\t\t<cq-comparison>\n\t\t\t\t<cq-comparison-key cq-panel-only cq-all-series>\n\t\t\t\t\t<template cq-comparison-item>\n\t\t\t\t\t\t<cq-comparison-item>\n\t\t\t\t\t\t\t<cq-swatch cq-overrides="auto"></cq-swatch>\n\t\t\t\t\t\t\t<cq-comparison-label>AAPL</cq-comparison-label>\n\t\t\t\t\t\t\t\x3c!-- cq-comparison-price displays the current price with color animation --\x3e\n\t\t\t\t\t\t\t<cq-comparison-price cq-animate></cq-comparison-price>\n\t\t\t\t\t\t\t\x3c!-- cq-comparison-tick-price displays the price for the active crosshair item --\x3e\n\t\t\t\t\t\t\t\x3c!-- <cq-comparison-tick-price></cq-comparison-tick-price>\t--\x3e\n\t\t\t\t\t\t\t<cq-comparison-loader></cq-comparison-loader>\n\t\t\t\t\t\t\t<div class="stx-btn-ico ciq-close"></div>\n\t\t\t\t\t\t</cq-comparison-item>\n\t\t\t\t\t</template>\n\t\t\t\t</cq-comparison-key>\n\t\t\t</cq-comparison>\n\t\t\t<template cq-study-legend>\n\t\t\t\t<cq-item>\n\t\t\t\t\t<cq-label></cq-label>\n\t\t\t\t\t<span class="ciq-edit"></span>\n\t\t\t\t\t<div class="ciq-icon ciq-close"></div>\n\t\t\t\t</cq-item>\n\t\t\t</template>\n\t</cq-study-legend>\n\t',e.UI.addComponentDefinition("cq-chart-legend",i)},b=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ModalTag{constructor(){super(),this.previousClose=null}begin(){var t=this;this.addDefaultMarkup(),this.addInjection("append","createDataSet",(function(){t.update()})),this.update()}disconnectedCallback(){this.context&&e.UI.unobserveProperty("symbolObject",this.context.stx.chart,this.listener),super.disconnectedCallback()}initialize(t){this.params=t||{},void 0===this.params.autoStart&&(this.params.autoStart=!0),this.marker=null,this.params.autoStart&&this.begin()}setContext(t){var i=this,n=this.context.stx;this.listener=function(t){i.previousClose=n.mostRecentClose("iqPrevClose")},e.UI.observeProperty("symbolObject",n.chart,this.listener),this.initialize()}update(){var t=this.context.stx,i=$(this),n=i.find("cq-symbol"),s=i.find("cq-symbol-description"),a=i.find("cq-current-price"),o=i.find("cq-todays-change"),r=i.find("cq-todays-change-pct"),c=i.find("cq-chart-price"),l=i.find("cq-change"),d=this.node.truthyAttr("cq-browser-tab"),h=c.length,p=t.chart.symbol,u=t.chart.symbolDisplay,m=t.internationalizer,g=!1;p?i.addClass("stx-show"):i.removeClass("stx-show");var f=n.textBetter(p);if(t.isHistoricalModeSet)return a.textBetter(""),void l.css({display:"none"});var v="",q=0,x="",y=t.getFirstLastDataRecord(t.chart.dataSet,"Close",!0),b="",C="";if(y&&(b=y.Close),h){""!==b&&(C=t.formatYAxisPrice(b,t.chart.panel,t.chart.decimalPlaces));var k=parseFloat(a.text());if(a.textBetter(C)){g=!0;var I=a.attr("cq-animate");void 0!==I&&e.UI.animatePrice(a,b,k,"fade"==I)}}if(s.textBetter(u||p),(h||d)&&p&&(f||g)){var w=y&&y.iqPrevClose;w||0===w||(w=this.previousClose),b||0===b?(q=(v=e.fixPrice(b-w))/w*100,x=w<=0||b<0?"N/A":m?m.percent2.format(q/100):q.toFixed(2)+"%",l.css({display:"block"})):l.css({display:"none"});var S=Math.abs(v),T=t.formatYAxisPrice(S,t.chart.panel,t.chart.decimalPlaces);S&&o.textBetter(T),r.length&&r.textBetter(x),""!==x&&v>0?c.removeClass("stx-down").addClass("stx-up"):""!==x&&v<0?c.removeClass("stx-up").addClass("stx-down"):c.removeClass("stx-down").removeClass("stx-up"),b=void 0!==b?b:"",v=void 0!==v?v:"",this.title=p+" ​ ​ "+C+" ​ ​ ​ ",v>0?this.title+="▲ "+T:v<0&&(this.title+="▼ "+T),d&&(document.title=this.title)}}}i.markup='\n\t\t<cq-symbol></cq-symbol>\n\t\t<cq-chart-price>\n\t\t\t<cq-current-price cq-animate></cq-current-price>\n\t\t\t<cq-change>\n\t\t\t\t<div class="ico"></div>\n\t\t\t\t<cq-todays-change></cq-todays-change> (\n\t\t\t\t<cq-todays-change-pct></cq-todays-change-pct>)\n\t\t\t</cq-change>\n\t\t</cq-chart-price>\n\t',e.UI.addComponentDefinition("cq-chart-title",i)},C=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ModalTag{connectedCallback(){this.attached||super.connectedCallback()}setContext(t){this.addDefaultMarkup();var e=this.node;e[0].addEventListener("touchstart",(function(t){t.stopPropagation()})),e[0].addEventListener("mousedown",(function(t){t.stopPropagation()})),e.find("input").stxtap((function(){this.focus()}))}}i.markup='\n\t\t<cq-menu class="ciq-search">\n\t\t\t<cq-lookup cq-keystroke-claim cq-uppercase></cq-lookup>\n\t\t</cq-menu>\n\t\t<cq-toggle class="ciq-draw" cq-member="drawing"><span></span><cq-tooltip>Draw</cq-tooltip></cq-toggle>\n\t\t<cq-toggle class="ciq-CH" cq-member="crosshair"><span></span><cq-tooltip>Crosshair</cq-tooltip></cq-toggle>\n\t\t<cq-menu class="ciq-menu ciq-period">\n\t\t\t<span><cq-clickable stxbind="Layout.periodicity">1D</cq-clickable></span>\n\t\t\t<cq-menu-dropdown>\n\t\t\t\t<cq-menu-container cq-name="menuPeriodicity"></cq-menu-container>\n\t\t\t</cq-menu-dropdown>\n\t\t</cq-menu>\n\t',e.UI.addComponentDefinition("cq-chartcontrol-group",i)},k=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{connectedCallback(){if(!this.attached){super.connectedCallback();var t=this;$(this).stxtap((function(){t.runMethod()}))}}runMethod(){var t=this.node.attr("cq-selector"),e=this.node.attr("cq-method");const{context:i}=this;if(/-dialog/.test(t)&&"open"===e&&i.config)this.channelWrite(i.config.channels.dialog,{type:t.replace(/cq-|-dialog/g,""),params:{context:i,caller:this}},i.stx);else{var n=this;$(t).each((function(){this[e]&&this[e].call(this,{context:n.context,caller:n})}))}}}e.UI.addComponentDefinition("cq-clickable",i)},I=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{connectedCallback(){if(!this.attached){var t=this;$(this).stxtap((function(){t.tap()})),super.connectedCallback()}}tap(){e.UI.containerExecute(this,"close")}}e.UI.addComponentDefinition("cq-close",i)},w=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ModalTag{constructor(){super(),this.swatchColors=[],this.loading=[]}connectedCallback(){this.attached||(super.connectedCallback(),this.swatchColors=["#8ec648","#00afed","#ee652e","#912a8e","#fff126","#e9088c","#ea1d2c","#00a553","#00a99c","#0056a4","#f4932f","#0073ba","#66308f","#323390"])}configureUI(){var t=this.node,i=t.find("cq-accept-btn");this.template=t.find("*[cq-comparison-item]");var n=t.find("cq-swatch").attr("cq-colors");n&&(this.swatchColors=n.split(","));for(var s=0;s<this.swatchColors.length;s++)this.swatchColors[s]=e.convertToNativeColor(this.swatchColors[s]);var a,o=t.find("cq-lookup");o.length&&o[0].setCallback((a=this,function(){a.selectItem.apply(a,arguments)})),i.stxtap((function(t){o[0].forceInput(),t.stopPropagation()}))}pickSwatchColor(){var t=$(this),i=this.context.stx,n=t.find("cq-swatch");if(n.length){var s=n[0].style.backgroundColor,a={};for(var o in i.chart.series){var r=i.chart.series[o];r.parameters.isComparison&&(a[e.convertToNativeColor(r.parameters.color)]=!0)}if(""===s||a[s])for(var c=0;c<this.swatchColors.length;c++)if(!a[this.swatchColors[c]])return void(n[0].style.backgroundColor=this.swatchColors[c])}}position(){var t=this.context.stx,e=t.barFromPixel(t.cx);this.tick=t.tickFromPixel(t.cx);var i=t.chart.xaxis[e],n=this;if(this.tick!=this.prevTick){this.timeout&&clearTimeout(this.timeout);this.timeout=setTimeout((function(){var e;for(var s in n.timeout=null,t.chart.series){e||(e=n.node.find("cq-comparison-key"));var a=e.find('cq-comparison-item[cq-symbol="'+s+'"] cq-comparison-tick-price');if(a.textBetter(""),a.length&&i&&i.data){var o=t.chart.series[s].parameters.symbol;a.textBetter(t.padOutPrice(i.data[o]));var r=i.data[o];null!==r&&("object"==typeof r&&(r=r.Close),a.textBetter(t.padOutPrice(r)))}}}),0)}this.prevTick=this.tick}removeSeries(t,e){this.context.stx.removeSeries(t)}renderLegend(){function t(t,e,i){return function(){t.nomore=!0,i.parameters.permanent||t.removeSeries(e,i),t.modalEnd()}}this.pickSwatchColor();var i=$(this),n=i.parents(".stx-holder")[0],s=i.find("cq-comparison-key").cqvirtual();if(s.length){var a=this.context.stx;a.getDefaultColor();var o=void 0!==s.attr("cq-panel-only"),r=void 0===s.attr("cq-all-series");for(var c in a.chart.seriesRenderers){var l=a.chart.seriesRenderers[c];if(l!=a.mainSeriesRenderer&&((!r||l.params.isComparison)&&(!o||n&&l.params.panel==n.panel.name)))for(var d=0;d<l.seriesParams.length;d++){var h=l.seriesParams[d],p=e.UI.makeFromTemplate(this.template),u=p.find("cq-comparison-swatch"),m=p.find("cq-swatch"),g=p.find("cq-comparison-label"),f=p.find("cq-comparison-description"),v=p.find("cq-comparison-loader"),q=p.find(".ciq-close"),x=a.chart.series[h.id],y=x.parameters,b=y.color||l.colors[x.id].color,C="auto"==b;C&&(b=a.defaultColor),u.css({background:b}),m.length&&(m[0].seriesId=h.id,m[0].setColor(b,!1,C)),y.opacity&&(u.css({opacity:y.opacity}),m.css({opacity:y.opacity})),g.text(a.translateIf(x.display)),f.text(a.translateIf(x.description)),p.attr("cq-symbol",x.id);var k=y.symbol,I=a.mostRecentClose(k);if(I||0===I){var w=p.find("cq-comparison-price");w.length&&w.text(a.padOutPrice(I))}this.loading[y.symbolObject.symbol]?v.addClass("stx-show"):v.removeClass("stx-show"),y.error&&p.attr("cq-error",!0),!y.color||y.permanent?q.hide():q.stxtap(t(this,x.id,x)),s.append(p)}}s.cqrender().parents("cq-study-legend").each((function(){this.displayLegendTitle&&this.displayLegendTitle()}))}}setColor(t,e){e.seriesId&&this.context.stx.modifySeries(e.seriesId,{color:t})}startPriceTracker(t){var e=this;this.addInjection("append","createDataSet",(function(){t&&e.updatePrices(),this.chart.dataSet&&this.chart.dataSet.length?e.node.attrBetter("cq-show"):e.node.removeAttrBetter("cq-show")}))}startTickPriceTracker(){var t;this.prevTick=null,this.addInjection("prepend","headsUpHR",(t=this,function(){t.position()}))}selectItem(t,e){var i=this;var n=this.node.find("cq-swatch"),s="auto",a=null,o=1;if(n[0]){var r=n[0].style;s=r.backgroundColor,a=r.borderTopStyle,o=r.width||1}var c=t.stx;this.loading[e.symbol]=!0;for(var l={name:"comparison "+e.symbol,symbolObject:e,isComparison:!0,color:s,pattern:a,width:o||1,data:{useDefaultQuoteFeed:!0},forceData:!0},d=c.getSeries({symbolObject:e}),h=0;h<d.length;h++)if(d[h].parameters.isComparison)return void(this.loading[e.symbol]=!1);e.symbol&&e.symbol.trim().length>0&&(!t.stx.chart.symbol||t.stx.chart.symbol.toLowerCase()!==e.symbol.toLowerCase())?c.addSeries(e.symbol,l,(function(t,e){t&&(e.parameters.error=!0),i.loading[e.parameters.symbolObject.symbol]=!1,i.renderLegend()})):this.loading[e.symbol]=!1}setContext(t){this.node.attr("cq-show","true"),this.configureUI();var i=this;this.context.stx.chart;function n(t){i.renderLegend()}if(this.eventListeners.push(this.context.stx.addEventListener("layout",n)),this.eventListeners.push(this.context.stx.addEventListener("theme",n)),this.context.stx.append("modifySeries",(function(){i.renderLegend()})),this.renderLegend(),this.template.length){var s=e.UI.makeFromTemplate(this.template);this.startPriceTracker(s.find("cq-comparison-price").length),s.find("cq-comparison-tick-price")&&this.startTickPriceTracker()}}updatePrices(){var t,i=this.context.stx,n=i.isHistoricalModeSet,s=e.ChartEngine.isDailyInterval(i.layout.interval);for(var a in i.chart.series){t||(t=this.node.find("cq-comparison-key"));var o=t.find('cq-comparison-item[cq-symbol="'+a+'"] cq-comparison-price');if(o.length){i.chart.series[a].parameters.symbol;var r=i.chart.series[a].lastQuote;if(!r||!r.DT||!r.Close&&0!==r.Close)continue;if(!s&&i.chart.market&&null===i.chart.market.getSession(r.DT))continue;var c=r.Close,l=i.chart.series[a].parameters.subField||"Close",d=parseFloat(o.text());if(c&&(c[l]||0===c[l])&&(c=c[l]),!c&&0!==c&&i.chart.series[a].lastQuote&&(c=i.chart.series[a].lastQuote[l]),o.textBetter(i.padOutPrice(n?"":c)),n)return;void 0!==o.attr("cq-animate")&&e.UI.animatePrice(o,c,d)}}}}e.UI.addComponentDefinition("cq-comparison",i)},S=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{setContext(){this.contextSet||(this.contextSet=!0,this.addDefaultMarkup())}}i.markup='\n\t\t<cq-comparison cq-marker>\n\t\t\t<cq-menu class="cq-comparison-new" cq-focus="input">\n\t\t\t\t<cq-comparison-add-label class="ciq-no-share">\n\t\t\t\t\t<cq-comparison-plus></cq-comparison-plus><span>Compare</span><span>...</span>\n\t\t\t\t</cq-comparison-add-label>\n\t\t\t\t<cq-comparison-add>\n\t\t\t\t\t<cq-comparison-lookup-frame>\n\t\t\t\t\t\t<cq-lookup cq-keystroke-claim cq-uppercase></cq-lookup>\n\t\t\t\t\t</cq-comparison-lookup-frame>\n\t\t\t\t\t<cq-swatch cq-no-close></cq-swatch>\n\t\t\t\t\t<span><cq-accept-btn class="stx-btn">ADD</cq-accept-btn></span>\n\t\t\t\t</cq-comparison-add>\n\t\t\t</cq-menu>\n\t\t</cq-comparison>\n\t',e.UI.addComponentDefinition("cq-comparison-lookup",i)},T=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{get active(){return this.context.stx.currentVectorParameters["active"+this._scope]}set active(t){this.context.stx.currentVectorParameters["active"+this._scope]=t}get color(){return this.context.stx.currentVectorParameters["color"+this._scope]}set color(t){this.context.stx.currentVectorParameters["color"+this._scope]=t}get lineWidth(){return this.context.stx.currentVectorParameters["lineWidth"+this._scope]}set lineWidth(t){this.context.stx.currentVectorParameters["lineWidth"+this._scope]=t}get pattern(){return this.context.stx.currentVectorParameters["pattern"+this._scope]}set pattern(t){this.context.stx.currentVectorParameters["pattern"+this._scope]=t}connectedCallback(){if(!this.attached){Object.defineProperty(this,"_scope",{configurable:!0,enumerable:!1,value:this.getAttribute("cq-cvp-header")||"",writable:!1});var t=$('template[cq-cvp-controller], template[cvp-controller="true"]');if(0===this.children.length&&t.length){e.UI.makeFromTemplate(t,this);var i=this.querySelector(".ciq-heading");i&&(i.innerHTML=this._scope)}super.connectedCallback()}}emit(t,e){this.toolbar?this.toolbar.emit(t,e):this.dispatchEvent(new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:e}))}getColor(t){var i=$(t.node||$(this).find("cq-line-color")),n=this.color;"transparent"!=n&&"auto"!=n||(n=""),$(i).css({background:n});var s=e.getBackgroundColor(this.parentNode);if(!n||Math.abs(e.hsl(s)[2]-e.hsl(n)[2])<.2){var a=e.chooseForegroundColor(s);i.css({border:"solid "+a+" 1px"}),n||i.css({background:"linear-gradient(to bottom right, "+a+","+a+" 49%, "+s+" 50%, "+s+")"})}else i.css({border:""})}pickColor(t){var e=$("cq-color-picker")[0],i=this,n=$(t.node).attr("cq-overrides");if(!e)return console.error("CVPController.prototype.pickColor: no <cq-color-picker> available");n&&(t.overrides=n.split(",")),e.callback=function(e){i.color=e,i.getColor(t),i.emit("change",{color:e})},t.context=this.context,e.display(t)}setContext(){this.setStyle()}setStyle(t,e,i){e=e||"1",i=i||"dotted",this.lineWidth=parseInt(e,10),this.pattern=i;var n=$(this).find("*[cq-cvp-line-style]");this.lineStyleClassName&&n.removeClass(this.lineStyleClassName),i&&"none"!==i?(this.lineStyleClassName="ciq-"+i+"-"+this.lineWidth,n.addClass(this.lineStyleClassName)):this.lineStyleClassName=null,this.emit("change",{lineWidth:e,pattern:i})}sync(t){var e=t["active"+this._scope],i=t["color"+this._scope],n=t["lineWidth"+this._scope],s=t["pattern"+this._scope],a=$(this).find(".ciq-checkbox");e?a.addClass("ciq-active"):a.removeClass("ciq-active"),this.active=!!e,this.color=i||"",this.getColor({}),this.setStyle(null,n,s)}toggleActive(t){var e=$(t.node);this.active?(this.active=!1,e.removeClass("ciq-active")):(this.active=!0,e.addClass("ciq-active")),this.emit("change",{active:this.active})}}e.UI.addComponentDefinition("cq-cvp-controller",i)},U=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{constructor(){super(),this.activeAttributes={}}connectedCallback(){if(!this.attached){this.isDialog=!0,super.connectedCallback();var t=this;this.node.stxtap((function(e){t.tap(e)}));var i=e.UI.getUIManager();i.registerForResize(this),this.uiManager=i}}disconnectedCallback(){this.uiManager.unregisterForResize(this),super.disconnectedCallback()}addActiveAttribute(t){this.activeAttributes[t]=!0}center(){var t=this.node.parent();"BODY"==t[0].tagName&&(t=$(window));var e=t.guaranteedWidth(),i=t.guaranteedHeight(),n=this.node.outerWidth(),s=this.node.outerHeight(),a=e/2-n/2,o=i/2-s/2;a<0&&(a=0),i>2*s&&o+s/2>i/3&&(o=i/3-s/2),o<0&&(o=0),this.node.css({top:o+"px",left:a+"px"})}close(){this.uiManager.closeMenu(this),this.onClose&&this.onClose()}hide(){if(!$(this).find(":invalid").length){for(var t in this.node.children().each((function(){"function"==typeof this.hide&&this.hide()})),this.active=!1,this.uiManager.overlay&&this.uiManager.overlay.removeAttrBetter("cq-active"),this.activeAttributes)this.node.removeAttrBetter(t);this.activeAttributes={},$(this).find("input").each((function(){this==document.activeElement&&this.blur()}))}}open(t){this.uiManager.openMenu(this,t);const{context:e}=t||{};if(!e||!e.config)return void(this.onClose=null);const{config:{channels:i},stx:n}=e;this.onClose=()=>{this.channelWrite(i.dialog,{},n),this.onClose=null}}resize(){this.params&&this.params.x?this.stxContextMenu():this.center(),$(this.node).find("cq-scroll").each((function(){this.resize&&this.resize()}))}show(t){this.params=t,t||(t=this.params={});var i=this;if(!this.uiManager.overlay&&!t.bypassOverlay){this.uiManager.overlay=$("<cq-dialog-overlay></cq-dialog-overlay>");var n=t.context||e.UI.getMyContext(this);n&&n.node.append(this.uiManager.overlay)}i.active=!0,setTimeout((function(){for(var e in i.uiManager.overlay&&!t.bypassOverlay&&i.uiManager.overlay.attrBetter("cq-active"),i.activeAttributes["cq-active"]=!0,i.activeAttributes)i.node.attrBetter(e);i.resize()}))}stxContextMenu(){var t=this.node.parent();"BODY"==t[0].tagName&&(t=$(window));var e=t.guaranteedWidth(),i=t.guaranteedHeight(),n=this.node.outerWidth(),s=this.node.outerHeight(),a=this.params.x,o=this.params.y,r=!1;this.node.find("cq-menu.stxMenuActive:has(.context-menu-right)").each((function(){var t=$(this),e=t.find(".context-menu-right"),i=t.nextAll().length+1;n+=e.outerWidth(),s+=e.outerHeight()-t.outerHeight()*i,r=!0})),a+n>e&&(a=e-n),o+s>i&&(o=i-s),o<0&&(o=0),r&&(this.params.x=a,this.params.y=o),this.node.css({top:o+"px",left:a+"px"})}tap(t){this.uiManager.topMenu()!==this&&t.currentTarget.active||t.stopPropagation()}}e.UI.addComponentDefinition("cq-dialog",i)},D=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{open(t){this.addDefaultMarkup(),this.drawing=t.drawing;var e=$(this).find("[cq-edit-text]");return this.drawing.edit?e.show():e.hide(),super.open(t)}}i.markup='\n\t\t<div stxtap="DrawingEdit.text()" cq-edit-text>Edit Text</div>\n\t\t<div stxtap="DrawingEdit.edit()">Edit Settings</div>\n\t\t<div stxtap="DrawingEdit.clone()">Clone Drawing</div>\n\t\t<cq-menu stxtap="resize()" cq-close-top="cq-dialog[cq-drawing-context]">\n\t\t\t<cq-menu-dropdown cq-no-scroll="true" class="context-menu-right">\n\t\t\t\t<cq-item stxtap="DrawingEdit.reorderLayer(\'top\')">Bring to Top</cq-item>\n\t\t\t\t<cq-item stxtap="DrawingEdit.reorderLayer(\'up\')">Bring Forward</cq-item>\n\t\t\t\t<cq-item stxtap="DrawingEdit.reorderLayer(\'down\')">Send Backward</cq-item>\n\t\t\t\t<cq-item stxtap="DrawingEdit.reorderLayer(\'bottom\')">Send to Bottom</cq-item>\n\t\t\t</cq-menu-dropdown>\n\t\t\t\x3c!-- element here so that <cq-menu-dropdown> can keep "top: auto;" --\x3e\n\t\t\t<div>Layer Management<div class="context-button-right-arrow"></div></div>\n\t\t</cq-menu>\n\t\t<div stxtap="DrawingEdit.remove()">Delete Drawing</div>\n\t',e.UI.addComponentDefinition("cq-drawing-context",i)},M=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{add(){var t=$(this).find("[cq-custom-fibonacci-setting] input").val();if(t&&(t=parseFloat(t)/100,!isNaN(t))){for(var i,n,s=this.context.stx.currentVectorParameters.fibonacci.fibs||[],a=0;a<s.length;a++)if((i=s[a]).level>t){(n=e.clone(i)).level=t,n.display=!0,s.splice(a,0,n);break}n||(i=s.length?e.clone(s[0]):{color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},(n=e.clone(i)).level=t,n.display=!0,s.push(n)),this.open()}}close(){if(this.opener){var t=new Event("change",{bubbles:!0,cancelable:!0});this.opener.dispatchEvent(t),this.context.stx.currentVectorParameters.fibonacci.fibsAlreadySet=!0}super.close()}open(t){this.addDefaultMarkup(),super.open(t),t&&(this.opener=t.caller);var i,n=this.context.stx.currentVectorParameters,s=n.vectorType,a=$(this);if(n.fibonacci&&"fibtimezone"!=s){a.find(".title").text("Fibonacci Settings");var o=n.fibonacci.fibs||[];(i=a.find("cq-fibonacci-settings")).emptyExceptTemplate();for(var r=0;r<o.length;r++){var c=o[r];if(!("fibarc"===s&&c.level<0)){var l=e.UI.makeFromTemplate(this.node.find("template"),i),d=100*c.level;l.find(".ciq-heading").text(d.toFixed(1)+"%");var h=l.find("input");c.display&&h.prop("checked",!0),this.setChangeEvent(h,"fib",c.level),l.find(".stx-data").append(h)}}}else a.find(".title").text("Settings"),(i=a.find("cq-fibonacci-settings")).emptyExceptTemplate();$(this).find("[cq-custom-fibonacci-setting] input").val("")}setChangeEvent(t,e,i){var n=this;t.change((function(){var t=n.context.stx.currentVectorParameters,e=t.vectorType;if(t.fibonacci&&"fibtimezone"!=e){var s=t.fibonacci.fibs||[];if("checkbox"==this.type)for(var a=0;a<s.length;a++){var o=s[a];o.level===i&&(o.display=!!this.checked)}}}))}}i.markup='\n\t\t<h4 class="title">Settings</h4>\n\t\t<cq-scroll cq-no-maximize>\n\t\t\t<cq-fibonacci-settings>\n\t\t\t\t<template cq-fibonacci-setting>\n\t\t\t\t\t<cq-fibonacci-setting>\n\t\t\t\t\t\t<div class="ciq-heading"></div>\n\t\t\t\t\t\t<div class="stx-data">\n\t\t\t\t\t\t\t<input type="checkbox">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</cq-fibonacci-setting>\n\t\t\t\t</template>\n\t\t\t</cq-fibonacci-settings>\n\t\t\t<div cq-custom-fibonacci-setting>\n\t\t\t\t<input class="ciq-heading" type="text">%\n\t\t\t\t<div class="ciq-btn stx-data" stxtap="add()">Add</div>\n\t\t\t</div>\n\t\t</cq-scroll>\n\t\t<div class="ciq-dialog-cntrls">\n\t\t\t<div class="ciq-btn" stxtap="close()">Done</div>\n\t\t</div>\n\t',e.UI.addComponentDefinition("cq-fib-settings-dialog",i)},L=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{connectedCallback(){this.attached||(this.innerHTML=this.render(),this.generateTable(2,2),this.highlightTable(1,1))}get maxcols(){return this.getAttribute("maxcols")||4}set maxcols(t){this.setAttribute("maxcols",t)}get maxrows(){return this.getAttribute("maxrows")||4}set maxrows(t){this.setAttribute("maxrows",t)}generateTable(t,e){var i=this;function n(t){let e=parseInt(t.target.dataset.column)+1;e>i.maxcols&&(e=i.maxcols);let n=parseInt(t.target.dataset.row)+1;n>i.maxrows&&(n=i.maxrows),i.generateTable(e,n),i.highlightTable(parseInt(t.target.dataset.column),parseInt(t.target.dataset.row))}let s=this.querySelector("table");if(s){this.cleanTable(t,e),t=t||1,e=e||1;for(let i=1;i<=e;i++){let a;s.childNodes[i-1]?a=s.childNodes[i-1]:(a=document.createElement("tr"),s.appendChild(a));for(let s=1;s<=t;s++)if(!a.childNodes[s-1]){let o=document.createElement("td");o.dataset.row=i,o.dataset.column=s,o.dataset.rows=e,o.dataset.columns=t,o.addEventListener("mouseenter",n),o.addEventListener("click",function(t){this.triggerUpdateGridEvent(t.target.dataset.column,t.target.dataset.row)}.bind(this)),o.appendChild(document.createElement("div")),a.appendChild(o)}}}}triggerUpdateGridEvent(t,e){document.querySelector("body").dispatchEvent(new CustomEvent("update-grid",{detail:{columns:t,rows:e},bubbles:!0,composed:!0}))}highlightTable(t,e){for(let i of this.querySelectorAll("td"))i.dataset.column<=t&&i.dataset.row<=e?i.classList.add("highlight"):i.classList.remove("highlight");this.querySelector(".row.count").innerHTML=e,this.querySelector(".column.count").innerHTML=t}cleanTable(t,e){let i=this.querySelector("table");for(;i.childNodes.length>e;)i.removeChild(i.lastChild);for(let e of i.childNodes)for(;e.childNodes.length>t;)e.removeChild(e.lastChild)}render(){return'\n\t\t\t\t<style>\n\t\t\t\t\tcq-grid-size-picker, cq-grid-size-picker tr, cq-grid-size-picker td{\n\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t}\n\n\t\t\t\t\tcq-grid-size-picker tr{\n\t\t\t\t\t\tmargin: 0;\n\t\t\t\t\t\tpadding: 0;\n\t\t\t\t\t\twhite-space: nowrap;\n\t\t\t\t\t\tline-height: 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tcq-grid-size-picker td{\n\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\theight: 19px;\n\t\t\t\t\t\twidth: 19px;\n\t\t\t\t\t\tmargin: 0;\n\t\t\t\t\t\tpadding: 0;\n\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t}\n\n\t\t\t\t\tcq-grid-size-picker td div{\n\t\t\t\t\t\tpointer-events: none;\n\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\theight: 15px;\n\t\t\t\t\t\twidth: 15px;\n\t\t\t\t\t\tmargin: 2px;\n\t\t\t\t\t\tpadding: 0;\n\t\t\t\t\t\tborder: solid 1px #ccc;\n\t\t\t\t\t\tborder-color: var(--grid-size-border-color, #ccc);\n\t\t\t\t\t\tbackground: #eee; /* keep a hard coded style in case the var function is unavailable */\n\t\t\t\t\t\tbackground-color: var(--grid-size-background-color, #eee);\n\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t}\n\n\t\t\t\t\tcq-grid-size-picker td:hover div, cq-grid-size-picker td.highlight div{\n\t\t\t\t\t\tborder-color: #666;\n\t\t\t\t\t\tborder-color: var(--grid-size-border-hl-color, #666);\n\t\t\t\t\t\tbackground: #ccc;\n\t\t\t\t\t\tbackground-color: var(--grid-size-background-hl-color, #ccc);\n\t\t\t\t\t}\n\n\t\t\t\t\tcq-grid-size-picker p{\n\t\t\t\t\t\twidth:100%;\n\t\t\t\t\t\tline-height: 1em;\n\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\tmargin: 5px 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tcq-grid-size-picker .multiply{\n\t\t\t\t\t\ttransform: rotate(45deg);\n\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t}\n\t\t\t\t</style>\n\n\t\t\t\t<table class="grid-size-picker"></table>\n\t\t\t\t<p><span class="row count">1</span> <span class="multiply">+</span> <span class="column count">1</span></p>\n\t\t\t'}}e.UI.addComponentDefinition("cq-grid-size-picker",i)},E=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{setContext(){if(!this.hasAttribute("cq-filter"))return;const t=this.getAttribute("cq-filter")||"Search";this.createFilter(t)}createFilter(t){const e=document.createElement("div");e.classList.add("searchFilter"),this.appendChild(e);const i=document.createElement("input");i.type="search",i.placeholder=t,e.appendChild(i),this.searchWrapper=e;const n=this.nextElementSibling,s=({target:{value:t}})=>{const e=new RegExp(t,"i");this.qsa("cq-item",n).forEach(i=>{const n=t&&!e.test(i.textContent)?"add":"remove";i.classList[n]("item-hidden")})};i.addEventListener("input",s),i.addEventListener("keyup",s);const a=this.getAttribute("cq-filter-min")||15,o=()=>{const t=this.qsa("cq-item",n).length;e.classList[t>a?"add":"remove"]("active")};void 0!==typeof MutationObserver?(new MutationObserver(o).observe(this.parentElement,{childList:!0,subtree:!0}),o()):e.classList.add("active")}}e.UI.addComponentDefinition("cq-heading",i)},A=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{setContext(t){this.addDefaultMarkup();const i=new e.UI.HeadsUp(this,t,{followMouse:!0,autoStart:!1});let n=t.config?t.config.channels.headsUp:"layout.headsUp";this.channelSubscribe(n,t=>i["dynamic"===t?"begin":"end"]())}}i.markup='\n\t\t<svg version="1.1" x="0px" y="0px" viewBox="0 0 215 140" enableBackground="new 0 0 215 140">\n\t\t\t<defs>\n\t\t\t\t<filter id="ciq-hu-shadow" height="130%">\n\t\t\t\t\t<feGaussianBlur in="SourceAlpha" stdDeviation="1"></feGaussianBlur>\n\t\t\t\t\t<feOffset dx="0" dy="1" result="offsetblur"></feOffset>\n\t\t\t\t\t<feComponentTransfer>\n\t\t\t\t\t\t<feFuncA type="linear" slope="0.2"></feFuncA>\n\t\t\t\t\t</feComponentTransfer>\n\t\t\t\t\t<feMerge>\n\t\t\t\t\t\t<feMergeNode></feMergeNode>\n\t\t\t\t\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t\t\t\t\t</feMerge>\n\t\t\t\t</filter>\n\t\t\t</defs>\n\t\t\t<polygon\n\t\t\t\tclass="ciq-hu-bg" style="stroke-width: 1;"\n\t\t\t\tpoints="198.4,124.4 1,124.4 1,1 214,1 214,137.8"\n\t\t\t\tfilter="url(#ciq-hu-shadow)"\n\t\t\t\t/>\n\t\t\t<path class="ciq-hu-stroke"\n\t\t\t\tfill="#398DFF"\n\t\t\t\td="M213,2v133.6l-13.7-11.8l-0.6-0.5H198H2V2H213 M215,0H0v125.4h198l17,14.6V0L215,0z">\n\t\t\t</path>\n\t\t</svg>\n\t\t<div>\n\t\t\t<cq-hu-col1>\n\t\t\t\t<cq-hu-date></cq-hu-date>\n\t\t\t\t<cq-hu-price></cq-hu-price>\n\t\t\t\t<cq-volume-grouping>\n\t\t\t\t\t<div>Volume</div>\n\t\t\t\t\t<div><cq-volume-visual></cq-volume-visual></div>\n\t\t\t\t\t<div><cq-hu-volume></cq-hu-volume><cq-volume-rollup></cq-volume-rollup></div>\n\t\t\t\t</cq-volume-grouping>\n\t\t\t</cq-hu-col1>\n\t\t\t<cq-hu-col2>\n\t\t\t\t<div>Open</div><cq-hu-open></cq-hu-open>\n\t\t\t\t<div>Close</div><cq-hu-close></cq-hu-close>\n\t\t\t\t<div>High</div><cq-hu-high></cq-hu-high>\n\t\t\t\t<div>Low</div><cq-hu-low></cq-hu-low>\n\t\t\t</cq-hu-col2>\n\t\t</div>\n\t',e.UI.addComponentDefinition("cq-hu-dynamic",i)},P=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{setContext(t){this.addDefaultMarkup();const i=new e.UI.HeadsUp(this,t,{autoStart:!0});let n=t.config?t.config.channels.headsUp:"layout.headsUp";this.channelSubscribe(n,t=>i["static"===t?"begin":"end"]())}}i.markup="\n\t\t<div>\n\t\t\t<div>Price</div><cq-hu-price></cq-hu-price>\n\t\t\t<div>Open</div><cq-hu-open></cq-hu-open>\n\t\t\t<div>Close</div><cq-hu-close></cq-hu-close>\n\t\t</div>\n\t\t<div>\n\t\t\t<div>Vol</div>\n\t\t\t<cq-volume-section>\n\t\t\t\t<cq-hu-volume></cq-hu-volume>\n\t\t\t\t<cq-volume-rollup></cq-volume-rollup>\n\t\t\t</cq-volume-section>\n\t\t\t<div>High</div><cq-hu-high></cq-hu-high>\n\t\t\t<div>Low</div><cq-hu-low></cq-hu-low>\n\t\t</div>\n\t",e.UI.addComponentDefinition("cq-hu-static",i)},z=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{setContext(t){let i=this.constructor.markup;const n=this.getAttribute("cq-toggles");n&&(i=i.replace(/dynamic,static,null/,n)),this.addDefaultMarkup(this,i),this.tooltip=this.querySelector("cq-tooltip");let s=t.config?t.config.channels:{headsUp:"layout.headsUp",crosshair:"layout.crosshair"};this.channelSubscribe(s.headsUp,()=>this.applyValues(s)),this.channelSubscribe(s.crosshair,t=>{(e.isMobile||t)&&"dynamic"===this.channelRead(s.headsUp)&&setTimeout(()=>this.channelWrite(s.headsUp,"static"))}),this.initInfoComponents(t)}setTooltip(t){const{context:{stx:e},tooltip:i}=this;i.innerText=e.translateIf("Info "+(t||"off"))}initInfoComponents(t){const e=this.querySelector("cq-toggle").getAttribute("cq-toggles");["dynamic","static"].forEach((function(i){if(new RegExp(i).test(e)&&!t.topNode.querySelector("cq-hu-"+i)){const e=document.createElement("cq-hu-"+i);t.topNode.append(e)}}))}applyValues(t){const i=this.channelRead(t.crosshair),n=this.channelRead(t.headsUp);"dynamic"===n&&(i||e.isMobile)&&setTimeout(()=>this.channelWrite(t.headsUp,"static")),e.isMobile&&"static"===n&&setTimeout(()=>this.channelWrite(t.crosshair,!0)),this.setTooltip(n)}}i.markup='\n\t\t<cq-toggle\n\t\t\tclass="ciq-HU"\n\t\t\tcq-member="headsUp"\n\t\t\tcq-toggles="dynamic,static,null">\n\t\t\t<span></span>\n\t\t\t<cq-tooltip>Info</cq-tooltip>\n\t\t</cq-toggle>\n\t',e.UI.addComponentDefinition("cq-info-toggle",i)},N=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;let i=!1;class n extends HTMLElement{connectedCallback(){if(this.hasAttribute("attached"))return;this.setAttribute("attached","");var t=this;const n=this.getAttribute("env-container")||"body",s=this.getAttribute("tmpl-src");var a=this.querySelector("cq-context");a||(a=this.appendChild(document.createElement("cq-context")));const o=this.hasAttribute("no-save");this.style.visibility="hidden",e.loadUI(s,a,(function(e){if(e)return;var s=t.querySelector("cq-chart-title");s&&s.removeAttribute("cq-browser-tab");for(var a=t.querySelectorAll("cq-ui-manager, cq-dialog, cq-color-picker"),r=0;r<a.length;r++){var c=a[r];c.parentNode.removeChild(c),i||document.querySelector(n).appendChild(c)}i=!0;const l={extendedHours:!0,rangeSlider:!0,inactivityTimer:!0,fullScreen:!1,initialSymbol:t.getAttribute("symbol")||void 0,restore:!o};t.signalEvent=new CustomEvent("signal-chart-ready",{detail:{node:t,params:l}}),t.setAttribute("cq-event-flag",""),t.style.visibility="",document.body.dispatchEvent(t.signalEvent)}))}disconnectedCallback(){this.stx.destroy()}}customElements.define("cq-instant-chart",n)},Q=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.I18N){class t extends e.UI.DialogContentTag{close(){$("cq-language-dialog").closest("cq-dialog,cq-menu").each((function(){this.close()}))}open(t){this.addDefaultMarkup(),super.open(t);var i=this.node.find("cq-languages");i.emptyExceptTemplate();var n=this.node.find("template"),s=e.I18N.languages;if(s)for(var a in s){var o=e.UI.makeFromTemplate(n,i);o.find("cq-language-name").text(s[a]),o.find("cq-flag").attr("cq-lang",a),o.stxtap(r(a))}function r(t){return function(){e.UI.contextsForEach((function(){var i=this.stx;i.preferences.language=t,i.changeOccurred("preferences"),e.I18N.localize(i,t),i.draw()}))}}}}t.markup='\n\t\t<h4 class="title">Choose language</h4>\n\t\t<cq-close></cq-close>\n\t\t<cq-languages>\n\t\t\t<template><div><cq-flag></cq-flag><cq-language-name></cq-language-name></div></template>\n\t\t</cq-languages>\n\t',e.UI.addComponentDefinition("cq-language-dialog",t)}else console.error("languageDialog component requires first activating i18n feature.")},V=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{setContext(t){this.context.setLoader(this)}show(){$(this).addClass("stx-show")}hide(){$(this).removeClass("stx-show")}}e.UI.addComponentDefinition("cq-loader",i)},F=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.ChartEngine.Driver)if(e.ChartEngine.Driver.Lookup){class t extends e.UI.ContextTag{constructor(){super(),this.usingEmptyDriver=!1,this.currentFilter=null,this.params={}}acceptText(t,i){var n=this;this.params.driver||(this.context.lookupDriver?this.setDriver(this.context.lookupDriver):(this.setDriver(new e.ChartEngine.Driver.Lookup),this.usingEmptyDriver=!0));var s=this.params.driver.exchanges;var a=this.getAttribute("cq-exchanges");a&&(this.params.driver.exchanges=a.split(",")),this.params.driver.acceptText(t,i,null,(function(t){n.params.driver.exchanges=s,n.results(t)}))}attachDriver(t){this.driver=t}close(){this.node.closest("cq-dialog,cq-menu").each((function(){this.close()}))}forceInput(){var t=this.input[0];this.selectItem({symbol:t.value}),e.blur(this.input),this.close(),t.value=""}initialize(){this.addDefaultMarkup();var t=$(this);this.resultList=t.find("cq-scroll"),this.input=t.find("input"),this.input.length||(this.input=t.append($("<input type='hidden'>")),this.input[0].value=""),this.input.stxtap((function(){this.focus()}));var e=this;this.input.on("paste",(function(t){var i=t.target;setTimeout((function(){e.acceptText(i.value,e.currentFilter)}),0)}));var i=t.find("cq-lookup-filters");i&&i.find("cq-filter").stxtap((function(){i.find("cq-filter").removeClass("true");var t=$(this);t.addClass("true");var n=t.find("translate");n.length?e.currentFilter=n.attr("original"):e.currentFilter=this.innerHTML,e.acceptText(e.input[0].value,e.currentFilter)})),void 0!==t.attr("cq-keystroke-claim")&&this.addClaim(this)}isActive(){return""!==this.input[0].value}keyStroke(t,i,n,s){if(s.ctrl||"Meta"==i||"Win"==i)return!1;var a=$(this).parents().addBack(),o=this.input[0],r=!1,c=document.activeElement===o;if(!c&&(n.altKey||document.activeElement&&("INPUT"==document.activeElement.tagName||"TEXTAREA"==document.activeElement.tagName)))return!1;var l=!1,d=!1;if(a.hasClass("stxMenuActive")&&(d=!0),(c||d)&&(l=!0),!l){if(void 0===this.node.attr("cq-keystroke-default"))return;if(!d&&this.uiManager.topMenu())return}if((" "===i||"Spacebar"===i)&&""===o.value)return!1;if(s.key&&1==s.key.length&&n.which>=32&&n.which<=222&&(c||(o.value=o.value+s.key),this.acceptText(o.value,this.currentFilter),r=!0),"Delete"==i||"Backspace"==i||"Del"==i){if(this.context.stx.anyHighlighted)return!1;o.value.length&&(window.getSelection().toString()?o.value="":(c||(o.value=o.value.substring(0,o.value.length-1)),o.value.length&&this.acceptText(o.value,this.currentFilter)),r=!0),"Backspace"==i&&(r=!0)}if("Escape"!==i&&"Esc"!==i||!d||(o.value="",this.close(),e.blur(o),r=!0),"Enter"===i&&""!==o.value&&this.isActive()){var h=this.node.find("cq-scroll");if((c=h.length&&h[0].focused())&&c.selectFC)c.selectFC.apply(c,{});else{var p=o.value;this.node.truthyAttr("cq-uppercase")&&(p=p.toUpperCase()),this.selectItem({symbol:p})}e.blur(this.input),this.close(),o.value="",r=!0}return r?(!this.usingEmptyDriver&&(o.value.length||"Escape"!=i&&"Esc"!=i&&"Enter"!=i&&c)?this.open():this.close(),!c||{allowDefault:!0}):void 0}open(){this.node.closest("cq-dialog,cq-menu").each((function(){this.open()}))}results(t){function i(t,i){return function(n){e.blur(t.input),t.selectItem(i),t.input[0].value=""}}this.resultList.empty();for(var n=0;n<t.length;n++){for(var s=t[n],a="<cq-item>",o=0;o<s.display.length;o++)a+="<SPAN>"+s.display[o]+"</SPAN>";a+="</cq-item>";var r=$(a);this.resultList.append(r),r[0].selectFC=i(this,s.data),r.stxtap(r[0].selectFC)}var c=this.node.find("cq-scroll");c.length&&c[0].top()}selectItem(t,e){this.params.cb&&this.params.cb(this.context,t,e)}setCallback(t){this.params.cb=t}setContext(t){this.initialize();const e=this.querySelector("cq-lookup-input input"),{config:i,stx:n}=t;i&&(this.channelSubscribe(i.channels.breakpoint,t=>{var i=n.termStructure?"Entity":"Symbol";"break-lg"===t&&(i="Enter "+i),e.setAttribute("placeholder","break-sm"===t?"":i)}),!this.params.cb&&t.changeSymbol&&(this.params.cb=t.changeSymbol))}setDriver(t){this.params.driver=t}}t.markup='\n\t\t<cq-lookup-input cq-no-close>\n\t\t\t<input type="text" spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="none" name="symbol" placeholder="">\n\t\t\t<cq-lookup-icon></cq-lookup-icon>\n\t\t</cq-lookup-input>\n\t\t<cq-lookup-results>\n\t\t\t<cq-lookup-filters cq-no-close>\n\t\t\t\t<cq-filter class="true">ALL</cq-filter>\n\t\t\t\t<cq-filter>STOCKS</cq-filter>\n\t\t\t\t<cq-filter>FX</cq-filter>\n\t\t\t\t<cq-filter>INDEXES</cq-filter>\n\t\t\t\t<cq-filter>FUNDS</cq-filter>\n\t\t\t\t<cq-filter>FUTURES</cq-filter>\n\t\t\t</cq-lookup-filters>\n\t\t\t<cq-scroll></cq-scroll>\n\t\t</cq-lookup-results>\n\t',e.UI.addComponentDefinition("cq-lookup",t)}else console.error("lookup component requires first activating symbolLookupBase feature.");else console.error("lookup component requires first activating quoteFeed feature.")},H=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends HTMLElement{constructor(){super(),this.node=$(this),this.activeClassName="stxMenuActive",this.active=!1}get focusElement(){return this.getAttribute("cq-focus")}connectedCallback(){if(!this.attached&&(this.uiManager=e.UI.getUIManager(),this.attached=!0,!this.node.attr("readonly"))){var t=this,i=this.node[0];this.node.stxtap((function(e){t.tap(e)})),i.addEventListener("stxtap",(function(e){t.captureTap(e)}),!0)}}captureTap(t){var e=$(t.target).parents().addBack();this.noClose=e.filter((function(){var t=$(this).attr("cq-no-close");return void 0!==t&&!1!==t})).length,this.noClose||(this.noClose=e.filter((function(){return $(this).is("cq-separator,cq-heading")})).length)}close(){this.uiManager.closeMenu(this)}hide(){this.active&&(this.unlift(),this.node.removeClass(this.activeClassName),this.active=!1,$(this).find("input").each((function(){this==document.activeElement&&this.blur()})))}lift(){for(var t=this.lifts=this.uiManager.findLifts(this),e=0;e<t.length;e++)this.uiManager.lift(t[e])}open(t){for(var e=this.uiManager.activeMenuStack,i=0;i<e.length;i++)if(e[i]===this)return;this.uiManager.openMenu(this,t)}show(t){this.active||(this.active=!0,this.node.addClass(this.activeClassName),this.lift(),this.node.find("cq-scroll").each((function(){this.resize&&this.resize()})))}tap(t){var e=this.uiManager;if(this.active)t.stopPropagation(),this.noClose||e.closeMenu(this);else if(!this.active){if(t.stopPropagation(),$(t.target).parents("cq-menu-dropdown").length)return;for(var i=!1,n=this.node.parents("cq-menu,cq-dialog"),s=0;s<n.length;s++)n[s].active&&(i=!0);if(i||e.closeMenu(),this.open(),this.focusElement){const t=this.querySelector(this.focusElement);t&&t.focus()}}}unlift(){var t=this.lifts;if(t){for(var e=0;e<t.length;e++)this.uiManager.restoreLift(t[e]);this.lifts=null}}}e.UI.addComponentDefinition("cq-menu",i)},B=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{setContext(t){const i=this.getAttribute("cq-name");if(i&&t.config){const n=t.config.getMenu(i);if(this.addDefaultMarkup(this,n&&n.join("")),!this.innerHTML){const t=e.UI.BaseComponent.selfOrParentElement(this,"cq-menu-dropdown-section");t&&(t.style.display="none")}}else;}}e.UI.addComponentDefinition("cq-menu-container",i)},_=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{constructor(){super(),this.dragMargin=10}connectedCallback(){this.attached||super.connectedCallback()}init(){this.node=$(this),this.isDragging=!1,this.minHeight=parseInt(this.getAttribute("min-height"),10),isNaN(this.minHeight)&&(this.minHeight=25),this.paletteDock=this.parentElement.parentElement,this.dragStrip=this.querySelector(".drag-strip"),this.resizeStrip=this.querySelector(".resize-strip"),this.dragStrip&&this.dragStrip.addEventListener("mousedown",function(t){this.paletteDock.hasOwnProperty("dragging")&&this.paletteDock.startDrag(this)}.bind(this)),this.resizeStrip&&this.resizeStrip.addEventListener("mousedown",function(t){this.paletteDock.hasOwnProperty("dragging")&&this.paletteDock.startDrag(this,"resizing")}.bind(this)),this.paletteDock.paletteSubscribe&&(this.sendMessage=this.paletteDock.paletteSubscribe(this.handleMessage.bind(this)))}get hide(){return this.getAttribute("hide")}set hide(t){this.setAttribute("hide",t)}get docked(){return this.getAttribute("docked")}set docked(t){this.setAttribute("docked",t)}get orientation(){return this.getAttribute("orientation")}set orientation(t){this.setAttribute("orientation",t)}static get observedAttributes(){return["docked","hide"]}attributeChangedCallback(t,e,i){switch(t){case"docked":"false"===i?(this.setTransform(100,70),this.setHeightByScale(.8)):this.style.transform=""}}handleMessage(t,e){return{id:t,message:e}}detach(t,e){let i=document.body.classList.contains("break-sm");if("true"===this.docked&&!i){this.docked="false",t=t||10,e=e||10;let i={top:0,left:0,width:0,height:0};this.paletteDock.getBounds&&(i=this.paletteDock.getChartBoundsOffset()),t>i.left+i.width-this.clientWidth&&(t=i.left+i.width-this.clientWidth),this.setTransformPosition(t,e),this.paletteDock.setChartDimensions(),this.paletteDock.setVerticalPaletteHeight()}}dock(){"false"===this.docked&&(this.docked="true",this.paletteDock.setChartDimensions(),this.paletteDock.setVerticalPaletteHeight())}getHeight(){return this.clientHeight}getWidth(){return this.clientWidth}checkPosition(){let t={top:0,left:0,width:0,height:0};this.paletteDock.getBounds&&(t=this.paletteDock.getChartBoundsOffset());const e=this.style.transform.split(/\w+\(|\);?/)[1].split(/,\s?/g).map((function(t){return parseInt(t)}));e[0]+=t.left+.5*this.dragStrip.clientWidth,e[1]+=t.top+.5*this.dragStrip.clientHeight,this.setTransformPosition(e[0],e[1])}setTransformPosition(t,e){let i={top:0,left:0,width:0,height:0};this.paletteDock.getBounds&&(i=this.paletteDock.getChartBoundsOffset());let n=Math.floor(e-i.top-.5*this.dragStrip.clientHeight),s=Math.floor(t-i.left-.5*this.dragStrip.clientWidth);n=Math.min(Math.max(n,this.dragMargin),i.height-(this.dragStrip.clientHeight+this.dragMargin)),s=Math.min(Math.max(s,this.dragMargin),i.width-(this.dragStrip.clientWidth+this.dragMargin)),this.setTransform(s,n)}setTransform(t,e){this.style.transform="translate3d("+t+"px,"+e+"px, 0px)"}setHeightToPosition(t){let e={top:0,left:0,width:0,height:0};this.paletteDock.getBounds&&(e=this.paletteDock.getBounds());let i=this.getBoundingClientRect(),n=t-i.top;"vertical"===this.orientation&&n>this.minHeight&&n+(i.top-e.top)<e.height&&this.setHeight(n)}setHeightByScale(t){this.style.height=Math.floor(parseInt(this.style.height,10)*t)+"px"}setHeight(t){this.style.height=t+"px"}}e.UI.addComponentDefinition("cq-palette",i)},O=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{constructor(){super(),this.dragging=!1,this.paletteRegistry=[],this.mouseOutCk=!1}connectedCallback(){this.attached||super.connectedCallback()}initListeners(){this.node=$(this);const{stx:t,config:e}=this.context,i=this,n=i.handleResize.bind(this);this.setVerticalPaletteHeight(),this.addEventListener("mouseup",this.stopDrag.bind(this)),this.addEventListener("mouseleave",(function(t){i.context.stx.showCrosshairs(),i.mouseOutCk=setTimeout(()=>i.stopDrag(),500)})),this.addEventListener("mouseenter",(function(t){if(i.context.stx.undisplayCrosshairs(),!i.dragging)return;if(1===t.buttons)return void clearTimeout(i.mouseOutCk);i.stopDrag()})),this.addEventListener("mousemove",(function(t){i.dragging&&(t.stopPropagation(),i.dragging.classList.contains("dragging")&&i.dragging.setTransformPosition(t.clientX,t.clientY),i.dragging.classList.contains("resizing")&&i.dragging.setHeightToPosition(t.clientY))})),this.addEventListener("mousedown",this.stopContext.bind(this)),t.append("resizeChart",()=>n({resizeChart:!1})),e&&e.channels.drawing&&this.channelSubscribe(e.channels.drawing,(function(e){i.setChartDimensions(),t.resizeChart()}))}setContext(){this.initListeners()}palettePublish(t,e){for(var i=0;i<this.paletteRegistry.length;i++)this.paletteRegistry[i](t,e)}paletteSubscribe(t){return this.paletteRegistry.push(t),this.palettePublish.bind(this)}getBounds(){return this.parentNode.getBoundingClientRect()}getChartBounds(){let t=this.parentNode.getBoundingClientRect(),e={top:0,left:0,height:t.height,width:t.width};for(var i=this.querySelectorAll('[docked="true"]'),n=0;n<i.length;n++){var s=i[n];"vertical"===s.orientation?(e.width-=s.getWidth(),e.left+=s.getWidth()):"horizontal"===s.orientation&&(e.height-=s.getHeight(),e.top+=s.getHeight())}return e}getChartBoundsOffset(){let t=this.parentNode.getBoundingClientRect(),e=this.getChartBounds();return e.top+=t.top,e.left+=t.left,e}startContext(){this.classList.add("context")}stopContext(){this.classList.remove("context"),this.palettePublish("context","stop")}startDrag(t,e){for(var i=this.querySelectorAll('[docked="false"]'),n=0;n<i.length;n++)i[n].style.zIndex=1;e=e||"dragging",this.dragging=t,this.classList.add("dragging"),this.dragging.classList.add(e),this.dragging.style.zIndex=10}stopDrag(){this.classList.remove("dragging"),this.dragging=!1,this.resizing=!1,$(this.node).find('[docked="false"]').each((function(){this.node.removeClass("dragging resizing")}))}startResize(t){this.resizing=t,this.classList.add("dragging"),this.dragging.classList.add("dragging")}handleResize({resizeChart:t=!0}={}){this.palettePublish("dockWillResize"),this.setChartDimensions(),this.setVerticalPaletteHeight();let e=document.body.classList.contains("break-sm");for(var i=this.querySelectorAll('[docked="false"]'),n=0;n<i.length;n++){var s=i[n];e?s.dock():s.checkPosition()}this.palettePublish("dockDidResize"),t&&this.context.stx.resizeChart()}setVerticalPaletteHeight(){$(this.node).find("[orientation=vertical]").each(function(t,e){"true"===$(e).attr("docked")&&$(e).css("height",this.parentNode.clientHeight+"px")}.bind(this))}setChartDimensions(){const t=this.context.stx.chart.container,{top:e,left:i,width:n,height:s}=this.getChartBounds(),{config:a}=this.context;a?this.channelWrite(a.channels.drawingPalettes,{top:e,left:i,width:n,height:s}):(t.style.width=n+"px",t.style.height=s+"px",t.style.top=e+"px",t.style.left=i+"px");for(var o=this.querySelectorAll('[orientation="horizontal"]'),r=0;r<o.length;r++){var c=o[r];c.style.left=i+1+"px",c.style.width=n+"px"}for(var l=this.querySelectorAll('[orientation="vertical"]'),d=0;d<l.length;d++){var h=l[d];"false"===h.docked?h.style.top=e+"px":h.style.top=0}}dockAllPalettes(){for(var t=this.querySelectorAll('[docked="false"]'),e=0;e<t.length;e++)t[e].dock()}}e.UI.addComponentDefinition("cq-palette-dock",i)},j=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{pairUp(t){this.undo=$(t)[0],this.undo.redoButton=this;var e=this;$(this).stxtap((function(){e.undo.redo()}))}}e.UI.addComponentDefinition("cq-redo",i)},R=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{constructor(){super(),this.node=$(this)}connectedCallback(){if(!this.attached&&(super.connectedCallback(),void 0===this.node.attr("cq-no-scroll"))){this.node.css({"overflow-y":"auto"}),this.uiManager=e.UI.getUIManager(),this.uiManager.length>0&&(this.uiManager=this.uiManager[0]),void 0===this.node.attr("cq-no-claim")&&this.addClaim(this),this.addEventListener(e.wheelEvent,(function(t){t.stopPropagation()}),{passive:!1});var t=this;e.UI.addResizeListener(this,(function(){t.resize()})),this.resize()}}disconnectedCallback(){e.UI.removeResizeListener(this),super.disconnectedCallback()}focused(){var t=this.node.find("cq-item[cq-focused]");return t.length?t[0]:null}keyStroke(t,e,i){var n=this.node;const s=document.querySelectorAll(".stxMenuActive *");if(Array.from(s).includes(this)){if(!n.is(":trulyvisible"))return!1;switch(e){case"ArrowUp":case"ArrowDown":case"Enter":case" ":case"Up":case"Down":case"Spacebar":break;default:return!1}var a=n.find("cq-item");if(a.length){var o=n.find("cq-item[cq-focused]");if(" "==e||"Spacebar"==e||"Enter"==e)return!(!o.length||!o[0].selectFC)&&(o[0].selectFC.call(o,i),!0);if(!o.length)return $(a[0]).attr("cq-focused","true"),this.scrollToElement(a[0]),!0;a.removeAttr("cq-focused");for(var r=0;r<a.length&&a[r]!==o[0];r++);return"ArrowUp"!=e&&"Up"!=e||--r<0&&(r=0),"ArrowDown"!=e&&"Down"!=e||++r>=a.length&&(r=a.length-1),$(a[r]).attr("cq-focused","true"),this.scrollToElement(a[r]),!0}}}resize(){var t=this.node,i=e.UI.getMyContext(this);if(!t.parents(".sharing").length&&void 0===t.attr("cq-no-resize")){void 0!==t.attr("cq-no-maximize")&&(this.noMaximize=!0);var n,s,a=t[0].getBoundingClientRect(),o=t.prop("reduceMenuHeight")||45;if(i&&i.topNode){var r=i.topNode.getBoundingClientRect();n=r.height,s=r.top}else n=window.innerHeight,s=0;if(n){var c=n-(a.top-s)-o,l=t.parents(".stx-holder,.stx-subholder,.chartContainer");l.length&&l.each((function(){var t=$(this),e=t[0].getBoundingClientRect().top+t.height();c=Math.min(c,e-a.top-5)}));for(var d=t.nextAll(),h=0;h<d.length;h++){var p=$(d[h]);p.is(":visible")&&(c-=p.outerHeight())}this.noMaximize||t.css({height:c+"px"}),t.css({"max-height":c+"px"}),this.refresh()}}}scrollToElement(t){var e=this.clientHeight,i=this.scrollTop,n=t.offsetTop+t.clientHeight;t.offsetTop>i&&n<e+i||(this.scrollTop=Math.max(n-e,0),this.refresh())}top(){this.scrollTop=0,this.refresh()}refresh(){e.UI.scrollbarStyling&&e.UI.scrollbarStyling.refresh(this)}}e.UI.addComponentDefinition("cq-scroll",i)},W=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{setContext(){this.addDefaultMarkup()}tap(t){const{context:e}=this;if(e.config)this.channelWrite(e.config.channels.dialog,{type:"share",params:{context:e}},e.stx);else{const t=document.querySelector("cq-share-dialog");t&&t.open&&t.open({context:e})}}}i.markup='<div stxtap="tap();">Share</div>',e.UI.addComponentDefinition("cq-share-button",i)},K=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.Share){class t extends e.UI.DialogContentTag{open(t){this.addDefaultMarkup(),this.setState("share-create"),super.open(t)}close(){this.setState("share-create"),super.close()}setState(t){this.addDefaultMarkup(),this.node.find("div[cq-share-dialog-div]")[0].className=t}share(){var t=this.context.stx,i=this;i.setState("share-generate"),$("cq-share-dialog .share-link-div").html(""),e.UI.bypassBindings=!0,e.Share.createImage(t,{hide:[".stx_chart_controls",".stx-btn-panel",".stx_jump_today",".stx-baseline-handle",".ciq-edit",".ciq-close","cq-marker-label"]},(function(n){e.UI.bypassBindings=!1;var s=e.uniqueID(),a="https://share.chartiq.com",o=t.getStartDateOffset(),r={layout:t.exportLayout(),drawings:t.exportDrawings(),xOffset:o,startDate:t.chart.dataSegment[o].Date,endDate:t.chart.dataSegment[t.chart.dataSegment.length-1].Date,id:s,symbol:t.chart.symbol},c=a+"/upload/"+s,l={id:s,image:n,config:r};i.setState("share-upload"),e.Share.uploadImage(n,c,l,(function(t,n){i.setState("share-copy"),null!==t?e.alert("error: "+t):$("cq-share-dialog .share-link-div").html(a+n)}))}))}copy(){var t=$("cq-share-dialog .share-link-div")[0].innerText,i=document.createElement("input");if(i.type="text",i.value=t,i.contentEditable=!0,i.readOnly=!0,document.body.appendChild(i),i.focus(),i.select(),!e.isIE){var n=document.createRange();n.selectNodeContents(i);var s=window.getSelection();s.removeAllRanges(),s.addRange(n),i.setSelectionRange(0,t.length)}document.execCommand("copy"),document.body.removeChild(i),this.setState("share-copied")}}t.markup='\n\t\t<h4 class="title">Share Your Chart</h4>\n\t\t<cq-close></cq-close>\n\t\t<div cq-share-dialog-div>\n\t\t\t<cq-separator></cq-separator>\n\t\t\t<cq-share-create class="ciq-btn" stxtap="share()">Create Image</cq-share-create>\n\t\t\t<cq-share-generating>Generating Image</cq-share-generating>\n\t\t\t<cq-share-uploading>Uploading Image</cq-share-uploading>\n\t\t\t<div class="share-link-div"></div>\n\t\t\t<cq-share-copy class="ciq-btn" stxtap="copy()">Copy Link to Clipboard</cq-share-copy>\n\t\t\t<cq-share-copied>Link Copied!</cq-share-copied>\n\t',e.UI.addComponentDefinition("cq-share-dialog",t)}else console.error("shareDialog component requires first activating share feature.")},Y=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{set(t,e,i,n,s,a){var o=this;o.context.loader&&o.context.loader.show();var r={multiplier:e,base:i};n&&(r.periodicity={interval:n,period:s||1,timeUnit:a}),o.context.stx.setSpan(r,(function(){o.context.loader&&o.context.loader.hide()}))}setContext(t){const e=t.config&&t.config.getMenu("rangeMenu");this.addDefaultMarkup(this,e&&e.join(""))}}i.markup='\n\t\t<div stxtap="set(1,\'today\');">1D</div>\n\t\t<div stxtap="set(5,\'day\',30,2,\'minute\');">5D</div>\n\t\t<div stxtap="set(1,\'month\',30,8,\'minute\');">1M</div>\n\t\t<div class="hide-sm" stxtap="set(3,\'month\');">3M</div>\n\t\t<div class="hide-sm" stxtap="set(6,\'month\');">6M</div>\n\t\t<div class="hide-sm" stxtap="set(1,\'YTD\');">YTD</div>\n\t\t<div stxtap="set(1,\'year\');">1Y</div>\n\t\t<div class="hide-sm" stxtap="set(5,\'year\',1,1,\'week\');">5Y</div>\n\t\t<div class="hide-sm" stxtap="set(1,\'all\');">All</div>\n\t',e.UI.addComponentDefinition("cq-show-range",i)},G=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{setContext({config:{channels:t},stx:e}){const i=this.querySelector("div"),n=this.getAttribute("cq-on")||"sidenavOn",s=this.getAttribute("cq-off")||"sidenavOff",a=()=>{const e="break-sm"===this.channelRead(t.breakpoint),s=e&&this.channelRead(t.sidenav)===n;i.classList.remove("sidenav","ciq-toggles"),i.classList.add(e?"sidenav":"ciq-toggles"),i.classList[s?"add":"remove"]("active"),this.channelWrite(t.sidenavSize,s?i.offsetWidth:0)};this.channelSubscribe(t.sidenav,a),this.channelSubscribe(t.breakpoint,a),this.channelSubscribe(t.tfc,e=>{e&&this.channelWrite(t.sidenav,s)})}}e.UI.addComponentDefinition("cq-side-nav",i)},X=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{constructor(){super(),this.callbacks=[]}setContext(t){const{config:e,stx:i}=t;if(!e)return;const n=this.resizeMyself.bind(this),{node:s}=this;function a(){setTimeout(n)}this.channelSubscribe(e.channels.breakpoint,a),this.channelSubscribe(e.channels.tfc,(function(t){t?s.attr("cq-active",!0):s.removeAttr("cq-active");a()}),i)}close(){this.node.removeAttr("cq-active"),this.node.children().each((function(){this.sidePanelActiveClass?$(this).removeClass(this.sidePanelActiveClass):$(this).removeAttr(this.sidePanelActiveAttribute)}));var t=this;setTimeout((function(){t.resizeMyself()}),0)}nonAnimatedWidth(){var t=0;return this.node.children().width((function(e,i){t+=i})),t}open(t){this.close();var e=this.node.find(t.selector);t.className?(e.addClass(t.className),e.each((function(){this.sidePanelActiveClass=t.className}))):(e.attr(t.attribute,"true"),e.each((function(){this.sidePanelActiveAttribute=t.attribute}))),this.node.attr("cq-active","true");var i=this;setTimeout((function(){i.resizeMyself()}),0)}registerCallback(t){this.callbacks.push(t)}resizeMyself(){var t=0;this.node.children().width((function(e,i){t+=i})),this.node.css({width:t+"px"});for(var e=0;e<this.callbacks.length;e++)this.callbacks[e].call(this,t);const{config:i,stx:n}=this.context||{};i&&this.channelWrite(i.channels.sidepanelSize,t,n)}}e.UI.addComponentDefinition("cq-side-panel",i)},Z=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{disconnectedCallback(){this.context&&e.UI.unobserveProperty("studyLibraryHash",this.context.stx.chart,this.listener),super.disconnectedCallback()}initialize(t){this.addDefaultMarkup(),this.params=t||{},this.alwaysDisplayDialog=this.params.alwaysDisplayDialog||!1,this.excludedStudies=this.params.excludedStudies||[],this.params.template||(this.params.template="template"),this.params.template=this.node.find(this.params.template),this.renderMenu();var i=this,n=this.context.stx;this.listener=function(t){i.renderMenu()},e.UI.observeProperty("studyLibraryHash",n.chart,this.listener)}setContext({config:t}){t&&t.menuStudiesConfig&&this.initialize(Object.assign({},t.menuStudiesConfig))}renderMenu(){if(e.Studies){var t,i=this.context.stx,n=[];for(var s in e.Studies.studyLibrary)!(t=e.Studies.studyLibrary[s])||this.excludedStudies[s]||this.excludedStudies[t.name]||void 0!==t.siqList||(t.name||(t.name=s),n.push(s));n.sort((function(t,i){var n=e.Studies.studyLibrary[t],s=e.Studies.studyLibrary[i];return n.name<s.name?-1:n.name>s.name?1:0}));for(var a=$(this.node),o=this,r=function(t,i){return function(i){!function(t,i){var n=o.context.stx;function s(t,e,n){if(!0===t)return h(e,n),!0;if("object"==typeof t)for(var s in t)if(s==i&&t[s])return h(e,n),!0}if(s(o.params.dialogBeforeAddingStudy,{stx:n,name:i},!0))return;var a=e.Studies.addStudy(n,i);s(o.alwaysDisplayDialog,{sd:a,stx:n})}(i.target,t),a.resize()}},c=a.find("cq-studies-content");c.length>0&&c[0].firstChild;)c[0].removeChild(c[0].firstChild);for(var l=0;l<n.length;l++){var d=e.UI.makeFromTemplate(this.params.template);t=e.Studies.studyLibrary[n[l]],d.append(e.translatableTextNode(i,t.name)),this.makeTap(d[0],r(n[l],this.context)),a.find("cq-studies-content").append(d)}}function h(t,e){const{context:i}=o;if(i.config)o.channelWrite(i.config.channels.dialog,{type:"study",params:Object.assign({},t,{context:i,addWhenDone:e})},i.stx);else{t.context=o.context;const i=document.querySelector("cq-study-dialog");i.addWhenDone=e,i.open(t)}}}}i.markup="\n\t\t<template>\n\t\t\t<cq-item><cq-label></cq-label></cq-item>\n\t\t</template>\n\t\t<cq-studies-content></cq-studies-content>\n\t",e.UI.addComponentDefinition("cq-studies",i)},J=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{setContext(t){this.addDefaultMarkup(),super.setContext(t)}}i.markup='\n\t\t<div stxtap="StudyEdit.edit()">Edit Settings...</div>\n\t\t<div stxtap="StudyEdit.remove()">Delete Study</div>\n\t',e.UI.addComponentDefinition("cq-study-context",i)},tt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.Studies){class t extends e.UI.DialogContentTag{connectedCallback(){this.attached||(super.connectedCallback(),this.queuedUpdates={})}close(){if(this.addWhenDone){var t=this.helper,i=e.Studies.addStudy(t.stx,t.name);e.isEmpty(this.queuedUpdates)||(t.sd=i,t.updateStudy(this.queuedUpdates),this.queuedUpdates={})}}disconnectedCallback(){e.UI.unobserveProperty("signal",this.helper),super.disconnectedCallback()}hide(){e.isEmpty(this.queuedUpdates)||(this.helper.updateStudy(this.queuedUpdates),this.queuedUpdates={}),this.node.find("cq-menu").each((function(){this.unlift&&this.unlift()})),this.node.find("cq-swatch").each((function(){this.colorPicker&&this.colorPicker.close()}))}makeMenu(t,i,n,s){var a=e.UI.makeFromTemplate(this.menuTemplate),o=a.find("cq-menu-dropdown");for(var r in n){var c=$("<cq-item></cq-item>");c.text(n[r]),c.attr("stxtap","StudyDialog.setSelectOption('"+s+"')"),o.append(c),c[0].cqMenuWrapper=o.parents("cq-menu")[0],c.attr("name",t),c.attr("value",r),c[0].context=this.context}return a.find("cq-selected").text(this.helper.stx.translateIf(i)),a}open(t){this.addDefaultMarkup(),this.selectTemplates(),super.open(t),t.axisSelect=this.getAttribute("cq-study-axis"),""===t.axisSelect&&(t.axisSelect=!0),t.panelSelect=this.getAttribute("cq-study-panel"),""===t.panelSelect&&(t.panelSelect=!0),void 0!==t.addWhenDone&&(this.addWhenDone=t.addWhenDone);var i=this;this.context.stx;e.UI.unobserveProperty("signal",this.helper),this.helper=new e.Studies.DialogHelper(t),e.UI.observeProperty("signal",this.helper,(function(e){i.refreshParameters(t)}));var n=$(this);n.find(".title").text(this.helper.title);var s,a,o=n.find("cq-study-inputs");o.empty();for(var r=0;r<this.helper.inputs.length;r++){var c=this.helper.inputs[r],l=e.UI.makeFromTemplate(this.inputTemplate,o);this.menuTemplate=l.find("template[cq-menu]"),l.find(".ciq-heading").text(c.heading),l[0].fieldName=c.name;var d,h=null,p=this.helper.attributes[c.name];if("number"==c.type)for(d in(h=$("<input>")).attr("type","number"),h.val(c.value),this.setChangeEvent(h,"inputs",c.name),p){var u=p[d];(e.isIE||e.isEdge)&&"step"==d&&Math.floor(u)!=u&&(u="any"),h.attr(d,u)}else if("text"==c.type||"date"==c.type||"time"==c.type)for(d in(h=$("<input>")).attr("type",e.UI.supportedInputType(c.type)),"date"==c.type?h.val(((a=(a=c.value).replace(/-/g,"")).search(/^\d{8}$/)||(a=a.substring(0,4)+"-"+a.substring(4,6)+"-"+a.substring(6,8)),a)):"time"==c.type?h.val(((s=(s=c.value).replace(/:/g,"")).search(/^\d{4,6}$/)||(s=s.substring(0,2)+":"+s.substring(2,4)+(4==s.length?"":":"+s.substring(4,6))),s)):h.val(c.value),this.setChangeEvent(h,"inputs",c.name),p)h.attr(d,p[d]);else if("select"==c.type)h=this.makeMenu(c.name,c.value,c.options,"inputs"),p&&p.readonly&&h.attr("readonly",p.readonly);else if("checkbox"==c.type)for(d in(h=$("<input>")).attr("type","checkbox"),c.value&&h.prop("checked",!0),this.setChangeEvent(h,"inputs",c.name),p)h.attr(d,p[d]);p&&p.hidden&&l.hide(),h&&l.find(".stx-data").append(h)}var m=n.find("cq-study-outputs");for(m.empty(),r=0;r<this.helper.outputs.length;r++){var g=this.helper.outputs[r],f=e.UI.makeFromTemplate(this.outputTemplate,m);f[0].initialize({studyDialog:this,output:g.name,params:t}),f.find(".ciq-heading").text(g.heading),f.find(".ciq-heading")[0].fieldName=g.name;var v=f.find("cq-swatch"),q=g.color;"object"==typeof q&&(q=q.color),v[0].setColor(q,!1)}this.refreshParameters(t)}refreshParameters(t){var i=$(this).find("cq-study-parameters");i.empty();for(var n=0;n<this.helper.parameters.length;n++){var s=this.helper.parameters[n],a=e.UI.makeFromTemplate(this.parameterTemplate,i);if(this.menuTemplate=a.find("template[cq-menu]"),this.menuTemplate.length||!s.options){a.find(".ciq-heading").text(s.heading);var o,r=a.find("cq-swatch"),c=$("<input>"),l={};if(s.defaultValue.constructor==Boolean)for(o in c.attr("type","checkbox"),s.value&&c.prop("checked",!0),this.setChangeEvent(c,"parameters",s.name+"Enabled"),r.remove(),l=this.helper.attributes[s.name+"Enabled"])c.attr(o,l[o]);else if(s.defaultValue.constructor==String){var d=s.name;for(o in s.defaultColor?(a[0].initialize({studyDialog:this,parameter:s.name+"Color",params:t}),r[0].setColor(s.color,!1),d+="Value"):r.remove(),s.options?c=this.makeMenu(d,s.value,s.options,"parameters"):c.val(s.value),l=this.helper.attributes[d])c.attr(o,l[o])}else{if(s.defaultValue.constructor!=Number)continue;for(o in c.attr("type","number"),c.val(s.value),this.setChangeEvent(c,"parameters",s.name+"Value"),a[0].initialize({studyDialog:this,parameter:s.name+"Color",params:t}),r[0].setColor(s.color,!1),l=this.helper.attributes[s.name+"Value"]){var h=l[o];(e.isIE||e.isEdge)&&"step"==o&&Math.floor(h)!=h&&(h="any"),c.attr(o,h)}}l&&l.hidden&&a.not("hr").hide(),a.find(".stx-data").append(c)}else a.remove()}}setChangeEvent(t,e,i){var n=this;t.change((function(){var t={};t[e]={},t[e][i]=this.value,"checkbox"!=this.type&&"radio"!=this.type||(t[e][i]=this.checked),n.updateStudy(t)}))}setContext(t){this.context=t,t.advertiseAs(this,"StudyDialog")}setSelectOption(t,e){var i=$(t.node),n=i.attr("name"),s=i.attr("value"),a=$(i[0].cqMenuWrapper);a.find("cq-selected").text(this.helper.stx.translateIf(s)),a[0].fieldValue=s,e||(e="inputs");var o={};o[e]={},o[e][n]=s,this.updateStudy(o)}updateStudy(t){$(this).find(":invalid").length||(this.addWhenDone?e.extend(this.queuedUpdates,t):this.helper.libraryEntry.deferUpdate?(e.extend(this.queuedUpdates,{inputs:t.inputs}),this.helper.updateStudy({outputs:t.outputs,parameters:t.parameters})):this.helper.updateStudy(t))}selectTemplates(){this.inputTemplate||(this.inputTemplate=this.querySelector("template[cq-study-input]"),this.outputTemplate=this.querySelector("template[cq-study-output]"),this.parameterTemplate=this.querySelector("template[cq-study-parameters]"))}}t.markup='\n\t\t<h4 class="title">Study here</h4>\n\t\t<cq-scroll cq-no-maximize>\n\t\t\t<cq-study-inputs>\n\t\t\t\t<template cq-study-input>\n\t\t\t\t\t<cq-study-input>\n\t\t\t\t\t\t<div class="ciq-heading"></div>\n\t\t\t\t\t\t<div class="stx-data">\n\t\t\t\t\t\t\t<template cq-menu>\n\t\t\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t\t\t<cq-selected></cq-selected>\n\t\t\t\t\t\t\t\t\t<cq-menu-dropdown cq-lift></cq-menu-dropdown>\n\t\t\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</cq-study-input>\n\t\t\t\t\t<hr>\n\t\t\t\t</template>\n\t\t\t</cq-study-inputs>\n\t\t\t<cq-study-outputs>\n\t\t\t\t<template cq-study-output>\n\t\t\t\t\t<cq-study-output>\n\t\t\t\t\t\t<div class="ciq-heading"></div>\n\t\t\t\t\t\t<cq-swatch cq-overrides="auto"></cq-swatch>\n\t\t\t\t\t</cq-study-output>\n\t\t\t\t\t<hr>\n\t\t\t\t</template>\n\t\t\t</cq-study-outputs>\n\t\t\t<cq-study-parameters>\n\t\t\t\t<template cq-study-parameters>\n\t\t\t\t\t<cq-study-parameter>\n\t\t\t\t\t\t<div class="ciq-heading"></div>\n\t\t\t\t\t\t<div class="stx-data"><cq-swatch cq-overrides="auto"></cq-swatch>\n\t\t\t\t\t\t\t<template cq-menu>\n\t\t\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t\t\t<cq-selected></cq-selected>\n\t\t\t\t\t\t\t\t\t<cq-menu-dropdown cq-lift></cq-menu-dropdown>\n\t\t\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</cq-study-parameter>\n\t\t\t\t\t<hr>\n\t\t\t\t</template>\n\t\t\t</cq-study-parameters>\n\t\t</cq-scroll>\n\t\t<div class="ciq-dialog-cntrls">\n\t\t\t<div class="ciq-btn" stxtap="close()">Done</div>\n\t\t</div>\n\t',e.UI.addComponentDefinition("cq-study-dialog",t)}else console.error("studyDialog component requires first activating studies feature.")},et=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{}e.UI.addComponentDefinition("cq-study-input",i)},it=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.Studies){class t extends e.UI.ModalTag{connectedCallback(){this.attached||(super.connectedCallback(),void 0!==this.node.attr("cq-clone-to-panels")&&$("body").addClass("stx-panel-legend"))}begin(){if(!this.init){var t=this.context.stx,e=this.node;this.template=e.find("template[cq-study-legend]"),this.template.length||(this.template=e.find("template")),this.contentKeys=e.attr("cq-content-keys")||"cq-label",this.eventListeners.push(t.addEventListener("layout",this.renderLegend.bind(this))),e[0].hasAttribute("cq-marker")&&e.stxtap((function(){e.toggleClass("ciq-active")})),this.renderLegend(),this.init=!0}}launchColorPicker(){this.node.addClass("ciq-active")}renderLegend(){var t=this.context.stx;function i(t,i){return function(n){setTimeout((function(){i.permanent||e.Studies.removeStudy(t.context.stx,i),t.node[0].hasAttribute("cq-marker")&&t.context.stx.modalEnd(),t.renderLegend()}),0)}}function n(e,i){return function(n){var s=t.layout.studies[i];if(!s.permanent&&s.editFunction){n.stopPropagation(),e.uiManager.closeMenu();var a=e.context.getAdvertised("StudyEdit"),o={stx:t,sd:s,inputs:s.inputs,outputs:s.outputs,parameters:s.parameters};a.editPanel(o)}}}$(this.template).nextAll().remove();var s=void 0!==this.node.attr("cq-overlays-only"),a=void 0!==this.node.attr("cq-panel-only"),o=void 0!==this.node.attr("cq-custom-removal-only"),r=this.node.attr("cq-marker-label"),c=null,l=this.node.parents(".stx-holder")[0];if(l&&(c=l.panel.name),e.Studies)for(var d in t.layout.studies){var h=t.layout.studies[d];if(!h.customLegend&&((!o||h.study.customRemoval)&&(!a||h.panel==c)&&(!s||h.overlay||h.underlay))){var p=e.UI.makeFromTemplate(this.template,!0);p.find("cq-label").html(h.inputs.display);var u=p.find(".ciq-close");h.permanent?u.hide():u.stxtap(i(this,h));var m=p.find(".ciq-edit");m.length||(m=p.find("cq-label")),m.stxtap(n(this,d))}}void 0!==r&&(this.node.find("cq-marker-label").length||this.node.prepend("<cq-marker-label>"+r+"</cq-marker-label>")),this.displayLegendTitle()}displayLegendTitle(){var t,i;function n(t){for(;t;){if("template"===t.nodeName.toLowerCase())return!1;t=t.parentElement}return!0}t=this,i=this.contentKeys,Array.from(t.querySelectorAll(i)).some(n)?(this.node.css("display",""),this.node.parents("div.stx-panel-legend").css("width","")):(this.node.css("display","none"),this.node.parents("div.stx-panel-legend").css("width","0px")),e.I18N&&e.I18N.translateUI(null,this.node[0])}setContext(t){if(!this.init){var e=this;void 0!==e.node.attr("cq-clone-to-panels")&&(e.spawnPanelLegend(),t.stx.append("stackPanel",(function(t,i){e.spawnPanelLegend()}))),this.begin()}}spawnPanelLegend(){var t=this.context.stx;function e(t){return function(e){t.toggleClass("ciq-active")}}for(var i in t.panels)if(i!=t.chart.panel.name){var n=$(t.panels[i].icons).find(".stx-panel-legend");if(n.length){var s=n.find(this.node[0].nodeName);if(!s.length){(s=this.node.clone()).attr("cq-marker-label",this.node.attr("cq-clone-to-panels")).removeAttr("cq-clone-to-panels").removeAttr("cq-overlays-only").removeAttr("cq-marker").stxtap(e(s)).find("cq-marker-label").remove();var a=$("<cq-study-legend-fixed-wrapper></cq-study-legend-fixed-wrapper>");a.append(s),n.append(a),s[0].begin()}}}}}e.UI.addComponentDefinition("cq-study-legend",t)}else console.error("studyLegend component requires first activating studies feature.")},nt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{initialize(t){this.params=t}setColor(t){if(this.params){var e={outputs:{}};e.outputs[this.params.output]={},e.outputs[this.params.output].color=t,this.params.studyDialog.updateStudy(e)}}}e.UI.addComponentDefinition("cq-study-output",i)},st=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{initialize(t){this.params=t}setColor(t){if(this.params){var e={parameters:{}};e.parameters[this.params.parameter]=t,this.params.studyDialog.updateStudy(e)}}}e.UI.addComponentDefinition("cq-study-parameter",i)},at=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends HTMLElement{constructor(){super(),this.defaultColor=null}connectedCallback(){var t;this.attached||(this.attached=!0,this.node=$(this),this.getAttribute("cq-static")?this.style.cursor="default":this.node.stxtap((t=this,function(e){t.launchColorPicker(),e.stopPropagation()})))}getDefaultColor(){if(this.defaultColor)return this.defaultColor;var t=e.UI.getMyContext(this);return t?t.stx.defaultColor:"transparent"}setColor(t,i,n){var s=$(this),a=e.getBackgroundColor(this.parentNode),o=e.chooseForegroundColor(a),r=e.hsl(a);"auto"==t&&(n=!0),t||(t="transparent");var c=t;"auto"==t?c=this.getDefaultColor():0===t.indexOf("rgba(")&&(c=(c.split(",").slice(0,3).join(",")+")").replace(/rgba/,"rgb"));var l=e.hsl(c),d=e.isTransparent(t);s.css({background:c}),n||Math.abs(r[2]-l[2])<.2||d?(s.css({border:"solid "+o+" 1px"}),d&&s.css({background:"linear-gradient(to bottom right, transparent, transparent 49%, "+o+" 50%, transparent 51%, transparent)"})):s.css({border:""}),n&&(a=e.chooseForegroundColor(c),s.css({background:"linear-gradient(to bottom right, "+c+", "+c+" 49%, "+a+" 50%, "+a+")"})),!1!==i&&e.UI.containerExecute(this,"setColor",t,this)}launchColorPicker(){var t=$(this);e.UI.containerExecute(this,"launchColorPicker");var i,n=$("cq-color-picker")[0];n.callback=(i=this,function(t){i.setColor(t,null)});var s=this.node.attr("cq-overrides");s&&(s=s.split(",")),n.display({node:t,context:e.UI.getMyContext(this),overrides:s}),this.colorPicker=n}}e.UI.addComponentDefinition("cq-swatch",i)},ot=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.ThemeHelper){class t extends e.UI.DialogContentTag{applyChanges(){var t=this.context.stx;this.helper.update(t),t.changeOccurred("theme")}close(){this.helper.settings=this.revert,this.applyChanges(),super.close()}open(t){this.addDefaultMarkup(),super.open(t);var i=t.themeName;this.initiatingMenu=t.initiatingMenu,this.context=t.context,this.helper=new e.ThemeHelper({stx:this.context.stx}),this.revert=e.clone(this.helper.settings);var n=this;function s(t,e,i,s){var a=n.node.find('cq-theme-piece[cq-piece="'+t+'"]');a.length&&(a[0].piece={obj:e,field:i},"color"==s&&a.find("cq-swatch")[0].setColor(e[i],!1))}var a=this.helper.settings;s("cu",a.chartTypes["Candle/Bar"].up,"color","color"),s("cd",a.chartTypes["Candle/Bar"].down,"color","color"),s("wu",a.chartTypes["Candle/Bar"].up,"wick","color"),s("wd",a.chartTypes["Candle/Bar"].down,"wick","color"),s("bu",a.chartTypes["Candle/Bar"].up,"border","color"),s("bd",a.chartTypes["Candle/Bar"].down,"border","color"),s("lc",a.chartTypes.Line,"color","color"),s("mb",a.chartTypes.Mountain,"basecolor","color"),s("mc",a.chartTypes.Mountain,"color","color"),s("bg",a.chart.Background,"color","color"),s("gl",a.chart["Grid Lines"],"color","color"),s("dd",a.chart["Grid Dividers"],"color","color"),s("at",a.chart["Axis Text"],"color","color"),i||(i="My Theme"),this.node.find("cq-action input").val(i)}save(){var t=this.node.find("cq-action input").val(),i={settings:e.clone(this.helper.settings),name:t,builtIn:null};e.UI.contextsForEach((function(){this.stx.updateListeners("theme")}));var n=this;$("cq-themes").each((function(){i.builtIn=this.currentLoadedBuiltIn,this.addCustom(i,n.initiatingMenu)})),super.close()}setValue(t,e,i){t[e]=i,this.applyChanges()}}t.markup='\n\t\t<h4 class="title">Create Custom Theme</h4>\n\t\t<cq-close></cq-close>\n\t\t<cq-scroll cq-no-maximize>\n\t\t\t<cq-section>\n\t\t\t\t<cq-placeholder>Candle Color\n\t\t\t\t\t<cq-theme-piece cq-piece="cu"><cq-swatch cq-overrides="Hollow"></cq-swatch></cq-theme-piece>\n\t\t\t\t\t<cq-theme-piece cq-piece="cd"><cq-swatch cq-overrides="Hollow"></cq-swatch></cq-theme-piece>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-placeholder>Candle Wick\n\t\t\t\t\t<cq-theme-piece cq-piece="wu"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t\t<cq-theme-piece cq-piece="wd"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-placeholder>Candle Border\n\t\t\t\t\t<cq-theme-piece cq-piece="bu"><cq-swatch cq-overrides="No Border"></cq-swatch></cq-theme-piece>\n\t\t\t\t\t<cq-theme-piece cq-piece="bd"><cq-swatch cq-overrides="No Border"></cq-swatch></cq-theme-piece>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-separator></cq-separator>\n\t\t\t\t<cq-placeholder>Line/Bar Chart\n\t\t\t\t\t<cq-theme-piece cq-piece="lc"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-separator></cq-separator>\n\t\t\t\t<cq-placeholder>Mountain Base\n\t\t\t\t\t<cq-theme-piece cq-piece="mb"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-placeholder>Mountain Peak\n\t\t\t\t\t<cq-theme-piece cq-piece="mc"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t</cq-placeholder>\n\t\t\t</cq-section>\n\t\t\t<cq-section>\n\t\t\t\t<cq-placeholder>Background\n\t\t\t\t\t<cq-theme-piece cq-piece="bg"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-placeholder>Grid Lines\n\t\t\t\t\t<cq-theme-piece cq-piece="gl"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-placeholder>Date Dividers\n\t\t\t\t\t<cq-theme-piece cq-piece="dd"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-placeholder>Axis Text<cq-theme-piece cq-piece="at"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t</cq-placeholder>\n\t\t\t</cq-section>\n\t\t\t<cq-action>\n\t\t\t\t<input><div stxtap="save()" class="ciq-btn">Save</div>\n\t\t\t</cq-action>\n\t\t</cq-scroll>\n\t',e.UI.addComponentDefinition("cq-theme-dialog",t)}else console.error("themeDialog component requires first activating theme feature.")},rt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{setBoolean(t){e.UI.containerExecute(this,"setValue",this.piece.obj,this.piece.field,t)}setColor(t){"Hollow"!=t&&"No Border"!=t||(t="transparent",this.node.find("cq-swatch")[0].setColor("transparent",!1)),e.UI.containerExecute(this,"setValue",this.piece.obj,this.piece.field,t)}}e.UI.addComponentDefinition("cq-theme-piece",i)},ct=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{connectedCallback(){this.attached||super.connectedCallback()}setContext({config:t}){if(!t)return;const{chartId:e,themes:{builtInThemes:i,defaultTheme:n},nameValueStore:s}=t;this.initialize({builtInThemes:i,defaultTheme:n,nameValueStore:s,id:e})}addCustom(t,e){this.params.customThemes[t.name]=t,e===this&&(this.currentTheme=t.name),this.configureMenu(),this.persist()}configureMenu(){function t(t,e){return function(i){t.loadBuiltIn(e),t.params.callback&&t.params.callback({theme:t.currentTheme}),t.persist("current")}}function i(t,e){return function(i){t.loadCustom(e),t.params.callback&&t.params.callback({theme:t.currentTheme}),t.persist("current")}}var n,s;this.builtInMenu.emptyExceptTemplate(),this.customMenu.emptyExceptTemplate();var a=this.params.builtInThemes;for(var o in a)n=a[o],(s=e.UI.makeFromTemplate(this.builtInTemplate)).text(n),this.makeTap(s[0],t(this,o)),this.builtInMenu.append(s);e.I18N&&e.I18N.translateUI(null,this.builtInMenu[0]);var r=this.params.customThemes;for(var c in r)n=c,(s=e.UI.makeFromTemplate(this.customTemplate)).find("cq-label").text(n),this.makeTap(s.find("cq-item")[0],i(this,c)),s[0].close=function(t,e){return function(){t.removeTheme(e)}}(this,c),this.customMenu.append(s)}initialize(t){if(!this.initialized){this.initialized=!0,this.addDefaultMarkup(),this.selectTemplates(this),this.params={},t&&(this.params=t),e.ensureDefaults(this.params,{customThemes:{},builtInThemes:{},nameValueStore:e.NameValueStore&&new e.NameValueStore}),this.params.id&&(this.id="themes_"+this.params.id);var i=this;this.params.nameValueStore?this.params.nameValueStore.get("CIQ.Themes.prototype.custom",(function(t,e){!t&&e&&(i.params.customThemes=e),i.params.nameValueStore.get(i.id+"CIQ.Themes.prototype.current",(function(t,e){!t&&e&&e.theme?i.loadTheme(e.theme):i.loadTheme(i.params.defaultTheme),i.configureMenu()}))})):this.loadTheme(i.params.defaultTheme)}}loadBuiltIn(t){this.currentLoadedBuiltIn&&$(this.context.topNode).removeClass(this.currentLoadedBuiltIn),$(this.context.topNode).addClass(t),this.currentLoadedBuiltIn=this.currentTheme=t,this.reinitializeChart()}loadCustom(t){this.currentLoadedBuiltIn&&$(this.context.topNode).removeClass(this.currentLoadedBuiltIn);var e=this.params.customThemes[t];e.builtIn&&$(this.context.topNode).addClass(e.builtIn),this.currentLoadedBuiltIn=e.builtIn,this.currentTheme=e.name,this.reinitializeChart(e)}loadTheme(t){this.params.customThemes[t]?this.loadCustom(t):this.params.builtInThemes[t]?this.loadBuiltIn(t):this.loadBuiltIn(this.params.defaultTheme)}newTheme(){const{context:t}=this;t.config?this.channelWrite(t.config.channels.dialog,{type:"theme",params:{context:t,initiatingMenu:this}},t.stx):document.querySelector("cq-theme-dialog").open({context:this.context,initiatingMenu:this})}persist(t){this.params.nameValueStore&&(t&&"current"!=t||this.params.nameValueStore.set(this.id+"CIQ.Themes.prototype.current",{theme:this.currentTheme}),t&&"custom"!=t||this.params.nameValueStore.set("CIQ.Themes.prototype.custom",this.params.customThemes))}removeTheme(t){var e=!1;$("cq-themes").each((function(){delete this.params.customThemes[t],this.configureMenu(),e||(this.persist(),e=!0)}))}selectTemplates(){this.builtInMenu||(this.builtInMenu=$(this).find("cq-themes-builtin"),this.builtInTemplate=this.builtInMenu.find("template"),this.customMenu=$(this).find("cq-themes-custom"),this.customTemplate=this.customMenu.find("template"))}reinitializeChart(t){this.context.stx.setThemeSettings&&this.context.stx.setThemeSettings(t?t.settings:null)}}i.markup='\n\t\t<cq-themes-builtin cq-no-close>\n\t\t\t<template>\n\t\t\t\t<cq-item></cq-item>\n\t\t\t</template>\n\t\t</cq-themes-builtin>\n\t\t<cq-themes-custom cq-no-close>\n\t\t\t<template>\n\t\t\t\t<cq-theme-custom>\n\t\t\t\t\t<cq-item>\n\t\t\t\t\t\t<cq-label></cq-label>\n\t\t\t\t\t\t<cq-close></cq-close>\n\t\t\t\t\t</cq-item>\n\t\t\t\t</cq-theme-custom>\n\t\t\t</template>\n\t\t</cq-themes-custom>\n\t\t<cq-item stxtap="newTheme()"><cq-plus></cq-plus>New Theme</cq-item>\n\t',e.UI.addComponentDefinition("cq-themes",i)},lt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.timeZoneMap){class t extends e.UI.DialogContentTag{open(t){this.addDefaultMarkup(),super.open(t);var i=this.node,n=this;this.context=t.context;var s=this.context.stx;function a(t){return function(i){n.close();var a=e.timeZoneMap[t];e.ChartEngine.defaultDisplayTimeZone=a,s.setTimeZone(s.dataZone,a),s.chart.symbol&&s.draw()}}var o=i.find("ul, .ciq-ul"),r=i.find(".ciq-btn");for(var c in this.template||(this.template=o.find("li.timezoneTemplate")[0].cloneNode(!0)),o.empty(),e.timeZoneMap){var l=c,d=s.translateIf(l),h=this.template.cloneNode(!0);h.style.display="block",h.innerHTML=d,e.safeClickTouch(h,a(l)),o.append(h)}var p=i.find(".currentUserTimeZone");if(s.displayZone){var u=s.displayZone;for(var m in e.timeZoneMap)e.timeZoneMap[m]===s.displayZone&&(u=m);p.text(s.translateIf("Current Timezone is")+" "+s.translateIf(u)),r.show()}else p.text(s.translateIf("Your timezone is your current location")),r.hide()}removeTimezone(){e.ChartEngine.defaultDisplayTimeZone=null;var t=this.context.stx;t.displayZone=null,t.setTimeZone(),t.displayInitialized&&t.draw(),this.close()}}t.markup='\n\t\t<h4 class="title">Choose Timezone</h4>\n\t\t<cq-close></cq-close>\n\n\t\t<p>To set your timezone use the location button below, or scroll through the following list...</p>\n\t\t<p class="currentUserTimeZone"></p>\n\t\t<div class="detect">\n\t\t\t<div class="ciq-btn" stxtap="removeTimezone()">Use My Current Location</div>\n\t\t</div>\n\t\t<div class="timezoneDialogWrapper" style="max-height:360px; overflow: hidden;">\n\t\t\t<cq-scroll cq-no-maximize class="ciq-ul" style="height:360px;">\n\t\t\t\t<li class="timezoneTemplate" style="display:none;cursor:pointer;"></li>\n\t\t\t</cq-scroll>\n\t\t</div>\n\t\t<div class="instruct">(Scroll for more options)</div>\n\t',e.UI.addComponentDefinition("cq-timezone-dialog",t)}else console.error("timezoneDialog component requires first activating timezone feature.")},dt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{constructor(){super(),this.params={member:null,obj:null,action:"class",value:"active",toggles:[],classes:{},callbacks:[]}}disconnectedCallback(){e.UI.unobserveProperty(this.params.member,this.params.obj,this.listener),super.disconnectedCallback()}begin(){var t=this,i=this.context.stx;this.params.member&&(this.listener=function(e){t.updateFromBinding(t.params)},e.UI.observeProperty(t.params.member,t.params.obj,this.listener)),this.node.stxtap((function(){var e=t.params.toggles,n=t.params.obj;if(e.length>1){for(var s=0;s<e.length;s++){var a=e[s];if(t.currentValue==a){s<e.length-1?t.set(e[s+1]):t.set(e[0]);break}}s==e.length&&t.set(e[0])}else t.currentValue?t.set(!1):t.set(!0);i.draw(),n===i.layout&&i.changeOccurred("layout"),n===i.preferences&&i.changeOccurred("preferences")}))}registerCallback(t,e){!1!==e&&(e=!0),this.params.callbacks.push(t),e&&t.call(this,this.currentValue)}set(t){if(this.params.member)this.params.obj[this.params.member]=t;else{this.currentValue=t;for(var e=0;e<this.params.callbacks.length;e++)this.params.callbacks[e].call(this,this.currentValue)}this.updateClass()}setContext({config:t}){this.currentValue|=!1,this.params.obj=this.context.stx.layout;var e=this.node.attr("cq-member");if("headsUp"==e&&this.wrapInInfoToggle(),t&&t.channels&&t.channels[e]&&(e=t.channels[e]),e&&-1!==e.indexOf(".")){var i=e.split(".");this.params.obj=this.context.stx[i[0]],void 0===this.params.obj&&(this.context.stx[i[0]]=this.params.obj={}),e=i[1]}e&&(this.params.member=e);var n=this.node.attr("cq-action");n&&(this.params.action=n);var s=this.node.attr("cq-value");s&&(this.params.value=s);var a=this.node.attr("cq-toggles");a&&(this.params.toggles=a.split(","));for(var o=0;o<this.params.toggles.length;o++){var r=(a=this.params.toggles)[o];"null"===r?a[o]=null:"true"===r||"false"===r?a[o]="true"===r:isNaN(Number(r))||(a[o]=Number(r))}var c=this.node.attr("cq-toggle-classes");if(c){var l=c.split(/, |,/);this.params.removeClasses=c.split(/, | |,/).filter(t=>t),this.params.classes=this.params.toggles.reduce((function(t,e,i){return t[e]=l[i].split(/ /),t}),{})}if(e&&void 0===this.params.obj[e]){const t=!(!a||!a.length)&&a[a.length-1];this.params.obj[e]=t}this.begin()}updateFromBinding(t){if(this.currentValue=t.obj[t.member],this.params.callbacks.length)for(var e=0;e<this.params.callbacks.length;e++)this.params.callbacks[e].call(this,this.currentValue);else"class"==this.params.action&&(this.currentValue?this.node.addClass(this.params.value):this.node.removeClass(this.params.value));this.updateClass(),"crosshair"==t.member&&!1===this.currentValue&&this.context.stx.doDisplayCrosshairs()}updateClass(){const{removeClasses:t,classes:e}=this.params;if(t&&void 0!==this.currentValue&&(this.classList.remove(...t),e[this.currentValue][0])){let t=e[this.currentValue];this.classList.add(...t)}}wrapInInfoToggle(){if(!e.findClosestParent(this,"cq-info-toggle")){var t=document.createElement("cq-info-toggle");this.parentNode.replaceChild(t,this),t.appendChild(this)}}}e.UI.addComponentDefinition("cq-toggle",i)},ht=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.Drawing){class t extends e.UI.ContextTag{connectedCallback(){this.attached||(super.connectedCallback(),this.node=$(this),this.params={toolSelection:this.node.find("*[cq-current-tool]"),lineSelection:this.node.find("*[cq-line-style]"),fontSizeSelection:this.node.find("*[cq-font-size]"),fontFamilySelection:this.node.find("*[cq-font-family]"),fontStyleToggle:this.node.find("cq-annotation-italic"),fontWeightToggle:this.node.find("cq-annotation-bold"),axisLabelToggle:this.node.find("cq-axis-label .ciq-checkbox"),fillColor:this.node.find("cq-fill-color").not("cq-cvp-controller"),lineColor:this.node.find("cq-line-color").not("cq-cvp-controller"),cvpControllers:this.node.find("cq-cvp-controller")},this.params.cvpControllers.prop("toolbar",this),this.noToolSelectedText="")}clearDrawings(){this.context.stx.clearDrawings(null,!1)}crosshairs(t){var e=this.context.stx;$(this.params.toolSelection).html($(t.node).html()),e.changeVectorType(null),e.layout.crosshair=!0,e.doDisplayCrosshairs(),e.findHighlights(!1,!0),e.changeOccurred("layout"),e.draw(),e.updateChartAccessories(),this.node.find("*[cq-section]").removeClass("ciq-active"),this.emit()}defaultElements(t){var e=[];for(var i in t)"color"==i?e.push("cq-line-color"):"fillColor"==i?e.push("cq-fill-color"):"pattern"==i||"lineWidth"==i?e.push("cq-line-style"):"axisLabel"==i?e.push("cq-axis-label"):"font"==i?e.push("cq-annotation"):"parameters"==i&&e.push("cq-clickable");return e}emit(){var t=new Event("change",{bubbles:!0,cancelable:!0});this.node.find("*[cq-toolbar-dirty]").addClass("ciq-active"),this.dispatchEvent(t)}getFillColor(t){var i=$(t.node),n=this.context.stx.currentVectorParameters.fillColor;"transparent"!=n&&"auto"!=n||(n=""),i.css({background:n});var s=e.getBackgroundColor(this.parentNode);if(n&&Math.abs(e.hsl(s)[2]-e.hsl(n)[2])<.2){var a=e.chooseForegroundColor(s);i.css({border:"solid "+a+" 1px"})}else i.css({border:""})}getLineColor(t){var i=$(t.node),n=this.context.stx.currentVectorParameters.currentColor;"transparent"!=n&&"auto"!=n||(n=""),i.css({background:n});var s=e.getBackgroundColor(this.parentNode);if(!n||Math.abs(e.hsl(s)[2]-e.hsl(n)[2])<.2){var a=e.chooseForegroundColor(s);i.css({border:"solid "+a+" 1px"}),n||i.css({background:"linear-gradient(to bottom right, "+a+", "+a+" 49%, "+s+" 50%, "+s+")"})}else i.css({border:""})}noTool(){var t=this.context.stx;t.changeVectorType(null),t.layout.crosshair&&(t.layout.crosshair=!1,t.changeOccurred("layout"),t.doDisplayCrosshairs()),t.preferences.magnet&&this.toggleMagnet(this),$(this.params.toolSelection).text(this.noToolSelectedText),$(this.params.toolSelection).attr("cq-current-tool",""),this.node.find("*[cq-section]").removeClass("ciq-active"),this.emit()}pickFillColor(t){var e=t.node,i=$("cq-color-picker");if(i.length){var n=i[0],s=this;n.callback=function(t){s.context.stx.currentVectorParameters.fillColor=t,s.getFillColor({node:e}),s.emit()},n.display({node:e,context:this.context})}else console.log("DrawingToolbar.prototype.pickFillColor: no ColorPicker available")}pickLineColor(t){var e=t.node,i=$("cq-color-picker");if(i.length){var n=i[0],s=this;n.callback=function(t){s.context.stx.currentVectorParameters.currentColor=t,s.getLineColor({node:e}),s.emit()};var a=$(e).attr("cq-overrides");a&&(a=a.split(",")),n.display({node:e,context:this.context,overrides:a})}else console.log("DrawingToolbar.prototype.pickLineColor: no ColorPicker available")}restoreDefaultConfig(t,i){var n=this.context.stx;e.Drawing.restoreDefaultConfig(n,n.currentVectorParameters.vectorType,i),this.node.find("*[cq-toolbar-action='restore']").removeClass("ciq-active"),this.sync()}saveConfig(){var t=this.context.stx;e.Drawing.saveConfig(t,t.currentVectorParameters.vectorType),this.node.find("*[cq-toolbar-action='restore']").addClass("ciq-active"),this.sync()}setFibs(t,e){var i=this.context.stx.currentVectorParameters.fibonacci;if(i){for(var n=0;n<i.fibs.length;n++)i.fibs[n].parameters.lineWidth=t,i.fibs[n].parameters.pattern=e;i.timezone.parameters.lineWidth=t,i.timezone.parameters.pattern=e}}setFontFamily(t,e){var i=this.context.stx;i.currentVectorParameters.annotation&&(i.currentVectorParameters.annotation.font.family="Default"==e?null:e),$(this.params.fontFamilySelection).text(e),this.emit()}setFontSize(t,e){var i=this.context.stx;i.currentVectorParameters.annotation&&(i.currentVectorParameters.annotation.font.size=e),$(this.params.fontSizeSelection).text(e),this.emit()}setContext(t){this.noToolSelectedText=$(this.params.toolSelection).text(),this.sync();var e=this;this.eventListeners.push(t.stx.addEventListener("theme",(function(t){e.sync()})))}setLine(t,e,i){var n=this.context.stx;n.currentVectorParameters.lineWidth=e,n.currentVectorParameters.pattern=i,this.setFibs(e,i),this.currentLineSelectedClass&&$(this.params.lineSelection).removeClass(this.currentLineSelectedClass),this.currentLineSelectedClass="ciq-"+i+"-"+parseInt(e,10),"none"==i?this.currentLineSelectedClass=null:$(this.params.lineSelection).addClass(this.currentLineSelectedClass),this.emit()}sync(t){var i=this.context.stx;t?i.currentVectorParameters=e.extend(i.currentVectorParameters||{},t):t=i.currentVectorParameters,this.setLine(null,t.lineWidth,t.pattern);var n=i.canvasStyle("stx_annotation"),s=t.annotation&&t.annotation.font,a=s&&s.size||n.fontSize;this.setFontSize(null,a);var o=s&&s.family||n.fontFamily;this.setFontFamily(null,o);var r=s&&s.style||n.fontStyle;$(this.params.fontStyleToggle)["italic"===r?"addClass":"removeClass"]("ciq-active");var c=s&&s.weight||n.fontWeight;$(this.params.fontWeightToggle)["bold"===c||c>=700?"addClass":"removeClass"]("ciq-active"),$(this.params.axisLabelToggle)[t.axisLabel?"addClass":"removeClass"]("ciq-active"),this.getFillColor({node:$(this.params.fillColor)}),this.getLineColor({node:$(this.params.lineColor)}),$(this.params.cvpControllers).each((function(){this.sync(t)})),this.node.find("*[cq-toolbar-dirty]").removeClass("ciq-active")}toggleAxisLabel(t){var e=this.context.stx;!0===e.currentVectorParameters.axisLabel?(e.currentVectorParameters.axisLabel=!1,$(t.node).removeClass("ciq-active")):(e.currentVectorParameters.axisLabel=!0,$(t.node).addClass("ciq-active")),this.emit()}toggleFontStyle(t,e){var i=this.context.stx;"italic"==e?"italic"==i.currentVectorParameters.annotation.font.style?(i.currentVectorParameters.annotation.font.style=null,$(t.node).removeClass("ciq-active")):(i.currentVectorParameters.annotation.font.style="italic",$(t.node).addClass("ciq-active")):"bold"==e&&("bold"==i.currentVectorParameters.annotation.font.weight?(i.currentVectorParameters.annotation.font.weight=null,$(t.node).removeClass("ciq-active")):(i.currentVectorParameters.annotation.font.weight="bold",$(t.node).addClass("ciq-active"))),this.emit()}toggleMagnet(t){var i=$(t.node),n=this.context.stx;n.preferences.magnet?(i.removeClass("active"),n.preferences.magnet=!1):(i.addClass("active"),n.preferences.magnet=!0),e.clearCanvas(n.chart.tempCanvas,n)}tool(t,i){if(i||(i=t.node.getAttribute("cq-tool")),i){var n=this.context.stx;n.clearMeasure(),n.changeVectorType(i),$(this.params.toolSelection).html($(t.node).html()),$(this.params.toolSelection).attr("cq-current-tool",i),this.node.find("*[cq-section]").removeClass("ciq-active");var s=e.Drawing.getDrawingParameters(n,i);if(s){this.node.find("*[cq-toolbar-action='save']").addClass("ciq-active");var a=n.preferences.drawings;a&&a[i]&&this.node.find("*[cq-toolbar-action='restore']").addClass("ciq-active"),"fibtimezone"===i&&delete s.parameters;var o=$(this.params.lineSelection).parent().find(".ciq-none");o.hide();for(var r=this.defaultElements(s),c=0;c<r.length;c++)$(this.node).find(r[c]).addClass("ciq-active"),"cq-fill-color"==r[c]&&o.show();for(r=e.Drawing[i].prototype.$controls,c=0;r&&c<r.length;c++)$(this.node).find(r[c]).addClass("ciq-active")}this.sync()}}}e.UI.addComponentDefinition("cq-toolbar",t)}else console.error("toolbar component requires first activating drawing feature.")},pt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{constructor(){super(),this.redoButton=null,this.undostack=[],this.redostack=[],this.contexts=[]}connectedCallback(){if(!this.attached){super.connectedCallback();var t=this;$(this).stxtap((function(){t.undo()}))}}clear(t){this.setButtonStyle()}handleEvent(t,e,i){this.undostack.push({context:t,drawings:i.before}),this.redostack=[],this.setButtonStyle()}keyStroke(t,e,i,n){return"z"==e&&(n.ctrl||n.cmd)?(n.shift?this.redo():this.undo(),!0):"y"==e&&(n.ctrl||n.cmd)?(this.redo(),!0):void 0}manageContext(t){this.addClaim(this);var e=this;this.eventListeners.push(t.stx.addEventListener("undoStamp",(function(i){e.handleEvent(t,"undoStamp",i)}))),this.contexts.push(t)}redo(){var t=this.redostack.pop();if(t){var e=t.context;this.undostack.push({context:e,drawings:e.stx.exportDrawings()});var i=t.drawings;e.stx.abortDrawings(!0),e.stx.importDrawings(i),e.stx.changeOccurred("vector"),e.stx.draw()}this.setButtonStyle()}setButtonStyle(){this.undostack.length?$(this).attr("cq-active","true"):$(this).removeAttr("cq-active"),this.redoButton&&(this.redostack.length?$(this.redoButton).attr("cq-active","true"):$(this.redoButton).removeAttr("cq-active"))}setContext(t){this.manageContext(this.context);var e=this;this.addInjection("append","initializeChart",(function(){e.undostack=[],e.redostack=[],e.clear()}))}undo(){for(var t=!1,e=0;e<this.contexts.length;e++)this.contexts[e].stx.activeDrawing&&(this.contexts[e].stx.undo(),t=!0);if(!t){var i=this.undostack.pop();if(i){var n=i.context;this.redostack.push({context:n,drawings:n.stx.exportDrawings()});var s=i.drawings;n.stx.abortDrawings(!0),n.stx.importDrawings(s),n.stx.changeOccurred("vector"),n.stx.draw()}this.setButtonStyle()}}}e.UI.addComponentDefinition("cq-undo",i)},ut=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{open(t){this.addDefaultMarkup(),this.querySelector("input").value="",super.open(t)}save(){var t=this.node.find("input").val();if(t){var i=!1,n=this.context.stx.exportLayout();$("cq-views").each((function(){for(var s,a=this.params.viewObj,o=0;o<a.views.length&&(s=a.views[o],t!=e.first(s));o++);o==a.views.length&&((s={})[t]={},a.views.push(s)),s[t]=n,delete s[t].candleWidth,this.renderMenu(),i||(i=!0,this.params.nameValueStore&&this.params.nameValueStore.set("stx-views",a.views))})),this.close()}}}i.markup='\n\t\t<h4>Save View</h4>\n\t\t<div stxtap="close()" class="ciq-icon ciq-close"></div>\n\t\t<div style="text-align:center;margin-top:10px;">\n\t\t\t<i>Enter name of view:</i>\n\t\t\t<p>\n\t\t\t\t<input spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="none" maxlength="40" placeholder="Name"><br>\n\t\t\t</p>\n\t\t\t<span class="ciq-btn" stxtap="save()">Save</span>\n\t\t</div>\n\t',e.UI.addComponentDefinition("cq-view-dialog",i)},mt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{connectedCallback(){super.connectedCallback(),this.addDefaultMarkup()}initialize(t){this.params=Object.assign({},t),e.ensureDefaults(this.params,{viewObj:{views:[]},nameValueStore:e.NameValueStore&&new e.NameValueStore,template:"template[cq-view]"}),this.params.template=this.node.find(this.params.template),this.params.template.detach();var i=this;this.params.nameValueStore&&this.params.nameValueStore.get("stx-views",(function(t,e){!t&&e&&(i.params.viewObj.views=e),i.params.cb&&i.params.cb.call(i),i.renderMenu()}))}setContext({config:t}){t&&t.menuViewConfig&&this.initialize(t.menuViewConfig)}renderMenu(){var t=$(this.node),i=this,n=i.context.stx;function s(t){return function(e){e.stopPropagation();var n=!1;$("cq-views").each((function(){this.params.viewObj.views.splice(t,1),n||(this.params.nameValueStore&&this.params.nameValueStore.set("stx-views",i.params.viewObj.views),n=!0),this.renderMenu()}))}}function a(t){return function(s){s.stopPropagation(),i.uiManager.closeMenu(),i.context.loader&&i.context.loader.show();var a=e.first(i.params.viewObj.views[t]);setTimeout((function(){n.importLayout(i.params.viewObj.views[t][a],{managePeriodicity:!0,preserveTicksAndCandleWidth:!0,cb:function(){n.changeOccurred("layout"),i.context.loader&&i.context.loader.hide()}})}),10)}}t.find("cq-views-content cq-item").remove();for(var o=0;o<this.params.viewObj.views.length;o++){var r=e.first(i.params.viewObj.views[o]);if("recent"!=r){var c=e.UI.makeFromTemplate(this.params.template),l=c.find("cq-label"),d=c.find("div");l.length&&(l.addClass("view-name-"+r),l.text(r)),d.length&&d.stxtap(s(o)),this.makeTap(c[0],a(o)),t.find("cq-views-content").append(c)}}var h=t.find("cq-view-save");if(h){const{context:t}=this,e=this;this.makeTap(h.find("cq-item")[0],(function(i){t.config?e.channelWrite(t.config.channels.dialog,{type:"view",params:{context:t}}):document.querySelector("cq-view-dialog").open({context:t})}))}this.params.renderCB&&this.params.renderCB(t)}}i.markup='\n\t\t<cq-heading>Saved Views</cq-heading>\n\t\t<cq-views-content>\n\t\t\t<template cq-view>\n\t\t\t\t<cq-item>\n\t\t\t\t\t<cq-label></cq-label>\n\t\t\t\t\t<div class="ciq-icon ciq-close"></div>\n\t\t\t\t</cq-item>\n\t\t\t</template>\n\t\t</cq-views-content>\n\t\t<cq-separator cq-partial></cq-separator>\n\t\t<cq-view-save>\n\t\t\t<cq-item><cq-plus></cq-plus>Save View</cq-item>\n\t\t</cq-view-save>\n\t',e.UI.addComponentDefinition("cq-views",i)},gt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{static get observedAttributes(){return["corrective","decoration","impulse","show-lines"]}get corrective(){return this.getAttribute("corrective")}set corrective(t){t?this.setAttribute("corrective",t.join(" ")):this.removeAttribute("corrective")}get decoration(){return this.getAttribute("decoration")}set decoration(t){t?this.setAttribute("decoration",t):this.removeAttribute("decoration")}get impulse(){return this.getAttribute("impulse")}set impulse(t){t?this.setAttribute("impulse",t.join(" ")):this.removeAttribute("impulse")}get showLines(){return this.hasAttribute("show-lines")}set showLines(t){t?(this.setAttribute("show-lines",""),this.lineToggleCheckbox.classList.add("ciq-active")):this.removeAttribute("show-lines")}get template(){return this.getAttribute("template")}set template(t){return this.setAttribute("template",t)}static templates(){return{"Grand Supercycle":{impulse:["I","II","III","IV","V"],corrective:["a","b","c"],decoration:"enclosed"},Supercycle:{impulse:["I","II","III","IV","V"],corrective:["a","b","c"],decoration:"parentheses"},Cycle:{impulse:["I","II","III","IV","V"],corrective:["a","b","c"],decoration:null},Primary:{impulse:["1","2","3","4","5"],corrective:["A","B","C"],decoration:"enclosed"},Intermediate:{impulse:["1","2","3","4","5"],corrective:["A","B","C"],decoration:"parentheses"},Minor:{impulse:["1","2","3","4","5"],corrective:["A","B","C"],decoration:null},Minute:{impulse:["i","ii","iii","iv","v"],corrective:["a","b","c"],decoration:"enclosed"},Minuette:{impulse:["i","ii","iii","iv","v"],corrective:["a","b","c"],decoration:"parentheses"},"Sub-Minuette":{impulse:["i","ii","iii","iv","v"],corrective:["a","b","c"],decoration:null}}}attributeChangedCallback(t,e,i){if(!this.stx)return;let n,s=this.stx.currentVectorParameters,a=s.waveParameters||{};switch(t){case"template":let t=this.templates[i];t&&(n={decoration:t.decoration});break;case"impulse":n={impulse:i?i.split(" "):i};break;case"corrective":n={corrective:i?i.split(" "):i};break;case"decoration":n={decoration:i};break;case"show-lines":n={showLines:this.showLines}}s.waveParameters=Object.assign(a,n)}constructor(){super(),this.templates=i.templates()}connectedCallback(){if(!this.attached){this.template="Grand Supercycle";var t=document.querySelector('template[cq-wave-parameters], template[cq-wave-parameters="true"]');e.UI.makeFromTemplate(t,this),this.templateHeader=this.querySelector(".ciq-active-template"),this.impulseHeader=this.querySelector(".ciq-active-impulse"),this.correctiveHeader=this.querySelector(".ciq-active-corrective"),this.decorators={blank:this.querySelector(".ciq-btn:nth-of-type(1n)"),parentheses:this.querySelector(".ciq-btn:nth-of-type(2n)"),enclosed:this.querySelector(".ciq-btn:nth-of-type(3n)")},this.lineToggleCheckbox=this.querySelector("span.ciq-checkbox"),super.connectedCallback()}}disconnectedCallback(){super.disconnectedCallback()}activate(){this.stx&&(this.cvp=this.stx.currentVectorParameters,this.update(null,"template",this.template),this.showLines=!0)}setContext(){this.stx=this.context.stx}toggleLines(){let t=this.lineToggleCheckbox,e=t.classList.contains("ciq-active");this.showLines=!e,e?t.classList.remove("ciq-active"):t.classList.add("ciq-active")}update(t,e,i){if("template"===e){this.template=i,this.templateHeader.innerHTML=i;let t=this.templates[this.template];if(t){this.impulse=t.impulse,this.impulseHeader.innerHTML=t.impulse.join(" "),this.corrective=t.corrective,this.correctiveHeader.innerHTML=t.corrective.join(" ");for(let t in this.decorators)this.decorators[t].classList.remove("ciq-active");let e=t.decoration||"blank";this.decorators[e].classList.add("ciq-active"),this.decoration=e}else this.cvp.waveParameters={corrective:this.corrective.split(" "),impulse:this.impulse.split(" "),decoration:this.decoration}}else{if("decoration"===e){for(let t in this.decorators)this.decorators[t].classList.remove("ciq-active");t.node.classList.add("ciq-active"),this.decoration=t.node.getAttribute("decoration")}else if("showLines"===e);else{let t=i?i.split(","):i;this[e]=t,this[e+"Header"].innerHTML=t?t.join(" "):"- - -"}this.templateHeader.innerHTML=this.template="Custom"}}}e.UI.addComponentDefinition("cq-wave-parameters",i)},ft=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;const i=e.UI._webcomponents.list["cq-dialog"];if(i){class t extends i.classDefinition{constructor(){super(),this.params={colorMap:[["#ffffff","#e1e1e1","#cccccc","#b7b7b7","#a0a0a5","#898989","#707070","#626262","#555555","#464646","#363636","#262626","#1d1d1d","#000000"],["#f4977c","#f7ac84","#fbc58d","#fff69e","#c4de9e","#85c99e","#7fcdc7","#75d0f4","#81a8d7","#8594c8","#8983bc","#a187bd","#bb8dbe","#f29bc1"],["#ef6c53","#f38d5b","#f8ae63","#fff371","#acd277","#43b77a","#2ebbb3","#00bff0","#4a8dc8","#5875b7","#625da6","#8561a7","#a665a7","#ee6fa9"],["#ea1d2c","#ee652e","#f4932f","#fff126","#8ec648","#00a553","#00a99c","#00afed","#0073ba","#0056a4","#323390","#66308f","#912a8e","#e9088c"],["#9b0b16","#9e4117","#a16118","#c6b920","#5a852d","#007238","#00746a","#0077a1","#004c7f","#003570","#1d1762","#441261","#62095f","#9c005d"],["#770001","#792e03","#7b4906","#817a0b","#41661e","#005827","#005951","#003b5c","#001d40","#000e35","#04002c","#19002b","#2c002a","#580028"]]}}connectedCallback(){this.attached||(super.connectedCallback(),this.build())}build(){this.addDefaultMarkup();var t=$(this),e=t.attr("cq-colors");if(e){e=e.split(",");var i=Math.ceil(Math.sqrt(e.length));this.params.colorMap=[];for(var n=0,s=[],a=0;a<e.length;a++)n>=i&&(n=0,this.params.colorMap.push(s),s=[]),s.push(e[a]),n++;this.params.colorMap.push(s)}this.cqOverrides=t.find("cq-overrides"),this.template=this.cqOverrides.find("template"),this.initialize()}display(t){var i=$(t.node),n=i[0].getBoundingClientRect();this.picker.css({top:"0px",left:"0px"});var s=this.parentNode.getBoundingClientRect(),a=n.left-s.left+i.width()+10,o=n.top-s.top+5,r=$(document).width(),c=this.picker.width();a+c>r&&(a=r-c-20);var l=$(document).height(),d=this.picker.height();o+d>l&&(o=l-d-20),this.picker.css({left:a+"px",top:o+"px"}),this.cqOverrides.emptyExceptTemplate();var h=t.context||this.context||e.UI.getMyContext(this);if(t.overrides&&this.template.length)for(var p=0;p<t.overrides.length;p++){var u=t.overrides[p],m=e.UI.makeFromTemplate(this.template,!0);h.stx&&(u=h.stx.translateIf(u)),m.text(u),m.stxtap(function(t,e){return function(){t.pickColor(e)}}(this,u))}this.picker.hasClass("stxMenuActive")?h.e&&h.e.stopPropagation():this.picker[0].open({context:h})}initialize(){function t(t,e){return function(){t.pickColor(e)}}this.picker=$(this),this.colors=this.picker.find("cq-colors"),this.colors.length||(this.colors=this.picker),this.colors.empty();for(var e=0;e<this.params.colorMap.length;e++)for(var i=this.params.colorMap[e],n=$("<UL></UL>").appendTo(this.colors),s=0;s<i.length;s++){var a=$("<LI></LI>").appendTo(n),o=$("<SPAN></SPAN>").appendTo(a);o.css({"background-color":i[s]}),o.stxtap(t(this,i[s]))}}pickColor(t){this.callback&&this.callback(t),this.close()}resize(){}setColors(t){this.params.colorMap=t,this.initialize()}}t.markup='\n\t\t<cq-colors></cq-colors>\n\t\t<cq-overrides>\n\t\t\t<template>\n\t\t\t\t<div class="ciq-btn"></div>\n\t\t\t</template>\n\t\t</cq-overrides>\n\t',e.UI.addComponentDefinition("cq-color-picker",t)}else console.error("colorPicker component requires first activating dialog component.")},vt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;const i=e.UI._webcomponents.list["cq-palette"];if(i)if(e.Drawing){class t extends i.classDefinition{constructor(){super(),this.mode="",this.callbacks=[],this.toolSettings={favList:[],toolGroup:""},this.toolShortcuts={},this.store=e.NameValueStore&&new e.NameValueStore,this.loadToolSettings()}setupKeyboardActivation(t){if(void 0!==this.getAttribute("cq-keystroke-claim")){let t=this.context.topNode.querySelectorAll("*[cq-tool][cq-tool-shortcut]");for(let e=0;e<t.length;e++){let i=t[e].getAttribute("cq-tool-shortcut");if(/^[A-Za-z]{1}$/g.test(i)){this.toolShortcuts[i.toUpperCase()]={toolName:t[e].getAttribute("cq-tool"),node:t[e]};let n=t[e].querySelector("label"),s=document.createElement("span");s.classList.add("shortcut"),s.innerHTML=" (Alt+"+i.toUpperCase()+")",n.appendChild(s)}else console.warn("cq-tool-shortcut attribute must be a single letter: "+i+" ignored.")}this.addClaim(this)}}keyStroke(t,e,i,n){if(i.altKey){let t=String.fromCharCode(i.which).toUpperCase(),e=this.toolShortcuts[t];if(e){const t=this.channels?this.channels.drawing:"channel.drawing";this.channelWrite(t,!0),this.tool({node:e.node},e.toolName)}}else if("Escape"===i.key){let t=this.context.topNode.querySelector('*[cq-tool="notool"]');t&&this.noTool({node:t})}}handleMessage(t,e){switch(t){case"changeToolSettings":this.activateTool(e.activator,e.toolName);break;case"toggleDrawingPalette":this.togglePalette();break;case"hideDrawingPalette":case"dockWillResize":this.hidePalette();break;case"dockDidResize":this.resetScroller();break;case"context":"stop"===e&&(this.toolContextMenu.style.display="none")}}loadToolSettings(){if(this.store){let t=this;this.store.get("CIQ.DrawingToolSettings",(function(e,i){!e&&i&&i.favList&&(t.toolSettings=Object.assign(t.toolSettings,i))}))}}storeToolSettings(){this.store&&this.store.set("CIQ.DrawingToolSettings",JSON.stringify(this.toolSettings))}setContext(t){const{config:e,stx:i}=t;e&&(this.addDefaultMarkup(this,this.getMarkup(e)),this.channels={drawing:e.channels.drawing}),this.init(),this.params={toolGroupSelection:this.querySelector("*[cq-tool-group-selection]")},this.setFavorites(),this.setMode("grid"),this.setEvenOdd(),this.toolContextMenu=this.createContextMenu(),this.addEventListener("contextmenu",function(t){if(t.preventDefault(),null!==t.target.getAttribute("cq-tool-group")){let e=t.target.getBoundingClientRect(),i=this.getBoundingClientRect();this.showToolContextMenu(t.target.getAttribute("cq-tool"),e.top+e.height-i.top,e.left-i.left)}}.bind(this)),this.setupKeyboardActivation(),this.pairUndoRedo(),this.toolSettings.toolGroup&&this.setToolGroup({node:this.querySelector('cq-item[cq-tool-group="'+this.toolSettings.toolGroup+'"]')},this.toolSettings.toolGroup),this.channels&&this.channelSubscribe(this.channels.drawing,t=>{t?(this.resetScroller(),this.priorVectorType&&!i.currentVectorParameters.vectorType&&i.changeVectorType(this.priorVectorType)):(this.priorVectorType=i.currentVectorParameters.vectorType,i.changeVectorType(""))})}pairUndoRedo(){const t=this.qs("cq-redo",this),e=this.qs("cq-undo",this);t.pairUp(e)}changeView(t,e){this.setMode(e);for(var i=0;i<this.callbacks.length;i++)this.callbacks[i].call(this,this.mode)}createContextMenu(){let t=document.createElement("div");t.className="menu-item",t.innerHTML="Add/Remove Favorite",t.addEventListener("mousedown",function(t){t.stopPropagation(),1===t.which&&(this.toggleFavorite(t.currentTarget.parentElement.getAttribute("context-tool")),this.paletteDock.stopContext(this))}.bind(this));let e=document.createElement("div");return e.appendChild(t),e.className="tool-context-menu",this.node.append(e),e}registerCallback(t){this.callbacks.push(t)}resetScroller(){const t=this.querySelector(".tool-group cq-scroll");if(!t)return!1;this.setEvenOdd(),t.refresh()}setActiveButton(t){$(this).find(".ciq-tool.active").removeClass("active");$(t).find("label").html();t.getAttribute("stxtap"),t.classList.add("active"),$(".ciq-mobile-palette-toggle").is(":visible")||this.togglePalette()}setMode(t){t="list"===t?t:"grid",this.mode=t,this.classList.remove("list"),this.classList.remove("grid"),this.classList.add(this.mode),this.resetScroller(),this.paletteDock.handleResize({resizeChart:!0})}setEvenOdd(t){$(this.node).find(".tool-group cq-scroll cq-item").filter(":visible").each((function(t){t%2?this.classList.add("odd"):this.classList.remove("odd")}))}setFavorites(){for(var t=this.querySelectorAll(".tool-group [cq-tool]"),e=0;e<t.length;e++){var i=t[e];if(null===i.querySelector(".fav-marker")){let t=document.createElement("div");t.className="fav-marker",t.addEventListener("click",this.handleFavoriteClick.bind(this)),t.addEventListener("touchstart",this.handleFavoriteClick.bind(this),!0),i.appendChild(t)}i.getAttribute("cq-tool-group").indexOf("favorite")>=0&&i.setAttribute("cq-tool-group",i.getAttribute("cq-tool-group").replace("favorite","")),this.toolSettings.favList.indexOf(i.getAttribute("cq-tool"))>=0&&i.setAttribute("cq-tool-group",i.getAttribute("cq-tool-group")+" favorite")}}handleFavoriteClick(t){t.stopPropagation(),t.preventDefault(),this.toggleFavorite(t.target.parentElement.getAttribute("cq-tool")),this.hidePalette()}addFavorite(t){this.toolSettings.favList.indexOf(t)<0&&(this.toolSettings.favList.push(t),this.storeToolSettings(),this.setFavorites())}showToolContextMenu(t,e,i){this.toolContextMenu.style.display="block",this.toolContextMenu.style.top=e+"px",this.toolContextMenu.style.left=i+"px",this.toolContextMenu.setAttribute("context-tool",t),this.paletteDock.startContext(this)}toggleFavorite(t){let e=this.toolSettings.favList.indexOf(t);e>=0?this.toolSettings.favList.splice(e,1):this.toolSettings.favList.push(t),this.storeToolSettings(),this.setFavorites()}setToolGroup(t,e){this.toolSettings.toolGroup=e,this.querySelector(".tool-group").setAttribute("tool-group-filter",this.toolSettings.toolGroup),this.querySelector(".tool-group cq-scroll").top(),this.setEvenOdd(e);for(var i=0;i<this.callbacks.length;i++)this.callbacks[i].call(this,this.mode);this.showPalette(),$(this.params.toolGroupSelection).html(t.node.innerHTML),this.storeToolSettings()}togglePalette(){this.classList.toggle("palette-hide")}hidePalette(){this.classList.add("palette-hide")}showPalette(){this.classList.remove("palette-hide")}activateTool(t,e){let i=null;i=!t.node&&e?this.querySelector("[cq-tool="+e+"]"):t.node,this.setActiveButton(i);var n=this.context.stx;n.clearMeasure(),n.changeVectorType(e)}noTool(t,e){this.tool(t,"notool")}tool(t,e){if(e||(e=t.node.getAttribute("cq-tool")),e){var i=t.node.querySelector("label").innerHTML;this.activateTool(t,e),this.sendMessage&&this.sendMessage("changeTool",{activator:t,toolName:e,toolLabel:i})}}clearDrawings(){this.sendMessage&&this.sendMessage("clearDrawings")}restoreDefaultConfig(t,e){this.sendMessage&&this.sendMessage("restoreDefaultConfig",{activator:t,all:e})}getMarkup(t){const e=t.getMenu("drawingTools",!0).join(""),i=t.drawingToolGrouping.map(t=>`<cq-item\n\t\t\t\t\tstxtap="setToolGroup('${t.toLowerCase()}')"\n\t\t\t\t\tcq-tool-group="${t.toLowerCase()}">${t}\n\t\t\t\t</cq-item>`).join("");return this.constructor.markup.replace("{{tools}}",e).replace("{{toolGrouping}}",i)}}t.markup='\n\t<div class="palette-container">\n\t\t<div class="drag-strip"></div>\n\t\t\t<div class="mini-widget-group">\n\t\t\t\t\t<cq-item class="ciq-mini-widget" cq-view="list" stxtap="changeView(\'list\')"><span class="icon"></span><label>List View</label></cq-item>\n\t\t\t\t\t<cq-item class="ciq-mini-widget" cq-view="grid" stxtap="changeView(\'grid\')"><span class="icon"></span><label>Grid View</label></cq-item>\n\t\t\t\t\t<cq-item class="ciq-mini-widget" cq-view="detach" stxtap="detach()"><span class="icon"></span><label>Detach</label></cq-item>\n\t\t\t\t\t<cq-item class="ciq-mini-widget" cq-view="attach" stxtap="dock()"><span class="icon"></span><label>Attach</label></cq-item>\n\t\t\t</div>\n\t\t\t<cq-separator></cq-separator>\n\t\t\t<div class="primary-tool-group">\n\t\t\t\t<cq-item class="ciq-tool active" cq-tool="notool" stxtap="tool()"><span class="icon pointer"></span><label>No Tool</label></cq-item>\n\t\t\t\t<cq-item class="ciq-tool" cq-tool="measure" stxtap="tool()"><span class="icon measure"></span><label>Measure</label></cq-item>\n\t\t\t\t<cq-undo class="ciq-tool"><span class="icon undo"></span><label>Undo</label></cq-undo>\n\t\t\t\t<cq-redo class="ciq-tool"><span class="icon redo"></span><label>Redo</label></cq-redo>\n\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t<span cq-tool-group-selection>All</span>\n\t\t\t\t\t<cq-menu-dropdown class="ciq-tool-group-selection">\n\t\t\t\t\t\t{{toolGrouping}}\n\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t</cq-menu>\n\t\t\t</div>\n\t\t\t<cq-separator></cq-separator>\n\t\t\t<div class="tool-group" tool-group-filter="all">\n\t\t\t\t<cq-scroll cq-no-resize>\n\t\t\t\t\t{{tools}}\n\t\t\t\t</cq-scroll>\n\t\t\t\t<cq-separator></cq-separator>\n\t\t\t\t<div class="mini-widget-group mini-widget-foot">\n\t\t\t\t\t<cq-toggle class="ciq-mini-widget ciq-magnet" cq-member="preferences.magnet" cq-toggles="true,75,false" cq-toggle-classes="active strong,active,"><span class="icon magnet"></span><label>Magnet</label></cq-toggle>\n\t\t\t\t\t<cq-item class="ciq-mini-widget" stxtap="clearDrawings()"><span class="icon clear"></span><label>Clear Drawings</label></cq-item>\n\t\t\t\t\t<cq-item class="ciq-mini-widget" stxtap="restoreDefaultConfig(true)"><span class="icon restore"></span><label>Restore Default Parameters</label></cq-item>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t<div class="resize-strip"></div>\n\t</div>\n\t',e.UI.addComponentDefinition("cq-drawing-palette",t)}else console.error("drawingPalette component requires first activating drawing feature.");else console.error("drawingPalette component requires first activating palette component.")},qt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;const i=e.UI._webcomponents.list["cq-palette"];if(i)if(e.Drawing){class t extends i.classDefinition{setContext(t){this.addDefaultMarkup(),this.init(),this.node=$(this),this.params={lineSelection:this.node.find("*[cq-line-style]"),fontSizeSelection:this.node.find("*[cq-font-size]"),fontFamilySelection:this.node.find("*[cq-font-family]"),fontStyleToggle:this.node.find("cq-annotation-italic"),fontWeightToggle:this.node.find("cq-annotation-bold"),axisLabelToggle:this.node.find("cq-axis-label .ciq-checkbox"),fillColor:this.node.find("cq-fill-color").not("cq-cvp-controller"),lineColor:this.node.find("cq-line-color").not("cq-cvp-controller"),cvpControllers:this.node.find("cq-cvp-controller"),waveParameters:this.node.find("cq-wave-parameters")},this.params.cvpControllers.prop("toolbar",this),this.noToolSelectedText="",this.noToolSelectedText=$(this.params.toolSelection).text(),this.sync(),t.stx.setDrawingContainer&&t.stx.setDrawingContainer(this);var e=this;t.stx.addEventListener("theme",(function(t){e.sync()}))}handleMessage(t,e){switch(t){case"changeTool":this.setActiveToolLabel(e.toolLabel),this.toolSettings(e.activator,e.toolName);break;case"clearDrawings":this.clearDrawings();break;case"restoreDefaultConfig":this.restoreDefaultConfig(e.activator,e.all)}}clearDrawings(){this.context.stx.clearDrawings(null,!1)}crosshairs(t){var e=this.context.stx;$(this.params.toolSelection).html($(t.node).html()),e.changeVectorType(null),e.layout.crosshair=!0,e.doDisplayCrosshairs(),e.findHighlights(!1,!0),e.changeOccurred("layout"),e.draw(),e.updateChartAccessories(),this.node.find("*[cq-section]").removeClass("ciq-active"),this.emit()}tool(t,e){this.toolSettings(t,e),this.setActiveToolLabel(e),this.sendMessage("changeToolSettings",{activator:t,toolName:e})}toolSettings(t,i){var n=this.context.stx;this.node.find("*[cq-section]").removeClass("ciq-active");var s=e.Drawing.getDrawingParameters(n,i);if(s){this.node.find("*[cq-toolbar-action='save']").addClass("ciq-active");var a=n.preferences.drawings;a&&a[i]&&this.node.find("*[cq-toolbar-action='restore']").addClass("ciq-active"),"fibtimezone"===i&&delete s.parameters;var o=$(this.params.lineSelection).parent().find(".ciq-none");o.hide();for(var r=this.defaultElements(s),c=0;c<r.length;c++)$(this.node).find(r[c]).addClass("ciq-active"),"cq-fill-color"==r[c]&&o.show();for(r=e.Drawing[i].prototype.$controls,c=0;r&&c<r.length;c++)$(this.node).find(r[c]).addClass("ciq-active")}n.layout.crosshair&&(n.layout.crosshair=!1,n.changeOccurred("layout"),n.doDisplayCrosshairs()),"notool"===i?(n.changeVectorType(null),n.preferences.magnet&&this.toggleMagnet(this),this.hide="true"):this.hide="false",this.paletteDock.handleResize(),this.sync()}defaultElements(t){var e=[];for(var i in t)"color"==i?e.push("cq-line-color"):"fillColor"==i?e.push("cq-fill-color"):"pattern"==i||"lineWidth"==i?e.push("cq-line-style"):"axisLabel"==i?e.push("cq-axis-label"):"font"==i?e.push("cq-annotation"):"parameters"==i&&e.push("cq-clickable");return e}emit(){var t=new Event("change",{bubbles:!0,cancelable:!0});this.node.find("*[cq-toolbar-dirty]").addClass("ciq-active"),this.dispatchEvent(t)}getFillColor(t){var i=$(t.node),n=this.context.stx.currentVectorParameters.fillColor;"transparent"!=n&&"auto"!=n||(n=""),i.css({background:n});var s=e.getBackgroundColor(this.parentNode);if(n&&Math.abs(e.hsl(s)[2]-e.hsl(n)[2])<.2){var a=e.chooseForegroundColor(s);i.css({border:"solid "+a+" 1px"})}else i.css({border:""})}getLineColor(t){var i=$(t.node),n=this.context.stx.currentVectorParameters.currentColor;"transparent"!=n&&"auto"!=n||(n=""),i.css({background:n});var s=e.getBackgroundColor(this.parentNode);if(!n||Math.abs(e.hsl(s)[2]-e.hsl(n)[2])<.2){var a=e.chooseForegroundColor(s);i.css({border:"solid "+a+" 1px"}),n||i.css({background:"linear-gradient(to bottom right, "+a+", "+a+" 49%, "+s+" 50%, "+s+")"})}else i.css({border:""})}pickFillColor(t){var e=t.node,i=$("cq-color-picker");if(i.length){var n=i[0],s=this;n.callback=function(t){s.context.stx.currentVectorParameters.fillColor=t,s.getFillColor({node:e}),s.emit()},n.display({node:e,context:s.context})}else console.log("DrawingToolbar.prototype.pickFillColor: no ColorPicker available")}pickLineColor(t){var e=t.node,i=$("cq-color-picker");if(i.length){var n=i[0],s=this;n.callback=function(t){s.context.stx.currentVectorParameters.currentColor=t,s.getLineColor({node:e}),s.emit()};var a=$(e).attr("cq-overrides");a&&(a=a.split(",")),n.display({node:e,overrides:a,context:s.context})}else console.log("DrawingToolbar.prototype.pickLineColor: no ColorPicker available")}restoreDefaultConfig(t,i){var n=this.context.stx;e.Drawing.restoreDefaultConfig(n,n.currentVectorParameters.vectorType,i),this.node.find("*[cq-toolbar-action='restore']").removeClass("ciq-active"),this.sync()}saveConfig(){var t=this.context.stx;e.Drawing.saveConfig(t,t.currentVectorParameters.vectorType),this.node.find("*[cq-toolbar-action='restore']").addClass("ciq-active"),this.sync()}setFibs(t,e){var i=this.context.stx.currentVectorParameters.fibonacci;if(i){for(var n=0;n<i.fibs.length;n++)i.fibs[n].parameters.lineWidth=t,i.fibs[n].parameters.pattern=e;i.timezone.parameters.lineWidth=t,i.timezone.parameters.pattern=e}}setFontFamily(t,e){var i=this.context.stx;i.currentVectorParameters.annotation&&(i.currentVectorParameters.annotation.font.family="Default"==e?null:e),$(this.params.fontFamilySelection).text(e),this.emit()}setFontSize(t,e){var i=this.context.stx;i.currentVectorParameters.annotation&&(i.currentVectorParameters.annotation.font.size=e),$(this.params.fontSizeSelection).text(e),this.emit()}setLine(t,e,i){var n=this.context.stx;n.currentVectorParameters.lineWidth=e,n.currentVectorParameters.pattern=i,this.setFibs(e,i),this.currentLineSelectedClass&&$(this.params.lineSelection).removeClass(this.currentLineSelectedClass),this.currentLineSelectedClass="ciq-"+i+"-"+parseInt(e,10),"none"==i?this.currentLineSelectedClass=null:$(this.params.lineSelection).addClass(this.currentLineSelectedClass),this.emit()}setActiveToolLabel(t){"No Tool"===t?t="":"freeform"===t?t="Doodle":t+=":",this.querySelector(".ciq-active-tool-label").innerHTML=t,this.querySelector(".ciq-mobile-palette-toggle span").innerHTML=t||"Select Tool"}sync(t){var i=this.context.stx;t?i.currentVectorParameters=e.extend(i.currentVectorParameters||{},t):t=i.currentVectorParameters;var n=this.params;this.setLine(null,t.lineWidth,t.pattern);var s=i.canvasStyle("stx_annotation"),a=t.annotation&&t.annotation.font,o=a&&a.size||s.fontSize;this.setFontSize(null,o);var r=a&&a.family||s.fontFamily;this.setFontFamily(null,r);var c=a&&a.style||s.fontStyle;$(n.fontStyleToggle)["italic"===c?"addClass":"removeClass"]("ciq-active");var l=a&&a.weight||s.fontWeight;$(n.fontWeightToggle)["bold"===l||l>=700?"addClass":"removeClass"]("ciq-active"),$(n.axisLabelToggle)[t.axisLabel?"addClass":"removeClass"]("ciq-active"),this.getFillColor({node:$(n.fillColor)}),this.getLineColor({node:$(n.lineColor)}),$(n.cvpControllers).each((function(){this.sync(t)}));var d=n.waveParameters;d&&d[0]&&d[0].activate(),this.node.find("*[cq-toolbar-dirty]").removeClass("ciq-active")}toggleAxisLabel(t){var e=this.context.stx;!0===e.currentVectorParameters.axisLabel?(e.currentVectorParameters.axisLabel=!1,$(t.node).removeClass("ciq-active")):(e.currentVectorParameters.axisLabel=!0,$(t.node).addClass("ciq-active")),this.emit()}toggleFontStyle(t,e){var i=this.context.stx;"italic"==e?"italic"==i.currentVectorParameters.annotation.font.style?(i.currentVectorParameters.annotation.font.style=null,$(t.node).removeClass("ciq-active")):(i.currentVectorParameters.annotation.font.style="italic",$(t.node).addClass("ciq-active")):"bold"==e&&("bold"==i.currentVectorParameters.annotation.font.weight?(i.currentVectorParameters.annotation.font.weight=null,$(t.node).removeClass("ciq-active")):(i.currentVectorParameters.annotation.font.weight="bold",$(t.node).addClass("ciq-active"))),this.emit()}toggleMagnet(t){var i=$(t.node),n=this.context.stx;n.preferences.magnet?(i.removeClass("active"),n.preferences.magnet=!1):(i.addClass("active"),n.preferences.magnet=!0),e.clearCanvas(n.chart.tempCanvas,n)}togglePalette(){this.sendMessage("toggleDrawingPalette")}}t.markup='\n\t<div class="palette-container">\n\t\t<div class="drag-strip"></div>\n\t\t\t<div class="drawing-settings-wrapper">\n\t\t\t\t\t<div class="mini-widget-group">\n\t\t\t\t\t\t<cq-item class="ciq-mini-widget" cq-view="detach" stxtap="detach()"><span class="icon"></span><label>Detach</label></cq-item>\n\t\t\t\t\t\t<cq-item class="ciq-mini-widget" cq-view="attach" stxtap="dock()"><span class="icon"></span><label>Attach</label></cq-item>\n\t\t\t\t\t</div>\n\t\t\t\t<cq-clickable class="ciq-select ciq-mobile-palette-toggle" stxtap="togglePalette()"><span>Select Tool</span></cq-clickable>\n\t\t\t\t<cq-toolbar-settings>\n\t\t\t\t\t<div class="ciq-active-tool-label ciq-heading"></div>\n\t\t\t\t\t<cq-fill-color cq-section class="ciq-color" stxbind="getFillColor()" stxtap="pickFillColor()">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t</cq-fill-color>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<cq-line-color cq-section cq-overrides="auto" class="ciq-color" stxbind="getLineColor()" stxtap="pickLineColor()"><span></span></cq-line-color>\n\t\t\t\t\t\t<cq-line-style cq-section>\n\t\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t\t<span cq-line-style class="ciq-line ciq-selected"></span>\n\t\t\t\t\t\t\t\t<cq-menu-dropdown class="ciq-line-style-menu">\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(1,\'solid\')"><span class="ciq-line-style-option ciq-solid-1"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(3,\'solid\')"><span class="ciq-line-style-option ciq-solid-3"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(5,\'solid\')"><span class="ciq-line-style-option ciq-solid-5"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(1,\'dotted\')"><span class="ciq-line-style-option ciq-dotted-1"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(3,\'dotted\')"><span class="ciq-line-style-option ciq-dotted-3"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(5,\'dotted\')"><span class="ciq-line-style-option ciq-dotted-5"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(1,\'dashed\')"><span class="ciq-line-style-option ciq-dashed-1"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(3,\'dashed\')"><span class="ciq-line-style-option ciq-dashed-3"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(5,\'dashed\')"><span class="ciq-line-style-option ciq-dashed-5"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(0,\'none\')" class="ciq-none">None</cq-item>\n\t\t\t\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t</cq-line-style>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<cq-cvp-controller cq-section cq-cvp-header="1"></cq-cvp-controller>\n\t\t\t\t\t<cq-cvp-controller cq-section cq-cvp-header="2"></cq-cvp-controller>\n\t\t\t\t\t<cq-cvp-controller cq-section cq-cvp-header="3"></cq-cvp-controller>\n\n\t\t\t\t\t<template cq-cvp-controller>\n\t\t\t\t\t\t<div cq-section>\n\t\t\t\t\t\t\t<div class="ciq-heading">Dev 1</div>\n\t\t\t\t\t\t\t<span stxtap="toggleActive()" class="ciq-checkbox">\n\t\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<cq-line-color cq-section cq-overrides="auto" class="ciq-color" stxbind="getColor()" stxtap="pickColor()">\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t</cq-line-color>\n\t\t\t\t\t\t<cq-line-style cq-section>\n\t\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t\t<span cq-cvp-line-style class="ciq-line ciq-selected"></span>\n\t\t\t\t\t\t\t\t<cq-menu-dropdown class="ciq-line-style-menu">\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(1, \'solid\')"><span class="ciq-line-style-option ciq-solid-1"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(3, \'solid\')"><span class="ciq-line-style-option ciq-solid-3"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(5, \'solid\')"><span class="ciq-line-style-option ciq-solid-5"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(1, \'dotted\')"><span class="ciq-line-style-option ciq-dotted-1"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(3, \'dotted\')"><span class="ciq-line-style-option ciq-dotted-3"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(5, \'dotted\')"><span class="ciq-line-style-option ciq-dotted-5"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(1, \'dashed\')"><span class="ciq-line-style-option ciq-dashed-1"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(3, \'dashed\')"><span class="ciq-line-style-option ciq-dashed-3"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(5, \'dashed\')"><span class="ciq-line-style-option ciq-dashed-5"></span></cq-item>\n\t\t\t\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t</cq-line-style>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<cq-axis-label cq-section>\n\t\t\t\t\t\t<div class="ciq-heading">Axis Label:</div>\n\t\t\t\t\t\t<span stxtap="toggleAxisLabel()" class="ciq-checkbox ciq-active"><span></span></span>\n\t\t\t\t\t</cq-axis-label>\n\t\t\t\t\t<cq-annotation cq-section>\n\t\t\t\t\t\t<cq-annotation-italic stxtap="toggleFontStyle(\'italic\')" class="ciq-btn" style="font-style:italic;">I</cq-annotation-italic>\n\t\t\t\t\t\t<cq-annotation-bold stxtap="toggleFontStyle(\'bold\')" class="ciq-btn" style="font-weight:bold;">B</cq-annotation-bold>\n\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t<span cq-font-size>12px</span>\n\t\t\t\t\t\t\t<cq-menu-dropdown class="ciq-font-size">\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'8px\')">8</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'10px\')">10</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'12px\')">12</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'13px\')">13</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'14px\')">14</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'16px\')">16</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'20px\')">20</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'28px\')">28</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'36px\')">36</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'48px\')">48</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'64px\')">64</cq-item>\n\t\t\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t<span cq-font-family>Default</span>\n\t\t\t\t\t\t\t<cq-menu-dropdown class="ciq-font-family">\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontFamily(\'Default\')">Default</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontFamily(\'Helvetica\')">Helvetica</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontFamily(\'Courier\')">Courier</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontFamily(\'Garamond\')">Garamond</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontFamily(\'Palatino\')">Palatino</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontFamily(\'Times New Roman\')">Times New Roman</cq-item>\n\t\t\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t</cq-annotation>\n\t\t\t\t\t<cq-clickable cq-fib-settings cq-selector="cq-fib-settings-dialog" cq-method="open" cq-section><span class="ciq-icon-btn cq-icon-gear"><cq-tooltip>Settings</cq-tooltip></span></cq-clickable>\n\t\t\t\t\t<div class="ciq-drawing-edit-only" cq-section>\n\t\t\t\t\t\t<div cq-toolbar-action="done_edit" stxtap="DrawingEdit.endEdit(\'close\')" cq-section><cq-tooltip>Done Editing</cq-tooltip></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<br cq-section cq-wave-parameters>\x3c!-- This break is not displayed by default but uses  the .ciq-active class to be displayed and push cq-wave-parameters onto a new line in the toolbar --\x3e\n\t\t\t\t\t<cq-wave-parameters cq-section></cq-wave-parameters>\n\t\t\t\t\t<template cq-wave-parameters>\n\t\t\t\t\t\t<div class="ciq-wave-template" cq-section>\n\t\t\t\t\t\t\t<div class="ciq-heading">WAVE TEMPLATE</div>\n\t\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t\t<span class="ciq-active-template">WAVE TEMPLATE</span>\n\t\t\t\t\t\t\t\t<cq-menu-dropdown>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Grand Supercycle\')">Grand Supercycle</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Supercycle\')">Supercycle</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Cycle\')">Cycle</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Primary\')">Primary</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Intermediate\')">Intermediate</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Minor\')">Minor</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Minute\')">Minute</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Minuette\')">Minuette</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Sub-Minuette\')">Sub-Minuette</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Custom\')">Custom</cq-item>\n\t\t\t\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ciq-wave-impulse" cq-section>\n\t\t\t\t\t\t\t<div class="ciq-heading">IMPULSE</div>\n\t\t\t\t\t\t\t<cq-menu  class="ciq-select">\n\t\t\t\t\t\t\t\t<span class="ciq-active-impulse">IMPULSE</span>\n\t\t\t\t\t\t\t\t<cq-menu-dropdown>\n\t\t\t\t\t\t\t\t\t<cq-item stxTap="update(\'impulse\',null)">- - -</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'impulse\',\'I,II,III,IV,V\')">I II III IV V</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'impulse\',\'i,ii,iii,iv,v\')">i ii iii iv v</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'impulse\',\'1,2,3,4,5\')">1 2 3 4 5</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'impulse\',\'A,B,C,D,E\')">A B C D E</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'impulse\',\'a,b,c,d,e\')">a b c d e</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'impulse\',\'W,X,Y,X,Z\')">W X Y X Z</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'impulse\',\'w,x,y,x,z\')">w x y x z</cq-item>\n\t\t\t\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ciq-wave-corrective" cq-section>\n\t\t\t\t\t\t\t<div class="ciq-heading">CORRECTIVE</div>\n\t\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t\t<span class="ciq-active-corrective">CORRECTIVE</span>\n\t\t\t\t\t\t\t\t<cq-menu-dropdown>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'corrective\',null)">- - -</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'corrective\',\'A,B,C\')">A B C</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'corrective\',\'a,b,c\')">a b c</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'corrective\',\'W,X,Y\')">W X Y</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'corrective\',\'w,x,y\')">w x y</cq-item>\n\t\t\t\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class="ciq-icon-btn ciq-btn" decoration="none" stxtap="update(\'decoration\',null)" cq-section>\n\t\t\t\t\t\t\t<cq-tooltip>None</cq-tooltip>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="ciq-icon-btn ciq-btn" decoration="parentheses" stxtap="update(\'decoration\',\'parentheses\')" cq-section>\n\t\t\t\t\t\t\t<cq-tooltip>Parentheses</cq-tooltip>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="ciq-icon-btn ciq-btn" decoration="enclosed" stxtap="update(\'decoration\',\'enclosed\')" cq-section>\n\t\t\t\t\t\t\t<cq-tooltip>Enclosed</cq-tooltip>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div class="ciq-heading ciq-show-lines"  cq-section>\n\t\t\t\t\t\t\tShow Lines: <span stxtap="toggleLines()" class="ciq-checkbox ciq-active"><span></span></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<div class="ciq-drawing-edit-hidden" cq-section>\n\t\t\t\t\t\t<div cq-toolbar-action="save" stxtap="saveConfig()" cq-section><div cq-toolbar-dirty></div><cq-tooltip>Save Config</cq-tooltip></div>\n\t\t\t\t\t\t<div cq-toolbar-action="restore" stxtap="restoreDefaultConfig()" cq-section><cq-tooltip>Restore Config</cq-tooltip></div>\n\t\t\t\t\t</div>\n\t\t\t\t</cq-toolbar-settings>\n\t\t\t\t<cq-measure><span class="mMeasure"></span></cq-measure>\n\t\t\t</div>\n\t\t<div class="resize-strip"></div>\n\t</div>\n\t',e.UI.addComponentDefinition("cq-drawing-settings",t)}else console.error("drawingSettings component requires first activating drawing feature.");else console.error("drawingSettings component requires first activating palette component.")},xt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;const i=e.UI._webcomponents.list["cq-scroll"];if(i){class t extends i.classDefinition{constructor(){super(),this.noMaximize=!0}}e.UI.addComponentDefinition("cq-menu-dropdown",t)}else console.error("menuDropdown component requires first activating scroll component.")};(n.c||n.c).activateImports(f,v,q,x,y,b,C,k,I,w,S,T,U,D,M,L,E,A,P,z,N,Q,V,F,H,B,_,O,j,R,W,K,Y,G,X,Z,J,tt,et,it,nt,st,at,ot,rt,ct,lt,dt,ht,pt,ut,mt,gt,ft,vt,qt,xt,null)}}]);